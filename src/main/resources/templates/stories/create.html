<!--<!DOCTYPE html>-->
<!--<html lang="ru" xmlns:th="http://www.thymeleaf.org">-->
<!--<head>-->
<!--  <meta charset="UTF-8">-->
<!--  <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--  <title>–°–æ–∑–¥–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é - Cleopatra</title>-->
<!--</head>-->
<!--<body>-->
<!--<h1>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∏—Å—Ç–æ—Ä–∏—é</h1>-->

<!--<div>-->
<!--  <a href="/stories">‚Üê –ù–∞–∑–∞–¥ –∫ –∏—Å—Ç–æ—Ä–∏—è–º</a>-->
<!--</div>-->

<!--<hr>-->

<!--<div>-->
<!--  <p><strong>–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ID:</strong> <span th:text="${currentUserId}">1</span></p>-->
<!--</div>-->

<!--<hr>-->

<!--<form id="createStoryForm" enctype="multipart/form-data">-->
<!--  <input type="hidden" name="currentUserId" th:value="${currentUserId}">-->

<!--  <div>-->
<!--    <label for="imageFile"><strong>–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:</strong></label><br>-->
<!--    <input type="file" id="imageFile" name="file" accept="image/*" required>-->
<!--    <br><small>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: JPG, PNG, GIF. –ú–∞–∫—Å–∏–º—É–º: 10MB</small>-->
<!--  </div>-->

<!--  <br>-->

<!--  &lt;!&ndash; –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä &ndash;&gt;-->
<!--  <div id="imagePreview" style="display: none;">-->
<!--    <h3>–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä:</h3>-->
<!--    <img id="previewImg" alt="–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä" style="max-width: 300px; max-height: 300px;">-->
<!--  </div>-->

<!--  <br>-->

<!--  <div>-->
<!--    <label for="emoji"><strong>–≠–º–æ–¥–∑–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</strong></label><br>-->
<!--    <select id="emoji" name="emoji">-->
<!--      <option value="">&#45;&#45; –í—ã–±–µ—Ä–∏—Ç–µ —ç–º–æ–¥–∑–∏ &#45;&#45;</option>-->
<!--      <option th:each="emoji : ${storyEmojiValues}"-->
<!--              th:value="${emoji.name()}"-->
<!--              th:text="${emoji.emoji + ' ' + emoji.description}">-->
<!--        ‚ù§Ô∏è –°–µ—Ä–¥—Ü–µ-->
<!--      </option>-->
<!--    </select>-->
<!--  </div>-->

<!--  <br>-->

<!--  <div>-->
<!--    <label for="description"><strong>–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</strong></label><br>-->
<!--    <textarea id="description" name="description" rows="3" cols="50" maxlength="500"-->
<!--              placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å –æ —Å–≤–æ–µ–π –∏—Å—Ç–æ—Ä–∏–∏..."></textarea>-->
<!--    <br><small><span id="charCount">0</span>/500 —Å–∏–º–≤–æ–ª–æ–≤</small>-->
<!--  </div>-->

<!--  <br>-->

<!--  <div style="border: 1px solid #ccc; padding: 10px;">-->
<!--    <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏—Å—Ç–µ—á–µ–Ω–∏–∏:</h3>-->
<!--    <p>–í–∞—à–∞ –∏—Å—Ç–æ—Ä–∏—è –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ <strong>24 —á–∞—Å–æ–≤</strong> —Å –º–æ–º–µ–Ω—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è.</p>-->
<!--    <p>–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –æ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–∏—Ç—Å—è.</p>-->
<!--  </div>-->

<!--  <br>-->

<!--  <div>-->
<!--    <button type="submit" id="createBtn">–°–æ–∑–¥–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>-->
<!--    <a href="/stories">–û—Ç–º–µ–Ω–∞</a>-->
<!--  </div>-->
<!--</form>-->

<!--&lt;!&ndash; –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ &ndash;&gt;-->
<!--<div id="loadingIndicator" style="display: none;">-->
<!--  <hr>-->
<!--  <h3>–ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∞—à—É –∏—Å—Ç–æ—Ä–∏—é...</h3>-->
<!--  <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ. –ù–µ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.</p>-->
<!--</div>-->

<!--&lt;!&ndash; –†–µ–∑—É–ª—å—Ç–∞—Ç &ndash;&gt;-->
<!--<div id="result" style="display: none;">-->
<!--  &lt;!&ndash; –†–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –∑–¥–µ—Å—å &ndash;&gt;-->
<!--</div>-->

<!--<script>-->
<!--  document.addEventListener('DOMContentLoaded', function() {-->
<!--    const form = document.getElementById('createStoryForm');-->
<!--    const fileInput = document.getElementById('imageFile');-->
<!--    const previewContainer = document.getElementById('imagePreview');-->
<!--    const previewImg = document.getElementById('previewImg');-->
<!--    const description = document.getElementById('description');-->
<!--    const charCount = document.getElementById('charCount');-->
<!--    const loadingIndicator = document.getElementById('loadingIndicator');-->
<!--    const result = document.getElementById('result');-->

<!--    // –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è-->
<!--    fileInput.addEventListener('change', function(e) {-->
<!--      const file = e.target.files[0];-->
<!--      if (file) {-->
<!--        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (10MB)-->
<!--        if (file.size > 10 * 1024 * 1024) {-->
<!--          alert('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π! –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10MB');-->
<!--          fileInput.value = '';-->
<!--          previewContainer.style.display = 'none';-->
<!--          return;-->
<!--        }-->

<!--        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞-->
<!--        if (!file.type.startsWith('image/')) {-->
<!--          alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ!');-->
<!--          fileInput.value = '';-->
<!--          previewContainer.style.display = 'none';-->
<!--          return;-->
<!--        }-->

<!--        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä-->
<!--        const reader = new FileReader();-->
<!--        reader.onload = function(e) {-->
<!--          previewImg.src = e.target.result;-->
<!--          previewContainer.style.display = 'block';-->
<!--        };-->
<!--        reader.readAsDataURL(file);-->
<!--      }-->
<!--    });-->

<!--    // –°—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏-->
<!--    description.addEventListener('input', function() {-->
<!--      const length = this.value.length;-->
<!--      charCount.textContent = length;-->
<!--    });-->

<!--    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã-->
<!--    form.addEventListener('submit', function(e) {-->
<!--      e.preventDefault();-->

<!--      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–±—Ä–∞–Ω –ª–∏ —Ñ–∞–π–ª-->
<!--      if (!fileInput.files[0]) {-->
<!--        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ!');-->
<!--        return;-->
<!--      }-->

<!--      console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É...');-->

<!--      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏-->
<!--      form.style.display = 'none';-->
<!--      loadingIndicator.style.display = 'block';-->

<!--      // –°–æ–∑–¥–∞–µ–º FormData-->
<!--      const formData = new FormData(form);-->

<!--      // –í—ã–≤–æ–¥–∏–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –≤ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏-->
<!--      console.log('FormData —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ:');-->
<!--      for (let pair of formData.entries()) {-->
<!--        console.log(pair[0] + ': ' + pair[1]);-->
<!--      }-->

<!--      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å-->
<!--      fetch('/stories/api/create', {-->
<!--        method: 'POST',-->
<!--        body: formData-->
<!--      })-->
<!--              .then(response => {-->
<!--                console.log('–û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω:', response.status);-->
<!--                if (response.ok) {-->
<!--                  return response.json();-->
<!--                } else {-->
<!--                  return response.text().then(text => {-->
<!--                    throw new Error(text);-->
<!--                  });-->
<!--                }-->
<!--              })-->
<!--              .then(data => {-->
<!--                console.log('–£—Å–ø–µ—à–Ω–æ:', data);-->
<!--                // –£—Å–ø–µ—à–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ-->
<!--                loadingIndicator.style.display = 'none';-->
<!--                result.innerHTML = `-->
<!--                        <hr>-->
<!--                        <h3>‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ!</h3>-->
<!--                        <p>ID –∏—Å—Ç–æ—Ä–∏–∏: ${data.id}</p>-->
<!--                        <p>–í–∞—à–∞ –∏—Å—Ç–æ—Ä–∏—è –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤.</p>-->
<!--                        <div>-->
<!--                            <a href="/stories/${data.id}">üëÄ –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é</a> |-->
<!--                            <a href="/stories">üì± –ö —Å–ø–∏—Å–∫—É –∏—Å—Ç–æ—Ä–∏–π</a> |-->
<!--                            <a href="/stories/create">‚ûï –°–æ–∑–¥–∞—Ç—å –µ—â–µ –æ–¥–Ω—É</a>-->
<!--                        </div>-->
<!--                    `;-->
<!--                result.style.display = 'block';-->
<!--              })-->
<!--              .catch(error => {-->
<!--                console.error('–û—à–∏–±–∫–∞:', error);-->
<!--                // –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è-->
<!--                loadingIndicator.style.display = 'none';-->
<!--                result.innerHTML = `-->
<!--                        <hr>-->
<!--                        <h3>‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏</h3>-->
<!--                        <p>${error.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}</p>-->
<!--                        <div>-->
<!--                            <button type="button" onclick="tryAgain()">üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –µ—â–µ —Ä–∞–∑</button>-->
<!--                            <a href="/stories">‚Üê –ù–∞–∑–∞–¥ –∫ –∏—Å—Ç–æ—Ä–∏—è–º</a>-->
<!--                        </div>-->
<!--                    `;-->
<!--                result.style.display = 'block';-->
<!--              });-->
<!--    });-->

<!--    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏-->
<!--    window.tryAgain = function() {-->
<!--      form.style.display = 'block';-->
<!--      result.style.display = 'none';-->
<!--      loadingIndicator.style.display = 'none';-->

<!--      // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É-->
<!--      fileInput.value = '';-->
<!--      previewContainer.style.display = 'none';-->
<!--      description.value = '';-->
<!--      charCount.textContent = '0';-->
<!--      document.getElementById('emoji').selectedIndex = 0;-->
<!--    };-->
<!--  });-->
<!--</script>-->
<!--</body>-->
<!--</html>-->


<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–°–æ–∑–¥–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é - Cleopatra</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-primary: #fafafa;
      --bg-secondary: #ffffff;
      --bg-accent: #f8f9fa;
      --surface-elevated: rgba(255, 255, 255, 0.95);

      /* Sophisticated Neutrals */
      --text-primary: #1a1a1a;
      --text-secondary: #6b7280;
      --text-muted: #9ca3af;
      --text-light: #d1d5db;

      /* Additional Colors */
      --primary-color: #3b82f6;
      --primary-hover: #2563eb;
      --secondary-color: #64748b;
      --accent-color: #8b5cf6;
      --success-color: #10b981;
      --warning-color: #f59e0b;
      --danger-color: #ef4444;

      /* Spacing */
      --spacing-xs: 0.25rem;
      --spacing-sm: 0.5rem;
      --spacing-md: 1rem;
      --spacing-lg: 1.5rem;
      --spacing-xl: 2rem;
      --spacing-2xl: 3rem;

      /* Border Radius */
      --radius-sm: 0.375rem;
      --radius-md: 0.5rem;
      --radius-lg: 0.75rem;
      --radius-xl: 1rem;

      /* Shadows */
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
    }

    .main-content {
      margin-left: 260px;
      min-height: 100vh;
      padding: var(--spacing-xl);
      transition: margin-left 0.3s ease;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    /* Page Header */
    .page-header {
      margin-bottom: var(--spacing-2xl);
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: var(--spacing-xl);
      flex-wrap: wrap;
    }

    .header-text {
      flex: 1;
      min-width: 280px;
    }

    .page-title {
      font-family: 'Playfair Display', serif;
      font-size: 2.5rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: var(--spacing-sm);
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
    }

    .title-icon {
      color: var(--primary-color);
      font-size: 2rem;
    }

    .page-subtitle {
      font-size: 1.125rem;
      color: var(--text-secondary);
      font-weight: 400;
    }

    .header-actions {
      display: flex;
      gap: var(--spacing-md);
      flex-wrap: wrap;
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-sm);
      padding: var(--spacing-md) var(--spacing-lg);
      font-size: 0.875rem;
      font-weight: 500;
      border-radius: var(--radius-md);
      text-decoration: none;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
    }

    .btn-primary {
      background-color: var(--primary-color);
      color: white;
    }

    .btn-primary:hover {
      background-color: var(--primary-hover);
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .btn-primary:disabled {
      background-color: var(--text-muted);
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      background-color: var(--bg-secondary);
      color: var(--text-secondary);
      border: 1px solid var(--text-light);
    }

    .btn-secondary:hover {
      background-color: var(--bg-accent);
      color: var(--text-primary);
      border-color: var(--text-muted);
    }

    /* Create Form */
    .create-form-container {
      background-color: var(--bg-secondary);
      border-radius: var(--radius-xl);
      padding: var(--spacing-2xl);
      box-shadow: var(--shadow-md);
    }

    .form-section {
      margin-bottom: var(--spacing-2xl);
    }

    .form-section:last-child {
      margin-bottom: 0;
    }

    .section-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: var(--spacing-lg);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .section-icon {
      color: var(--primary-color);
      font-size: 1.2rem;
    }

    /* File Upload */
    .upload-area {
      border: 2px dashed var(--text-light);
      border-radius: var(--radius-lg);
      padding: var(--spacing-2xl);
      text-align: center;
      background-color: var(--bg-accent);
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
    }

    .upload-area:hover {
      border-color: var(--primary-color);
      background-color: rgba(59, 130, 246, 0.05);
    }

    .upload-area.dragover {
      border-color: var(--primary-color);
      background-color: rgba(59, 130, 246, 0.1);
      transform: scale(1.02);
    }

    .upload-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--spacing-md);
    }

    .upload-icon {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.5rem;
    }

    .upload-text {
      color: var(--text-primary);
      font-weight: 500;
      font-size: 1.125rem;
    }

    .upload-hint {
      color: var(--text-muted);
      font-size: 0.875rem;
    }

    .file-input {
      display: none;
    }

    /* Image Preview */
    .image-preview {
      display: none;
      position: relative;
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow-md);
    }

    .preview-image {
      width: 100%;
      max-height: 400px;
      object-fit: cover;
      display: block;
    }

    .preview-overlay {
      position: absolute;
      top: var(--spacing-md);
      right: var(--spacing-md);
      display: flex;
      gap: var(--spacing-sm);
    }

    .overlay-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      backdrop-filter: blur(10px);
    }

    .overlay-btn.change {
      background: rgba(59, 130, 246, 0.9);
      color: white;
    }

    .overlay-btn.remove {
      background: rgba(239, 68, 68, 0.9);
      color: white;
    }

    .overlay-btn:hover {
      transform: scale(1.1);
    }

    /* Form Controls */
    .form-group {
      margin-bottom: var(--spacing-lg);
    }

    .form-label {
      display: block;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: var(--spacing-sm);
      font-size: 0.875rem;
    }

    .form-textarea {
      width: 100%;
      min-height: 120px;
      padding: var(--spacing-md);
      border: 1px solid var(--text-light);
      border-radius: var(--radius-md);
      background-color: var(--bg-accent);
      color: var(--text-primary);
      font-family: inherit;
      font-size: 0.875rem;
      line-height: 1.5;
      resize: vertical;
      transition: border-color 0.2s ease;
    }

    .form-textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .form-textarea::placeholder {
      color: var(--text-muted);
    }

    .char-counter {
      text-align: right;
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: var(--spacing-xs);
    }

    .char-counter.warning {
      color: var(--warning-color);
    }

    .char-counter.danger {
      color: var(--danger-color);
    }

    /* Emoji Selection */
    .emoji-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: var(--spacing-md);
    }

    .emoji-option {
      padding: var(--spacing-md);
      border: 2px solid var(--text-light);
      border-radius: var(--radius-md);
      background-color: var(--bg-accent);
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--spacing-xs);
      text-align: center;
    }

    .emoji-option:hover {
      border-color: var(--primary-color);
      background-color: rgba(59, 130, 246, 0.05);
      transform: translateY(-2px);
    }

    .emoji-option.selected {
      border-color: var(--primary-color);
      background-color: var(--primary-color);
      color: white;
    }

    .emoji-icon {
      font-size: 1.5rem;
      margin-bottom: var(--spacing-xs);
    }

    .emoji-label {
      font-size: 0.75rem;
      font-weight: 500;
    }

    /* Action Buttons */
    .form-actions {
      display: flex;
      gap: var(--spacing-md);
      justify-content: flex-end;
      padding-top: var(--spacing-xl);
      border-top: 1px solid var(--text-light);
    }

    /* Progress Indicator */
    .upload-progress {
      display: none;
      margin-top: var(--spacing-lg);
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background-color: var(--text-light);
      border-radius: var(--radius-sm);
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
      width: 0%;
      transition: width 0.3s ease;
    }

    .progress-text {
      text-align: center;
      margin-top: var(--spacing-sm);
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    /* Error Messages */
    .error-message {
      background-color: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.2);
      color: var(--danger-color);
      padding: var(--spacing-md);
      border-radius: var(--radius-md);
      margin-bottom: var(--spacing-lg);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .success-message {
      background-color: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.2);
      color: var(--success-color);
      padding: var(--spacing-md);
      border-radius: var(--radius-md);
      margin-bottom: var(--spacing-lg);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
      .main-content {
        margin-left: 0;
        padding: var(--spacing-lg);
      }

      .page-title {
        font-size: 2rem;
      }

      .header-content {
        flex-direction: column;
        align-items: stretch;
      }

      .header-actions {
        justify-content: flex-start;
      }
    }

    @media (max-width: 640px) {
      .main-content {
        padding: var(--spacing-md);
      }

      .create-form-container {
        padding: var(--spacing-lg);
      }

      .emoji-grid {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: var(--spacing-sm);
      }

      .form-actions {
        flex-direction: column;
      }

      .upload-area {
        padding: var(--spacing-lg);
      }
    }
  </style>
</head>
<body>
<!-- Sidebar –∏–∑ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ -->
<th:block th:replace="~{fragments/sidebar :: complete-sidebar('stories')}"></th:block>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
<main class="main-content">
  <div class="container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <header class="page-header">
      <div class="header-content">
        <div class="header-text">
          <h1 class="page-title">
            <i class="fas fa-plus title-icon"></i>
            –°–æ–∑–¥–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é
          </h1>
          <p class="page-subtitle">–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –º–æ–º–µ–Ω—Ç–æ–º —Å–≤–æ–µ–π –∂–∏–∑–Ω–∏ —Å –¥—Ä—É–∑—å—è–º–∏</p>
        </div>
        <div class="header-actions">
          <a href="/stories" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i>
            –í—Å–µ –∏—Å—Ç–æ—Ä–∏–∏
          </a>
          <a href="/stories/feed" class="btn btn-secondary">
            <i class="fas fa-heart"></i>
            –ú–æ—è –ª–µ–Ω—Ç–∞
          </a>
        </div>
      </div>
    </header>

    <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ -->
    <div class="create-form-container">
      <form id="createStoryForm" enctype="multipart/form-data">
        <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
        <div class="form-section">
          <h3 class="section-title">
            <i class="fas fa-image section-icon"></i>
            –î–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
          </h3>

          <div class="upload-area" id="uploadArea">
            <div class="upload-content">
              <div class="upload-icon">
                <i class="fas fa-cloud-upload-alt"></i>
              </div>
              <div class="upload-text">–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –µ–≥–æ —Å—é–¥–∞</div>
              <div class="upload-hint">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è JPG, PNG, GIF –¥–æ 10MB</div>
            </div>
            <input type="file"
                   id="fileInput"
                   name="file"
                   class="file-input"
                   accept="image/*"
                   required>
          </div>

          <div class="image-preview" id="imagePreview">
            <img id="previewImage" class="preview-image" src="" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä">
            <div class="preview-overlay">
              <button type="button" class="overlay-btn change" id="changeImageBtn" title="–ò–∑–º–µ–Ω–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">
                <i class="fas fa-edit"></i>
              </button>
              <button type="button" class="overlay-btn remove" id="removeImageBtn" title="–£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>

          <div class="upload-progress" id="uploadProgress">
            <div class="progress-bar">
              <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
          </div>
        </div>

        <!-- –û–ø–∏—Å–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ -->
        <div class="form-section">
          <h3 class="section-title">
            <i class="fas fa-pen section-icon"></i>
            –û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
          </h3>

          <div class="form-group">
            <label for="description" class="form-label">–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–≤–æ–µ–º –º–æ–º–µ–Ω—Ç–µ</label>
            <textarea
                    id="description"
                    name="description"
                    class="form-textarea"
                    placeholder="–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —ç—Ç–æ–º —Ñ–æ—Ç–æ? –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–∏–º–∏ –º—ã—Å–ª—è–º–∏..."
                    maxlength="500"></textarea>
            <div class="char-counter" id="charCounter">0/500</div>
          </div>
        </div>

        <!-- –í—ã–±–æ—Ä —ç–º–æ–¥–∑–∏ -->
        <div class="form-section">
          <h3 class="section-title">
            <i class="fas fa-smile section-icon"></i>
            –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
          </h3>

          <div class="emoji-grid">
            <div class="emoji-option" data-emoji="">
              <div class="emoji-icon">üåü</div>
              <div class="emoji-label">–ë–µ–∑ —ç–º–æ–¥–∑–∏</div>
            </div>
            <div th:each="emoji : ${storyEmojiValues}"
                 class="emoji-option"
                 th:data-emoji="${emoji.name()}">
              <div class="emoji-icon" th:text="${emoji.emoji}">üòä</div>
              <div class="emoji-label" th:text="${emoji.description}">–†–∞–¥–æ—Å—Ç—å</div>
            </div>
          </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" onclick="window.history.back()">
            <i class="fas fa-times"></i>
            –û—Ç–º–µ–Ω–∞
          </button>
          <button type="submit" class="btn btn-primary" id="submitBtn" disabled>
            <i class="fas fa-share"></i>
            –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é
          </button>
        </div>
      </form>
    </div>
  </div>
</main>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const fileInput = document.getElementById('fileInput');
    const uploadArea = document.getElementById('uploadArea');
    const imagePreview = document.getElementById('imagePreview');
    const previewImage = document.getElementById('previewImage');
    const changeImageBtn = document.getElementById('changeImageBtn');
    const removeImageBtn = document.getElementById('removeImageBtn');
    const submitBtn = document.getElementById('submitBtn');
    const form = document.getElementById('createStoryForm');
    const description = document.getElementById('description');
    const charCounter = document.getElementById('charCounter');
    const uploadProgress = document.getElementById('uploadProgress');
    const progressFill = document.getElementById('progressFill');
    const progressText = document.getElementById('progressText');

    let selectedEmoji = '';
    let hasImage = false;

    // Drag and drop functionality
    uploadArea.addEventListener('dragover', function(e) {
      e.preventDefault();
      uploadArea.classList.add('dragover');
    });

    uploadArea.addEventListener('dragleave', function(e) {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
    });

    uploadArea.addEventListener('drop', function(e) {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        handleFile(files[0]);
      }
    });

    // Click to upload
    uploadArea.addEventListener('click', function() {
      fileInput.click();
    });

    changeImageBtn.addEventListener('click', function() {
      fileInput.click();
    });

    // File input change
    fileInput.addEventListener('change', function(e) {
      if (e.target.files.length > 0) {
        handleFile(e.target.files[0]);
      }
    });

    // Remove image
    removeImageBtn.addEventListener('click', function() {
      resetImageUpload();
    });

    // Handle file upload
    function handleFile(file) {
      // Validate file
      if (!file.type.startsWith('image/')) {
        showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
        return;
      }

      if (file.size > 10 * 1024 * 1024) { // 10MB
        showError('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 10MB');
        return;
      }

      // Show preview
      const reader = new FileReader();
      reader.onload = function(e) {
        previewImage.src = e.target.result;
        uploadArea.style.display = 'none';
        imagePreview.style.display = 'block';
        hasImage = true;
        updateSubmitButton();
      };
      reader.readAsDataURL(file);
    }

    // Reset image upload
    function resetImageUpload() {
      fileInput.value = '';
      uploadArea.style.display = 'block';
      imagePreview.style.display = 'none';
      hasImage = false;
      updateSubmitButton();
    }

    // Description character counter
    description.addEventListener('input', function() {
      const length = this.value.length;
      const maxLength = 500;
      charCounter.textContent = `${length}/${maxLength}`;

      if (length > maxLength * 0.9) {
        charCounter.classList.add('warning');
      } else {
        charCounter.classList.remove('warning');
      }

      if (length >= maxLength) {
        charCounter.classList.add('danger');
      } else {
        charCounter.classList.remove('danger');
      }
    });

    // Emoji selection
    document.querySelectorAll('.emoji-option').forEach(option => {
      option.addEventListener('click', function() {
        // Remove selected class from all options
        document.querySelectorAll('.emoji-option').forEach(opt => {
          opt.classList.remove('selected');
        });

        // Add selected class to clicked option
        this.classList.add('selected');
        selectedEmoji = this.dataset.emoji || '';
      });
    });

    // Update submit button state
    function updateSubmitButton() {
      submitBtn.disabled = !hasImage;
    }

    // Form submission
    form.addEventListener('submit', function(e) {
      e.preventDefault();

      if (!hasImage) {
        showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
        return;
      }

      const formData = new FormData();
      formData.append('file', fileInput.files[0]);

      if (description.value.trim()) {
        formData.append('description', description.value.trim());
      }

      if (selectedEmoji) {
        formData.append('emoji', selectedEmoji);
      }

      // Show progress
      uploadProgress.style.display = 'block';
      submitBtn.disabled = true;

      // Upload story
      fetch('/stories/api/create', {
        method: 'POST',
        body: formData
      })
              .then(response => {
                if (!response.ok) {
                  return response.text().then(text => {
                    throw new Error(text || '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏');
                  });
                }
                return response.json();
              })
              .then(data => {
                showSuccess('–ò—Å—Ç–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!');
                setTimeout(() => {
                  window.location.href = `/stories/${data.id}`;
                }, 1500);
              })
              .catch(error => {
                console.error('Error:', error);
                showError(error.message || '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏');
                submitBtn.disabled = false;
                uploadProgress.style.display = 'none';
              });
    });

    // Show error message
    function showError(message) {
      removeMessages();
      const errorDiv = document.createElement('div');
      errorDiv.className = 'error-message';
      errorDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i><span>${message}</span>`;
      form.insertBefore(errorDiv, form.firstChild);

      setTimeout(() => {
        errorDiv.remove();
      }, 5000);
    }

    // Show success message
    function showSuccess(message) {
      removeMessages();
      const successDiv = document.createElement('div');
      successDiv.className = 'success-message';
      successDiv.innerHTML = `<i class="fas fa-check-circle"></i><span>${message}</span>`;
      form.insertBefore(successDiv, form.firstChild);
    }

    // Remove existing messages
    function removeMessages() {
      const existingMessages = form.querySelectorAll('.error-message, .success-message');
      existingMessages.forEach(msg => msg.remove());
    }

    // Initialize
    updateSubmitButton();
  });
</script>
<script th:src="@{/js/online-status.js}"></script>
<script th:src="@{/js/notifications.js}"></script>
</body>
</html>