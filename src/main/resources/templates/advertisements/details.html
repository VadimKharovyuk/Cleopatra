<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title th:text="${advertisement.title}">Детали рекламы</title>
</head>
<body>
<div class="container">
  <header>
    <h1 th:text="${advertisement.title}">Название рекламы</h1>
    <div class="header-actions">
      <a href="/advertisements/my" class="btn-secondary">← Назад к списку</a>
      <a th:if="${isOwner}" th:href="@{/advertisements/edit/{id}(id=${advertisement.id})}" class="btn-primary">Редактировать</a>
    </div>
  </header>

  <!-- Сообщения -->
  <div th:if="${successMessage}" class="alert-success">
    <p th:text="${successMessage}"></p>
  </div>

  <!-- Статус -->
  <div class="status-banner" th:class="|status-banner status-${advertisement.status.name().toLowerCase()}|">
    <h3>Статус: <span th:text="${advertisement.status.getDisplayName()}">Статус</span></h3>
    <div th:switch="${advertisement.status}">
      <p th:case="'PENDING'">Ваша реклама ожидает модерации администратором.</p>
      <p th:case="'APPROVED'">Реклама одобрена и готова к запуску.</p>
      <p th:case="'ACTIVE'">Реклама активна и показывается пользователям.</p>
      <p th:case="'PAUSED'">Реклама приостановлена.</p>
      <p th:case="'REJECTED'">Реклама отклонена администратором.</p>
      <p th:case="'FINISHED'">Реклама завершена (закончился бюджет или срок).</p>
    </div>
  </div>

  <div class="ad-details">
    <!-- Основная информация -->
    <section class="info-section">
      <h2>Основная информация</h2>

      <div th:if="${advertisement.imageUrl}" class="ad-image">
        <img th:src="${advertisement.imageUrl}" th:alt="${advertisement.title}" style="max-width: 300px; max-height: 200px;">
      </div>

      <div class="info-grid">
        <div class="info-item">
          <label>Название:</label>
          <span th:text="${advertisement.title}">Название</span>
        </div>
        <div class="info-item">
          <label>Категория:</label>
          <span th:text="${advertisement.category.getDescription()}">Категория</span>
        </div>
        <div class="info-item">
          <label>Ссылка:</label>
          <a th:href="${advertisement.url}" th:text="${advertisement.url}" target="_blank">Ссылка</a>
        </div>
      </div>

      <label>Краткое описание:</label>
      <p th:text="${advertisement.shortDescription}">Краткое описание</p>
  </div>

  <div class="info-item">
    <label>Полное описание:</label>
    <p th:text="${advertisement.description}">Полное описание</p>
  </div>
  </section>

  <!-- Финансы и статистика -->
  <section class="stats-section">
    <h2>Бюджет и статистика</h2>

    <div class="stats-grid">
      <div class="stat-card">
        <h3>Бюджет</h3>
        <div class="stat-value" th:text="${advertisement.totalBudget} + ' руб.'">1000 руб.</div>
        <small>Общий бюджет</small>
      </div>

      <div class="stat-card">
        <h3>Остаток</h3>
        <div class="stat-value" th:text="${advertisement.remainingBudget} + ' руб.'">800 руб.</div>
        <small>Доступно для трат</small>
      </div>

      <div class="stat-card">
        <h3>Потрачено</h3>
        <div class="stat-value" th:text="${advertisement.spentAmount} + ' руб.'">200 руб.</div>
        <small>Уже потрачено</small>
      </div>

      <div class="stat-card">
        <h3>Просмотры</h3>
        <div class="stat-value" th:text="${advertisement.viewsCount}">100</div>
        <small>Всего просмотров</small>
      </div>

      <div class="stat-card">
        <h3>Клики</h3>
        <div class="stat-value" th:text="${advertisement.clicksCount}">15</div>
        <small>Всего кликов</small>
      </div>

      <div class="stat-card">
        <h3>CTR</h3>
        <div class="stat-value" th:text="${#numbers.formatDecimal(advertisement.ctr, 0, 2)} + '%'">15.00%</div>
        <small>Коэффициент кликабельности</small>
      </div>
    </div>

    <div class="cost-info">
      <p><strong>Стоимость за просмотр:</strong> <span th:text="${advertisement.costPerView} + ' руб.'">0.20 руб.</span></p>
      <p><strong>Стоимость за клик:</strong> <span th:text="${advertisement.costPerClick} + ' руб.'">0.50 руб.</span></p>
      <p th:if="${advertisement.averageCostPerClick.compareTo(T(java.math.BigDecimal).ZERO) > 0}">
        <strong>Средняя стоимость клика:</strong>
        <span th:text="${advertisement.averageCostPerClick} + ' руб.'">0.35 руб.</span>
      </p>
    </div>
  </section>

  <!-- Таргетинг -->
  <section class="targeting-section">
    <h2>Настройки таргетинга</h2>

    <div class="targeting-grid">
      <div class="targeting-item">
        <label>Пол:</label>
        <span th:text="${advertisement.targetGender != null ? advertisement.targetGender.displayName : 'Любой'}">Любой</span>
      </div>

      <div class="targeting-item">
        <label>Возраст:</label>
        <span th:if="${advertisement.minAge != null and advertisement.maxAge != null}"
              th:text="'от ' + ${advertisement.minAge} + ' до ' + ${advertisement.maxAge} + ' лет'">от 18 до 65 лет</span>
        <span th:if="${advertisement.minAge == null and advertisement.maxAge == null}">Любой</span>
        <span th:if="${advertisement.minAge != null and advertisement.maxAge == null}"
              th:text="'от ' + ${advertisement.minAge} + ' лет'">от 18 лет</span>
        <span th:if="${advertisement.minAge == null and advertisement.maxAge != null}"
              th:text="'до ' + ${advertisement.maxAge} + ' лет'">до 65 лет</span>
      </div>

      <div class="targeting-item">
        <label>Город:</label>
        <span th:text="${advertisement.targetCity != null ? advertisement.targetCity : 'Любой'}">Любой</span>
      </div>
    </div>
  </section>

  <!-- Расписание -->
  <section class="schedule-section">
    <h2>Расписание показов</h2>

    <div class="schedule-grid">
      <div class="schedule-item">
        <label>Период кампании:</label>
        <span th:text="${#temporals.format(advertisement.startDate, 'dd.MM.yyyy')} + ' - ' + ${#temporals.format(advertisement.endDate, 'dd.MM.yyyy')}">01.01.2024 - 31.01.2024</span>
      </div>

      <div class="schedule-item" th:if="${advertisement.startTime != null and advertisement.endTime != null}">
        <label>Время показа:</label>
        <span th:text="${#temporals.format(advertisement.startTime, 'HH:mm')} + ' - ' + ${#temporals.format(advertisement.endTime, 'HH:mm')}">09:00 - 18:00</span>
      </div>

      <div class="schedule-item" th:if="${advertisement.startTime == null or advertisement.endTime == null}">
        <label>Время показа:</label>
        <span>Круглосуточно</span>
      </div>
    </div>
  </section>

  <!-- Активность -->
  <section class="activity-section">
    <h2>Активность</h2>

    <div class="activity-info">
      <p><strong>Создана:</strong> <span th:text="${#temporals.format(advertisement.createdAt, 'dd.MM.yyyy HH:mm')}">01.01.2024 10:00</span></p>
      <p><strong>Обновлена:</strong> <span th:text="${#temporals.format(advertisement.updatedAt, 'dd.MM.yyyy HH:mm')}">05.01.2024 14:30</span></p>
      <p th:if="${advertisement.lastViewedAt}">
        <strong>Последний просмотр:</strong>
        <span th:text="${#temporals.format(advertisement.lastViewedAt, 'dd.MM.yyyy HH:mm')}">10.01.2024 16:45</span>
      </p>
      <p th:if="${advertisement.lastClickedAt}">
        <strong>Последний клик:</strong>
        <span th:text="${#temporals.format(advertisement.lastClickedAt, 'dd.MM.yyyy HH:mm')}">10.01.2024 16:50</span>
      </p>
    </div>
  </section>

  <!-- Модерация (если есть информация) -->
  <section th:if="${advertisement.approvedByName != null or advertisement.reportCount > 0}" class="moderation-section">
    <h2>Информация о модерации</h2>

    <div th:if="${advertisement.approvedByName != null}" class="moderation-info">
      <p><strong>Одобрено администратором:</strong> <span th:text="${advertisement.approvedByName}">Админ</span></p>
      <p th:if="${advertisement.approvedAt}">
        <strong>Дата одобрения:</strong>
        <span th:text="${#temporals.format(advertisement.approvedAt, 'dd.MM.yyyy HH:mm')}">01.01.2024 12:00</span>
      </p>
    </div>

    <div th:if="${advertisement.reportCount > 0}" class="reports-info">
      <p class="warning"><strong>Жалобы:</strong> <span th:text="${advertisement.reportCount}">2</span> жалобы от пользователей</p>
    </div>
  </section>
</div>

<!-- Действия -->
<div th:if="${isOwner}" class="actions-section">
  <h2>Действия</h2>
  <div class="action-buttons">
    <a th:href="@{/advertisements/edit/{id}(id=${advertisement.id})}" class="btn-primary">Редактировать</a>
    <form th:action="@{/advertisements/delete/{id}(id=${advertisement.id})}" method="post" style="display: inline;"
          onsubmit="return confirm('Вы уверены, что хотите удалить рекламу? Это действие нельзя отменить.')">
      <button type="submit" class="btn-danger">Удалить рекламу</button>
    </form>
  </div>
</div>
</div>
</body>
</html>