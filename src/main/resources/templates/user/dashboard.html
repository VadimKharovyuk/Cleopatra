<!--<!DOCTYPE html>-->
<!--<html lang="ru" xmlns:th="http://www.thymeleaf.org">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>–ì–ª–∞–≤–Ω–∞—è - Cleopatra</title>-->

<!--    &lt;!&ndash; External CSS &ndash;&gt;-->
<!--    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">-->
<!--    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">-->
<!--    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap"-->
<!--          rel="stylesheet">-->

<!--    <style>-->
<!--        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */-->
<!--        body {-->
<!--            background: linear-gradient(135deg, var(&#45;&#45;bg-primary) 0%, var(&#45;&#45;bg-accent) 100%);-->
<!--            color: var(&#45;&#45;text-primary);-->
<!--            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;-->
<!--            font-weight: 400;-->
<!--            line-height: 1.6;-->
<!--            min-height: 100vh;-->
<!--        }-->

<!--        /* Layout Grid */-->
<!--        .main-layout {-->
<!--            display: grid;-->
<!--            grid-template-columns: 1fr 350px;-->
<!--            gap: 0;-->
<!--            min-height: 100vh;-->
<!--            margin-left: 280px; /* –û—Ç—Å—Ç—É–ø –¥–ª—è sidebar */-->
<!--        }-->

<!--        /* Main Content Area */-->
<!--        .content-area {-->
<!--            max-width: 600px;-->
<!--            margin: 0 auto;-->
<!--            padding: 0;-->
<!--            border-left: 1px solid var(&#45;&#45;border-primary);-->
<!--            border-right: 1px solid var(&#45;&#45;border-primary);-->
<!--            background: var(&#45;&#45;bg-secondary);-->
<!--            min-height: 100vh;-->
<!--        }-->

<!--        /* Header */-->
<!--        .content-header {-->
<!--            padding: 1rem 1.5rem;-->
<!--            border-bottom: 1px solid var(&#45;&#45;border-secondary);-->
<!--            background: rgba(255, 255, 255, 0.8);-->
<!--            backdrop-filter: blur(20px);-->
<!--            position: sticky;-->
<!--            top: 0;-->
<!--            z-index: 100;-->
<!--        }-->

<!--        .header-title {-->
<!--            font-family: 'Playfair Display', serif;-->
<!--            font-size: 1.25rem;-->
<!--            font-weight: 600;-->
<!--            margin: 0;-->
<!--            color: var(&#45;&#45;text-primary);-->
<!--        }-->

<!--        /* Create Post Section */-->
<!--        .create-post {-->
<!--            padding: 1.5rem;-->
<!--            border-bottom: 8px solid var(&#45;&#45;border-secondary);-->
<!--            background: var(&#45;&#45;bg-secondary);-->
<!--        }-->

<!--        .post-composer {-->
<!--            display: flex;-->
<!--            gap: 1rem;-->
<!--        }-->

<!--        .composer-avatar {-->
<!--            width: 48px;-->
<!--            height: 48px;-->
<!--            border-radius: 50%;-->
<!--            background: linear-gradient(135deg, var(&#45;&#45;accent-primary), var(&#45;&#45;accent-secondary));-->
<!--            display: flex;-->
<!--            align-items: center;-->
<!--            justify-content: center;-->
<!--            color: white;-->
<!--            font-size: 1.25rem;-->
<!--            flex-shrink: 0;-->
<!--            box-shadow: var(&#45;&#45;shadow-sm);-->
<!--            overflow: hidden;-->
<!--        }-->

<!--        .composer-avatar img {-->
<!--            width: 100%;-->
<!--            height: 100%;-->
<!--            object-fit: cover;-->
<!--            border-radius: 50%;-->
<!--        }-->

<!--        .composer-content {-->
<!--            flex: 1;-->
<!--        }-->

<!--        .post-textarea {-->
<!--            width: 100%;-->
<!--            border: none;-->
<!--            outline: none;-->
<!--            background: transparent;-->
<!--            font-size: 1.25rem;-->
<!--            color: var(&#45;&#45;text-primary);-->
<!--            resize: none;-->
<!--            min-height: 120px;-->
<!--            font-family: inherit;-->
<!--            line-height: 1.5;-->
<!--        }-->

<!--        .post-textarea::placeholder {-->
<!--            color: var(&#45;&#45;text-muted);-->
<!--        }-->

<!--        .composer-actions {-->
<!--            display: flex;-->
<!--            justify-content: space-between;-->
<!--            align-items: center;-->
<!--            margin-top: 1rem;-->
<!--            padding-top: 1rem;-->
<!--            border-top: 1px solid var(&#45;&#45;border-secondary);-->
<!--        }-->

<!--        .composer-tools {-->
<!--            display: flex;-->
<!--            gap: 1rem;-->
<!--            align-items: center;-->
<!--        }-->

<!--        .tool-btn {-->
<!--            background: none;-->
<!--            border: none;-->
<!--            color: var(&#45;&#45;accent-primary);-->
<!--            cursor: pointer;-->
<!--            padding: 0.5rem;-->
<!--            border-radius: var(&#45;&#45;radius-sm);-->
<!--            transition: all 0.2s;-->
<!--            font-size: 1.125rem;-->
<!--        }-->

<!--        .tool-btn:hover {-->
<!--            background: rgba(37, 99, 235, 0.1);-->
<!--            transform: scale(1.05);-->
<!--        }-->

<!--        .post-btn {-->
<!--            background: linear-gradient(135deg, var(&#45;&#45;accent-primary), var(&#45;&#45;accent-secondary));-->
<!--            color: white;-->
<!--            border: none;-->
<!--            padding: 0.75rem 2rem;-->
<!--            border-radius: 9999px;-->
<!--            font-weight: 600;-->
<!--            font-size: 0.9375rem;-->
<!--            cursor: pointer;-->
<!--            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);-->
<!--            letter-spacing: 0.01em;-->
<!--            position: relative;-->
<!--            min-width: 120px;-->
<!--        }-->

<!--        .post-btn:hover {-->
<!--            transform: translateY(-2px);-->
<!--            box-shadow: var(&#45;&#45;shadow-lg);-->
<!--        }-->

<!--        .post-btn:disabled {-->
<!--            opacity: 0.5;-->
<!--            cursor: not-allowed;-->
<!--            transform: none;-->
<!--        }-->

<!--        .post-btn:disabled .btn-text {-->
<!--            opacity: 0;-->
<!--        }-->

<!--        .post-btn:not(:disabled) .btn-spinner {-->
<!--            display: none !important;-->
<!--        }-->

<!--        .btn-spinner {-->
<!--            position: absolute;-->
<!--            left: 50%;-->
<!--            top: 50%;-->
<!--            transform: translate(-50%, -50%);-->
<!--        }-->

<!--        /* Image Preview */-->
<!--        .image-preview {-->
<!--            position: relative;-->
<!--            margin: 1rem 0;-->
<!--            border-radius: 12px;-->
<!--            overflow: hidden;-->
<!--            border: 1px solid var(&#45;&#45;border-primary, #e5e7eb);-->
<!--        }-->

<!--        .preview-image {-->
<!--            width: 100%;-->
<!--            max-height: 300px;-->
<!--            object-fit: cover;-->
<!--        }-->

<!--        .remove-image-btn {-->
<!--            position: absolute;-->
<!--            top: 8px;-->
<!--            right: 8px;-->
<!--            background: rgba(0, 0, 0, 0.7);-->
<!--            color: white;-->
<!--            border: none;-->
<!--            border-radius: 50%;-->
<!--            width: 28px;-->
<!--            height: 28px;-->
<!--            display: flex;-->
<!--            align-items: center;-->
<!--            justify-content: center;-->
<!--            cursor: pointer;-->
<!--            transition: all 0.2s;-->
<!--            font-size: 12px;-->
<!--        }-->

<!--        .remove-image-btn:hover {-->
<!--            background: #dc2626;-->
<!--            transform: scale(1.1);-->
<!--        }-->

<!--        /* Character Counter */-->
<!--        .char-counter {-->
<!--            font-size: 0.875rem;-->
<!--            color: var(&#45;&#45;text-muted, #6b7280);-->
<!--            margin-left: auto;-->
<!--            margin-right: 1rem;-->
<!--        }-->

<!--        .char-counter.warning {-->
<!--            color: #f59e0b;-->
<!--        }-->

<!--        .char-counter.danger {-->
<!--            color: #dc2626;-->
<!--        }-->

<!--        /* Feed Section */-->
<!--        .feed {-->
<!--            background: var(&#45;&#45;bg-secondary);-->
<!--        }-->

<!--        .post-item {-->
<!--            padding: 1.5rem;-->
<!--            border-bottom: 1px solid var(&#45;&#45;border-secondary);-->
<!--            transition: background-color 0.2s;-->
<!--            cursor: pointer;-->
<!--        }-->

<!--        .post-item:hover {-->
<!--            background: var(&#45;&#45;bg-accent);-->
<!--        }-->

<!--        .post-header {-->
<!--            display: flex;-->
<!--            gap: 1rem;-->
<!--            margin-bottom: 1rem;-->
<!--        }-->

<!--        .post-avatar {-->
<!--            width: 40px;-->
<!--            height: 40px;-->
<!--            border-radius: 50%;-->
<!--            background: linear-gradient(135deg, var(&#45;&#45;bg-accent), #f1f5f9);-->
<!--            flex-shrink: 0;-->
<!--            overflow: hidden;-->
<!--            display: flex;-->
<!--            align-items: center;-->
<!--            justify-content: center;-->
<!--            text-decoration: none;-->
<!--        }-->

<!--        .post-avatar img {-->
<!--            width: 100%;-->
<!--            height: 100%;-->
<!--            object-fit: cover;-->
<!--            border-radius: 50%;-->
<!--        }-->

<!--        .default-avatar {-->
<!--            width: 100%;-->
<!--            height: 100%;-->
<!--            background: linear-gradient(135deg, var(&#45;&#45;accent-primary), var(&#45;&#45;accent-secondary));-->
<!--            display: flex;-->
<!--            align-items: center;-->
<!--            justify-content: center;-->
<!--            color: white;-->
<!--            font-weight: 600;-->
<!--            font-size: 0.875rem;-->
<!--        }-->

<!--        .post-meta {-->
<!--            flex: 1;-->
<!--        }-->

<!--        .post-author {-->
<!--            font-weight: 600;-->
<!--            color: var(&#45;&#45;text-primary);-->
<!--            margin-right: 0.5rem;-->
<!--            text-decoration: none;-->
<!--        }-->

<!--        .post-author:hover {-->
<!--            color: var(&#45;&#45;accent-primary);-->
<!--            text-decoration: underline;-->
<!--        }-->

<!--        .post-handle {-->
<!--            color: var(&#45;&#45;text-muted);-->
<!--            font-size: 0.9375rem;-->
<!--        }-->

<!--        .post-time {-->
<!--            color: var(&#45;&#45;text-muted);-->
<!--            font-size: 0.875rem;-->
<!--            margin-left: 0.5rem;-->
<!--        }-->

<!--        .post-content {-->
<!--            margin-left: 3rem;-->
<!--            color: var(&#45;&#45;text-primary);-->
<!--            line-height: 1.6;-->
<!--            margin-bottom: 1rem;-->
<!--            word-wrap: break-word;-->
<!--        }-->

<!--        .post-image {-->
<!--            margin-left: 3rem;-->
<!--            margin-bottom: 1rem;-->
<!--            border-radius: 12px;-->
<!--            max-width: calc(100% - 3rem);-->
<!--            height: auto;-->
<!--            border: 1px solid var(&#45;&#45;border-secondary);-->
<!--        }-->

<!--        .post-actions {-->
<!--            margin-left: 3rem;-->
<!--            display: flex;-->
<!--            gap: 2rem;-->
<!--        }-->

<!--        .action-btn {-->
<!--            display: flex;-->
<!--            align-items: center;-->
<!--            gap: 0.5rem;-->
<!--            background: none;-->
<!--            border: none;-->
<!--            color: var(&#45;&#45;text-muted);-->
<!--            cursor: pointer;-->
<!--            padding: 0.5rem;-->
<!--            border-radius: var(&#45;&#45;radius-sm);-->
<!--            transition: all 0.2s;-->
<!--            font-size: 0.875rem;-->
<!--        }-->

<!--        .action-btn:hover {-->
<!--            color: var(&#45;&#45;accent-primary);-->
<!--            background: rgba(37, 99, 235, 0.1);-->
<!--        }-->

<!--        .action-btn.liked {-->
<!--            color: #ef4444;-->
<!--        }-->

<!--        .action-btn.retweeted {-->
<!--            color: #10b981;-->
<!--        }-->

<!--        /* Empty State */-->
<!--        .empty-feed {-->
<!--            text-align: center;-->
<!--            padding: 4rem 2rem;-->
<!--            color: var(&#45;&#45;text-muted);-->
<!--        }-->

<!--        .empty-icon {-->
<!--            font-size: 3rem;-->
<!--            margin-bottom: 1rem;-->
<!--            opacity: 0.5;-->
<!--        }-->

<!--        .empty-title {-->
<!--            font-size: 1.5rem;-->
<!--            font-weight: 600;-->
<!--            margin-bottom: 1rem;-->
<!--            color: var(&#45;&#45;text-primary);-->
<!--        }-->

<!--        .empty-description {-->
<!--            font-size: 1rem;-->
<!--            line-height: 1.6;-->
<!--            margin-bottom: 2rem;-->
<!--            max-width: 400px;-->
<!--            margin-left: auto;-->
<!--            margin-right: auto;-->
<!--        }-->

<!--        .empty-action {-->
<!--            display: inline-flex;-->
<!--            align-items: center;-->
<!--            gap: 0.5rem;-->
<!--            background: var(&#45;&#45;accent-primary);-->
<!--            color: white;-->
<!--            text-decoration: none;-->
<!--            padding: 0.75rem 1.5rem;-->
<!--            border-radius: 9999px;-->
<!--            font-weight: 500;-->
<!--            transition: all 0.2s;-->
<!--        }-->

<!--        .empty-action:hover {-->
<!--            background: var(&#45;&#45;accent-secondary);-->
<!--            transform: translateY(-1px);-->
<!--            color: white;-->
<!--            text-decoration: none;-->
<!--        }-->

<!--        /* View More Button */-->
<!--        .view-more-container {-->
<!--            text-align: center;-->
<!--            margin-top: 2rem;-->
<!--            padding: 1.5rem;-->
<!--            border-top: 1px solid var(&#45;&#45;border-secondary);-->
<!--        }-->

<!--        .view-more-btn {-->
<!--            display: inline-flex;-->
<!--            align-items: center;-->
<!--            gap: 0.5rem;-->
<!--            padding: 0.75rem 1.5rem;-->
<!--            background: var(&#45;&#45;accent-primary);-->
<!--            color: white;-->
<!--            text-decoration: none;-->
<!--            border-radius: 25px;-->
<!--            font-weight: 500;-->
<!--            transition: all 0.2s ease;-->
<!--        }-->

<!--        .view-more-btn:hover {-->
<!--            background: var(&#45;&#45;accent-secondary);-->
<!--            transform: translateY(-1px);-->
<!--            text-decoration: none;-->
<!--            color: white;-->
<!--        }-->

<!--        .view-more-btn i {-->
<!--            font-size: 0.9rem;-->
<!--        }-->

<!--        /* Right Sidebar */-->
<!--        .right-sidebar {-->
<!--            padding: 1rem;-->
<!--            background: var(&#45;&#45;bg-primary);-->
<!--            overflow-y: auto;-->
<!--            max-height: 100vh;-->
<!--        }-->

<!--        /* Widget Styles */-->
<!--        .widget {-->
<!--            background: var(&#45;&#45;bg-secondary);-->
<!--            border-radius: var(&#45;&#45;radius-lg);-->
<!--            margin-bottom: 1.5rem;-->
<!--            overflow: hidden;-->
<!--            box-shadow: var(&#45;&#45;shadow-sm);-->
<!--            border: 1px solid var(&#45;&#45;border-secondary);-->
<!--        }-->

<!--        .widget-header {-->
<!--            padding: 1.25rem 1.5rem 1rem;-->
<!--            border-bottom: 1px solid var(&#45;&#45;border-secondary);-->
<!--        }-->

<!--        .widget-title {-->
<!--            font-family: 'Playfair Display', serif;-->
<!--            font-size: 1.25rem;-->
<!--            font-weight: 600;-->
<!--            color: var(&#45;&#45;text-primary);-->
<!--            margin: 0;-->
<!--        }-->

<!--        .widget-content {-->
<!--            padding: 1rem 1.5rem 1.5rem;-->
<!--        }-->

<!--        /* Trending Widget */-->
<!--        .trending-item {-->
<!--            padding: 0.75rem 0;-->
<!--            border-bottom: 1px solid var(&#45;&#45;border-secondary);-->
<!--            transition: all 0.2s;-->
<!--            cursor: pointer;-->
<!--        }-->

<!--        .trending-item:last-child {-->
<!--            border-bottom: none;-->
<!--        }-->

<!--        .trending-item:hover {-->
<!--            background: var(&#45;&#45;bg-accent);-->
<!--            margin: 0 -1.5rem;-->
<!--            padding-left: 1.5rem;-->
<!--            padding-right: 1.5rem;-->
<!--        }-->

<!--        .trending-topic {-->
<!--            font-weight: 600;-->
<!--            color: var(&#45;&#45;text-primary);-->
<!--            margin: 0 0 0.25rem 0;-->
<!--            font-size: 0.9375rem;-->
<!--        }-->

<!--        .trending-count {-->
<!--            color: var(&#45;&#45;text-muted);-->
<!--            font-size: 0.8125rem;-->
<!--            margin: 0;-->
<!--        }-->

<!--        /* Suggestions Widget */-->
<!--        .suggestion-item {-->
<!--            display: flex;-->
<!--            align-items: center;-->
<!--            padding: 1rem 0;-->
<!--            border-bottom: 1px solid var(&#45;&#45;border-secondary);-->
<!--            transition: all 0.2s;-->
<!--        }-->

<!--        .suggestion-item:last-child {-->
<!--            border-bottom: none;-->
<!--        }-->

<!--        .suggestion-item:hover {-->
<!--            background: var(&#45;&#45;bg-accent);-->
<!--            margin: 0 -1.5rem;-->
<!--            padding-left: 1.5rem;-->
<!--            padding-right: 1.5rem;-->
<!--        }-->

<!--        .suggestion-avatar {-->
<!--            width: 40px;-->
<!--            height: 40px;-->
<!--            border-radius: 50%;-->
<!--            background: linear-gradient(135deg, var(&#45;&#45;bg-accent), #f1f5f9);-->
<!--            margin-right: 0.75rem;-->
<!--            flex-shrink: 0;-->
<!--        }-->

<!--        .suggestion-info {-->
<!--            flex: 1;-->
<!--        }-->

<!--        .suggestion-name {-->
<!--            font-weight: 600;-->
<!--            font-size: 0.9375rem;-->
<!--            color: var(&#45;&#45;text-primary);-->
<!--            margin: 0 0 0.25rem;-->
<!--        }-->

<!--        .suggestion-handle {-->
<!--            font-size: 0.8125rem;-->
<!--            color: var(&#45;&#45;text-muted);-->
<!--            margin: 0;-->
<!--        }-->

<!--        .follow-btn {-->
<!--            background: var(&#45;&#45;accent-primary);-->
<!--            color: white;-->
<!--            border: none;-->
<!--            padding: 0.5rem 1rem;-->
<!--            border-radius: 9999px;-->
<!--            font-weight: 500;-->
<!--            font-size: 0.8125rem;-->
<!--            cursor: pointer;-->
<!--            transition: all 0.2s;-->
<!--        }-->

<!--        .follow-btn:hover {-->
<!--            background: var(&#45;&#45;accent-secondary);-->
<!--            transform: translateY(-1px);-->
<!--        }-->

<!--        /* Notifications */-->
<!--        .notification {-->
<!--            position: fixed;-->
<!--            top: 20px;-->
<!--            right: 20px;-->
<!--            padding: 1rem 1.5rem;-->
<!--            border-radius: 8px;-->
<!--            color: white;-->
<!--            font-weight: 500;-->
<!--            z-index: 1000;-->
<!--            transform: translateX(100%);-->
<!--            transition: transform 0.3s ease;-->
<!--        }-->

<!--        .notification.success {-->
<!--            background: linear-gradient(135deg, #059669, #10b981);-->
<!--        }-->

<!--        .notification.error {-->
<!--            background: linear-gradient(135deg, #dc2626, #ef4444);-->
<!--        }-->

<!--        .notification.show {-->
<!--            transform: translateX(0);-->
<!--        }-->

<!--        /* Responsive Design */-->
<!--        @media (max-width: 1200px) {-->
<!--            .main-layout {-->
<!--                grid-template-columns: 1fr 300px;-->
<!--            }-->
<!--        }-->

<!--        @media (max-width: 1024px) {-->
<!--            .main-layout {-->
<!--                margin-left: 80px;-->
<!--                grid-template-columns: 1fr 280px;-->
<!--            }-->
<!--        }-->

<!--        @media (max-width: 768px) {-->
<!--            .main-layout {-->
<!--                grid-template-columns: 1fr;-->
<!--                margin-left: 0;-->
<!--                margin-top: 60px;-->
<!--            }-->

<!--            .content-area {-->
<!--                border-left: none;-->
<!--                border-right: none;-->
<!--            }-->

<!--            .right-sidebar {-->
<!--                display: none;-->
<!--            }-->

<!--            .post-content,-->
<!--            .post-actions,-->
<!--            .post-image {-->
<!--                margin-left: 0;-->
<!--            }-->

<!--            .view-more-container {-->
<!--                margin-top: 1.5rem;-->
<!--                padding: 1rem;-->
<!--            }-->

<!--            .view-more-btn {-->
<!--                padding: 0.625rem 1.25rem;-->
<!--                font-size: 0.9rem;-->
<!--            }-->
<!--        }-->

<!--        @media (max-width: 480px) {-->
<!--            .post-composer {-->
<!--                flex-direction: column;-->
<!--                gap: 1rem;-->
<!--            }-->

<!--            .composer-avatar {-->
<!--                align-self: flex-start;-->
<!--            }-->

<!--            .post-actions {-->
<!--                justify-content: space-around;-->
<!--                gap: 1rem;-->
<!--            }-->
<!--        }-->
<!--    </style>-->
<!--    &lt;!&ndash; Sidebar Styles &ndash;&gt;-->
<!--    <th:block th:replace="~{fragments/sidebar :: sidebar-styles}"></th:block>-->
<!--</head>-->
<!--<body>-->

<!--&lt;!&ndash; Mobile Header &ndash;&gt;-->
<!--<th:block th:replace="~{fragments/sidebar :: mobile-header}"></th:block>-->

<!--&lt;!&ndash; Sidebar &ndash;&gt;-->
<!--<th:block th:replace="~{fragments/sidebar :: sidebar(${activeSection})}"></th:block>-->

<!--<div class="main-layout">-->
<!--    &lt;!&ndash; Main Content Area &ndash;&gt;-->
<!--    <main class="content-area">-->
<!--        &lt;!&ndash; Header &ndash;&gt;-->
<!--        <div class="content-header">-->
<!--            <h1 class="header-title">–ì–ª–∞–≤–Ω–∞—è</h1>-->
<!--        </div>-->

<!--        &lt;!&ndash; Create Post Section —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π AJAX &ndash;&gt;-->
<!--        <div class="create-post">-->
<!--            <div class="post-composer">-->
<!--                <div class="composer-avatar">-->
<!--                    <i class="fas fa-user" th:if="${currentUser?.imageUrl == null}"></i>-->
<!--                    <img th:if="${currentUser?.imageUrl}" th:src="${currentUser.imageUrl}" alt="Avatar"-->
<!--                         style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">-->
<!--                </div>-->
<!--                <div class="composer-content">-->
<!--                    &lt;!&ndash; –§–æ—Ä–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞ &ndash;&gt;-->
<!--                    <form id="createPostForm" enctype="multipart/form-data">-->
<!--                <textarea-->
<!--                        class="post-textarea"-->
<!--                        placeholder="–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?"-->
<!--                        maxlength="1000"-->
<!--                        id="postContent"-->
<!--                        name="content"-->
<!--                        required></textarea>-->

<!--                        &lt;!&ndash; –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è &ndash;&gt;-->
<!--                        <input type="file"-->
<!--                               id="imageInput"-->
<!--                               name="image"-->
<!--                               accept="image/jpeg,image/jpg,image/png,image/heif,image/heic"-->
<!--                               style="display: none;">-->

<!--                        &lt;!&ndash; –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è &ndash;&gt;-->
<!--                        <div id="imagePreview" class="image-preview" style="display: none;">-->
<!--                            <img id="previewImg" src="" alt="Preview" class="preview-image">-->
<!--                            <button type="button" class="remove-image-btn" onclick="removeImage()">-->
<!--                                <i class="fas fa-times"></i>-->
<!--                            </button>-->
<!--                        </div>-->

<!--                        <div class="composer-actions">-->
<!--                            <div class="composer-tools">-->
<!--                                <button type="button" class="tool-btn" title="–î–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" onclick="selectImage()">-->
<!--                                    <i class="fas fa-image"></i>-->
<!--                                </button>-->
<!--                                <button type="button" class="tool-btn" title="–î–æ–±–∞–≤–∏—Ç—å GIF">-->
<!--                                    <i class="fas fa-photo-video"></i>-->
<!--                                </button>-->
<!--                                <button type="button" class="tool-btn" title="–°–æ–∑–¥–∞—Ç—å –æ–ø—Ä–æ—Å">-->
<!--                                    <i class="fas fa-poll"></i>-->
<!--                                </button>-->
<!--                                <button type="button" class="tool-btn" title="–î–æ–±–∞–≤–∏—Ç—å —ç–º–æ–¥–∑–∏">-->
<!--                                    <i class="fas fa-smile"></i>-->
<!--                                </button>-->

<!--                                &lt;!&ndash; –°—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤ &ndash;&gt;-->
<!--                                <div class="char-counter">-->
<!--                                    <span id="charCount">0</span>/1000-->
<!--                                </div>-->
<!--                            </div>-->
<!--                            <button type="submit" class="post-btn" id="postButton" disabled onclick="handleButtonClick(event)">-->
<!--                                <span class="btn-text">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</span>-->
<!--                                <i class="fas fa-spinner fa-spin btn-spinner" style="display: none;"></i>-->
<!--                            </button>-->
<!--                        </div>-->
<!--                    </form>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Feed &ndash;&gt;-->
<!--        <div class="feed" id="feed">-->
<!--            &lt;!&ndash; –ï—Å–ª–∏ –µ—Å—Ç—å –ø–æ—Å—Ç—ã &ndash;&gt;-->
<!--            <div th:if="${recentPosts != null and !recentPosts.posts.empty}">-->
<!--                <div class="post-item" th:each="post : ${recentPosts.posts}"-->
<!--                     onclick="navigateToPost(event, this)"-->
<!--                     th:data-post-id="${post.id}">-->

<!--                    <div class="post-header">-->
<!--                        <a th:href="@{/profile/{userId}(userId=${post.author.id})}" class="post-avatar">-->
<!--                            <img th:if="${post.author.imageUrl}"-->
<!--                                 th:src="${post.author.imageUrl}"-->
<!--                                 th:alt="${post.author.firstName + ' ' + post.author.lastName}">-->
<!--                            <div th:unless="${post.author.imageUrl}" class="default-avatar">-->
<!--                                <span th:text="${#strings.substring(post.author.firstName, 0, 1) + #strings.substring(post.author.lastName, 0, 1)}">AB</span>-->
<!--                            </div>-->
<!--                        </a>-->

<!--                        <div class="post-meta">-->
<!--                            <a th:href="@{/profile/{userId}(userId=${post.author.id})}" class="post-author">-->
<!--                                <span th:text="${post.author.firstName + ' ' + post.author.lastName}">–ò–º—è –ê–≤—Ç–æ—Ä–∞</span>-->
<!--                            </a>-->
<!--                            <span class="post-handle" th:text="'@' + ${post.author.firstName?.toLowerCase()}">@–∞–≤—Ç–æ—Ä</span>-->
<!--                            <span class="post-time" th:text="'¬∑ ' + ${#temporals.format(post.createdAt, 'HH:mm', new java.util.Locale('ru'))}">¬∑ 2—á</span>-->
<!--                        </div>-->
<!--                    </div>-->

<!--                    <div class="post-content" th:text="${post.content}">-->
<!--                        –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ—Å—Ç–∞...-->
<!--                    </div>-->

<!--                    <img th:if="${post.hasImage}"-->
<!--                         th:src="${post.imageUrl}"-->
<!--                         alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—Å—Ç–∞"-->
<!--                         class="post-image">-->

<!--                    <div class="post-actions">-->
<!--                        <button class="action-btn comment-btn" onclick="openComments(event, this)"-->
<!--                                th:data-post-id="${post.id}">-->
<!--                            <i class="fas fa-comment"></i>-->
<!--                            <span th:text="${post.commentsCount}">0</span>-->
<!--                        </button>-->

<!--                        <button class="action-btn like-btn" onclick="toggleLike(event, this)"-->
<!--                                th:data-post-id="${post.id}">-->
<!--                            <i class="fas fa-heart"></i>-->
<!--                            <span th:text="${post.likesCount}">0</span>-->
<!--                        </button>-->

<!--                        <button class="action-btn share-btn" onclick="sharePost(event, this)"-->
<!--                                th:data-post-id="${post.id}">-->
<!--                            <i class="fas fa-share"></i>-->
<!--                        </button>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->

<!--            &lt;!&ndash; –ï—Å–ª–∏ –Ω–µ—Ç –ø–æ—Å—Ç–æ–≤ &ndash;&gt;-->
<!--            <div th:unless="${recentPosts != null and !recentPosts.posts.empty}" class="empty-feed">-->
<!--                <div class="empty-icon">-->
<!--                    <i class="fas fa-rss"></i>-->
<!--                </div>-->
<!--                <h3 class="empty-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h3>-->
<!--                <p class="empty-description">-->
<!--                    –í–∞—à–∞ –ª–µ–Ω—Ç–∞ –ø—É—Å—Ç–∞. –ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö –ª—é–¥–µ–π, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –∏—Ö –ø–æ—Å—Ç—ã –∑–¥–µ—Å—å.-->
<!--                    <br>–ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –ø–æ—Å—Ç!-->
<!--                </p>-->
<!--                <a href="/recommendations" class="empty-action">-->
<!--                    <i class="fas fa-user-plus"></i>-->
<!--                    –ù–∞–π—Ç–∏ –ª—é–¥–µ–π-->
<!--                </a>-->
<!--            </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–ª–Ω—É—é –ª–µ–Ω—Ç—É &ndash;&gt;-->
<!--        <div th:if="${recentPosts != null and !recentPosts.posts.empty}" class="view-more-container">-->
<!--            <a href="/feed" class="view-more-btn">-->
<!--                <i class="fas fa-arrow-right"></i>-->
<!--                –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å—é –ª–µ–Ω—Ç—É-->
<!--            </a>-->
<!--        </div>-->


<!--    </main>-->

<!--    &lt;!&ndash; Right Sidebar &ndash;&gt;-->
<!--    <aside class="right-sidebar">-->
<!--        &lt;!&ndash; Trending Topics &ndash;&gt;-->
<!--        <div class="widget">-->
<!--            <div class="widget-header">-->
<!--                <h3 class="widget-title">–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ç–µ–º—ã</h3>-->
<!--            </div>-->
<!--            <div class="widget-content">-->
<!--                <div class="trending-item">-->
<!--                    <p class="trending-topic">#–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏–ë—É–¥—É—â–µ–≥–æ</p>-->
<!--                    <p class="trending-count">12.5K –æ–±—Å—É–∂–¥–µ–Ω–∏–π</p>-->
<!--                </div>-->
<!--                <div class="trending-item">-->
<!--                    <p class="trending-topic">#–î–∏–∑–∞–π–Ω–¢—Ä–µ–Ω–¥—ã2025</p>-->
<!--                    <p class="trending-count">8.3K –æ–±—Å—É–∂–¥–µ–Ω–∏–π</p>-->
<!--                </div>-->
<!--                <div class="trending-item">-->
<!--                    <p class="trending-topic">#–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç</p>-->
<!--                    <p class="trending-count">15.7K –æ–±—Å—É–∂–¥–µ–Ω–∏–π</p>-->
<!--                </div>-->
<!--                <div class="trending-item">-->
<!--                    <p class="trending-topic">#Web–î–µ–≤–µ–ª–æ–ø–º–µ–Ω—Ç</p>-->
<!--                    <p class="trending-count">6.2K –æ–±—Å—É–∂–¥–µ–Ω–∏–π</p>-->
<!--                </div>-->
<!--                <div class="trending-item">-->
<!--                    <p class="trending-topic">#–£–¥–∞–ª–µ–Ω–Ω–∞—è–†–∞–±–æ—Ç–∞</p>-->
<!--                    <p class="trending-count">9.1K –æ–±—Å—É–∂–¥–µ–Ω–∏–π</p>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Who to Follow &ndash;&gt;-->
<!--        <div class="widget">-->
<!--            <div class="widget-header">-->
<!--                <h3 class="widget-title">–ö–æ–≥–æ —á–∏—Ç–∞—Ç—å</h3>-->
<!--            </div>-->
<!--            <div class="widget-content">-->
<!--                <div class="suggestion-item">-->
<!--                    <div class="suggestion-avatar"></div>-->
<!--                    <div class="suggestion-info">-->
<!--                        <p class="suggestion-name">–î–º–∏—Ç—Ä–∏–π –ö–æ–∑–ª–æ–≤</p>-->
<!--                        <p class="suggestion-handle">@alex_startup</p>-->
<!--                    </div>-->
<!--                    <button class="follow-btn">–ß–∏—Ç–∞—Ç—å</button>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Quick Stats &ndash;&gt;-->
<!--        <div class="widget">-->
<!--            <div class="widget-header">-->
<!--                <h3 class="widget-title">–í–∞—à–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h3>-->
<!--            </div>-->
<!--            <div class="widget-content">-->
<!--                <div class="trending-item">-->
<!--                    <p class="trending-topic">–ü—Ä–æ—Å–º–æ—Ç—Ä—ã –ø—Ä–æ—Ñ–∏–ª—è</p>-->
<!--                    <p class="trending-count">47 –∑–∞ —ç—Ç—É –Ω–µ–¥–µ–ª—é</p>-->
<!--                </div>-->
<!--                <div class="trending-item">-->
<!--                    <p class="trending-topic">–£–ø–æ–º–∏–Ω–∞–Ω–∏—è</p>-->
<!--                    <p class="trending-count">12 –Ω–æ–≤—ã—Ö</p>-->
<!--                </div>-->
<!--                <div class="trending-item">-->
<!--                    <p class="trending-topic">–ü–æ–¥–ø–∏—Å—á–∏–∫–∏</p>-->
<!--                    <p class="trending-count">+5 –∑–∞ –¥–µ–Ω—å</p>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Footer Links &ndash;&gt;-->
<!--        <div style="padding: 1rem 0; font-size: 0.8125rem; color: var(&#45;&#45;text-muted); line-height: 1.4;">-->
<!--            <a href="/terms" style="color: inherit; text-decoration: none; margin-right: 1rem;">–£—Å–ª–æ–≤–∏—è</a>-->
<!--            <a href="/privacy" style="color: inherit; text-decoration: none; margin-right: 1rem;">–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</a>-->
<!--            <a href="/help" style="color: inherit; text-decoration: none;">–ü–æ–º–æ—â—å</a>-->
<!--            <p style="margin-top: 0.5rem; margin-bottom: 0;">¬© 2025 Cleopatra</p>-->
<!--        </div>-->
<!--    </aside>-->
<!--</div>-->

<!--&lt;!&ndash; JS –≤ –∫–æ–Ω—Ü–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã &ndash;&gt;-->
<!--<th:block th:replace="~{fragments/sidebar :: sidebar-scripts}"></th:block>-->

<!--<script>-->
<!--    console.log('üöÄ –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–æ–≤...');-->

<!--    // –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ - –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ DOM –≥–æ—Ç–æ–≤-->
<!--    function initializePostComposer() {-->
<!--        console.log('üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è composer...');-->

<!--        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤-->
<!--        const postContent = document.getElementById('postContent');-->
<!--        const postButton = document.getElementById('postButton');-->
<!--        const charCount = document.getElementById('charCount');-->
<!--        const imageInput = document.getElementById('imageInput');-->
<!--        const imagePreview = document.getElementById('imagePreview');-->
<!--        const previewImg = document.getElementById('previewImg');-->
<!--        const createPostForm = document.getElementById('createPostForm');-->

<!--        console.log('üìã –≠–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã:', {-->
<!--            postContent: !!postContent,-->
<!--            postButton: !!postButton,-->
<!--            charCount: !!charCount,-->
<!--            imageInput: !!imageInput,-->
<!--            createPostForm: !!createPostForm-->
<!--        });-->

<!--        if (!postContent || !postButton || !createPostForm) {-->
<!--            console.error('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã!');-->
<!--            return;-->
<!--        }-->

<!--        // –°—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è-->
<!--        postContent.addEventListener('input', function() {-->
<!--            console.log('üìù –í–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞:', this.value.length);-->
<!--            const length = this.value.length;-->
<!--            const maxLength = 1000;-->

<!--            if (charCount) {-->
<!--                charCount.textContent = length;-->

<!--                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∏–ª—å —Å—á–µ—Ç—á–∏–∫–∞-->
<!--                const counter = charCount.parentElement;-->
<!--                counter.className = 'char-counter';-->
<!--                if (length > maxLength * 0.9) {-->
<!--                    counter.classList.add('warning');-->
<!--                }-->
<!--                if (length > maxLength * 0.95) {-->
<!--                    counter.classList.remove('warning');-->
<!--                    counter.classList.add('danger');-->
<!--                }-->
<!--            }-->

<!--            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º/–¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É-->
<!--            const isValid = length > 0 && length <= maxLength;-->
<!--            postButton.disabled = !isValid;-->
<!--            console.log('üîò –ö–Ω–æ–ø–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞:', isValid);-->
<!--        });-->

<!--        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è-->
<!--        if (imageInput) {-->
<!--            imageInput.addEventListener('change', function(event) {-->
<!--                console.log('üñºÔ∏è –í—ã–±—Ä–∞–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');-->
<!--                handleImageSelect(event);-->
<!--            });-->
<!--        }-->

<!--        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã-->
<!--        createPostForm.addEventListener('submit', function(event) {-->
<!--            console.log('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã...');-->
<!--            handleFormSubmit(event);-->
<!--        });-->

<!--        console.log('‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');-->
<!--    }-->

<!--    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏-->
<!--    function selectImage() {-->
<!--        console.log('üñºÔ∏è –û—Ç–∫—Ä—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è...');-->
<!--        const imageInput = document.getElementById('imageInput');-->
<!--        if (imageInput) {-->
<!--            imageInput.click();-->
<!--        } else {-->
<!--            console.error('‚ùå imageInput –Ω–µ –Ω–∞–π–¥–µ–Ω');-->
<!--        }-->
<!--    }-->

<!--    function handleImageSelect(event) {-->
<!--        const file = event.target.files[0];-->
<!--        if (!file) {-->
<!--            console.log('‚ùå –§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω');-->
<!--            return;-->
<!--        }-->

<!--        console.log('üìÅ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ñ–∞–π–ª:', file.name, file.type, file.size);-->

<!--        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞-->
<!--        const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/heif', 'image/heic'];-->
<!--        if (!allowedTypes.includes(file.type)) {-->
<!--            showNotification('–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ JPG, PNG, HEIF –∏–ª–∏ HEIC.', 'error');-->
<!--            event.target.value = '';-->
<!--            return;-->
<!--        }-->

<!--        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (10MB)-->
<!--        const maxSize = 10 * 1024 * 1024;-->
<!--        if (file.size > maxSize) {-->
<!--            showNotification('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10MB.', 'error');-->
<!--            event.target.value = '';-->
<!--            return;-->
<!--        }-->

<!--        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é-->
<!--        const reader = new FileReader();-->
<!--        reader.onload = function(e) {-->
<!--            const previewImg = document.getElementById('previewImg');-->
<!--            const imagePreview = document.getElementById('imagePreview');-->

<!--            if (previewImg && imagePreview) {-->
<!--                previewImg.src = e.target.result;-->
<!--                imagePreview.style.display = 'block';-->
<!--                console.log('‚úÖ –ü—Ä–µ–≤—å—é –ø–æ–∫–∞–∑–∞–Ω–æ');-->
<!--            }-->
<!--        };-->
<!--        reader.readAsDataURL(file);-->
<!--    }-->

<!--    function removeImage() {-->
<!--        console.log('üóëÔ∏è –£–¥–∞–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ...');-->
<!--        const imageInput = document.getElementById('imageInput');-->
<!--        const imagePreview = document.getElementById('imagePreview');-->

<!--        if (imageInput) imageInput.value = '';-->
<!--        if (imagePreview) imagePreview.style.display = 'none';-->
<!--    }-->

<!--    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –∫–Ω–æ–ø–∫–∏ (–¥—É–±–ª–∏—Ä—É–µ—Ç submit)-->
<!--    function handleButtonClick(event) {-->
<!--        console.log('üñ±Ô∏è –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å');-->
<!--        event.preventDefault();-->
<!--        handleFormSubmit(event);-->
<!--    }-->

<!--    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã-->
<!--    async function handleFormSubmit(event) {-->
<!--        event.preventDefault();-->
<!--        console.log('üöÄ –ù–∞—á–∏–Ω–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã...');-->

<!--        const postContent = document.getElementById('postContent');-->
<!--        const imageInput = document.getElementById('imageInput');-->

<!--        const content = postContent.value.trim();-->
<!--        if (!content) {-->
<!--            showNotification('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–∞', 'error');-->
<!--            return;-->
<!--        }-->

<!--        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏-->
<!--        setLoadingState(true);-->

<!--        try {-->
<!--            // –°–æ–∑–¥–∞–µ–º FormData-->
<!--            const formData = new FormData();-->
<!--            formData.append('content', content);-->

<!--            if (imageInput && imageInput.files[0]) {-->
<!--                formData.append('image', imageInput.files[0]);-->
<!--                console.log('üìé –î–æ–±–∞–≤–ª–µ–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫ –∑–∞–ø—Ä–æ—Å—É');-->
<!--            }-->

<!--            console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ /posts/api/create');-->

<!--            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å-->
<!--            const response = await fetch('/posts/api/create', {-->
<!--                method: 'POST',-->
<!--                body: formData-->
<!--            });-->

<!--            console.log('üì• –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç:', response.status, response.statusText);-->

<!--            if (response.ok) {-->
<!--                const result = await response.json();-->
<!--                console.log('‚úÖ –ü–æ—Å—Ç —Å–æ–∑–¥–∞–Ω:', result);-->
<!--                showNotification('–ü–æ—Å—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!', 'success');-->

<!--                // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É-->
<!--                resetForm();-->

<!--                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–µ–Ω—Ç—É (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å AJAX –∑–∞–≥—Ä—É–∑–∫—É –Ω–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤)-->
<!--                setTimeout(() => {-->
<!--                    location.reload();-->
<!--                }, 1000);-->

<!--            } else {-->
<!--                const errorText = await response.text();-->
<!--                console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–≤–µ—Ç–∞:', errorText);-->
<!--                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ—Å—Ç–∞: ' + response.status, 'error');-->
<!--            }-->
<!--        } catch (error) {-->
<!--            console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ—Å—Ç–∞:', error);-->
<!--            showNotification('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ—Å—Ç–∞', 'error');-->
<!--        } finally {-->
<!--            setLoadingState(false);-->
<!--        }-->
<!--    }-->

<!--    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∑–∞–≥—Ä—É–∑–∫–∏-->
<!--    function setLoadingState(loading) {-->
<!--        console.log('‚è≥ –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏:', loading);-->
<!--        const postButton = document.getElementById('postButton');-->
<!--        const btnText = postButton?.querySelector('.btn-text');-->
<!--        const btnSpinner = postButton?.querySelector('.btn-spinner');-->

<!--        if (!postButton) return;-->

<!--        postButton.disabled = loading;-->

<!--        if (loading) {-->
<!--            if (btnText) btnText.style.opacity = '0';-->
<!--            if (btnSpinner) btnSpinner.style.display = 'inline-block';-->
<!--        } else {-->
<!--            if (btnText) btnText.style.opacity = '1';-->
<!--            if (btnSpinner) btnSpinner.style.display = 'none';-->
<!--        }-->
<!--    }-->

<!--    // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã-->
<!--    function resetForm() {-->
<!--        console.log('üîÑ –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É...');-->
<!--        const postContent = document.getElementById('postContent');-->
<!--        const imageInput = document.getElementById('imageInput');-->
<!--        const imagePreview = document.getElementById('imagePreview');-->
<!--        const charCount = document.getElementById('charCount');-->
<!--        const postButton = document.getElementById('postButton');-->

<!--        if (postContent) postContent.value = '';-->
<!--        if (imageInput) imageInput.value = '';-->
<!--        if (imagePreview) imagePreview.style.display = 'none';-->
<!--        if (charCount) {-->
<!--            charCount.textContent = '0';-->
<!--            charCount.parentElement.className = 'char-counter';-->
<!--        }-->
<!--        if (postButton) postButton.disabled = true;-->
<!--    }-->

<!--    // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π-->
<!--    function showNotification(message, type = 'success') {-->
<!--        console.log('üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ:', type, message);-->

<!--        // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è-->
<!--        const existingNotifications = document.querySelectorAll('.notification');-->
<!--        existingNotifications.forEach(n => n.remove());-->

<!--        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ-->
<!--        const notification = document.createElement('div');-->
<!--        notification.className = `notification ${type}`;-->
<!--        notification.innerHTML = `-->
<!--            <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}" style="margin-right: 0.5rem;"></i>-->
<!--            ${message}-->
<!--        `;-->

<!--        document.body.appendChild(notification);-->

<!--        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ-->
<!--        setTimeout(() => {-->
<!--            notification.classList.add('show');-->
<!--        }, 100);-->

<!--        // –°–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã-->
<!--        setTimeout(() => {-->
<!--            notification.classList.remove('show');-->
<!--            setTimeout(() => {-->
<!--                if (notification.parentNode) {-->
<!--                    notification.parentNode.removeChild(notification);-->
<!--                }-->
<!--            }, 300);-->
<!--        }, 3000);-->
<!--    }-->

<!--    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ—Å—Ç–∞–º–∏-->
<!--    function navigateToPost(event, element) {-->
<!--        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª–∏–∫ –Ω–µ –±—ã–ª –ø–æ –∫–Ω–æ–ø–∫–µ –¥–µ–π—Å—Ç–≤–∏—è-->
<!--        if (event.target.closest('.action-btn') || event.target.closest('.post-author')) {-->
<!--            return;-->
<!--        }-->

<!--        const postId = element.getAttribute('data-post-id');-->
<!--        if (postId) {-->
<!--            window.location.href = `/posts/${postId}`;-->
<!--        }-->
<!--    }-->

<!--    function openComments(event, button) {-->
<!--        event.stopPropagation();-->
<!--        const postId = button.getAttribute('data-post-id');-->
<!--        if (postId) {-->
<!--            window.location.href = `/posts/${postId}#comments`;-->
<!--        }-->
<!--    }-->

<!--    async function toggleLike(event, button) {-->
<!--        event.stopPropagation();-->
<!--        const postId = button.getAttribute('data-post-id');-->

<!--        if (!postId) return;-->

<!--        try {-->
<!--            const response = await fetch(`/posts/${postId}/like`, {-->
<!--                method: 'POST',-->
<!--                headers: {-->
<!--                    'Content-Type': 'application/json'-->
<!--                }-->
<!--            });-->

<!--            if (response.ok) {-->
<!--                const result = await response.json();-->

<!--                // –û–±–Ω–æ–≤–ª—è–µ–º UI-->
<!--                const icon = button.querySelector('i');-->
<!--                const count = button.querySelector('span');-->

<!--                if (result.liked) {-->
<!--                    button.classList.add('liked');-->
<!--                    icon.classList.remove('far');-->
<!--                    icon.classList.add('fas');-->
<!--                } else {-->
<!--                    button.classList.remove('liked');-->
<!--                    icon.classList.remove('fas');-->
<!--                    icon.classList.add('far');-->
<!--                }-->

<!--                count.textContent = result.likesCount;-->
<!--            }-->
<!--        } catch (error) {-->
<!--            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ª–∞–π–∫–µ:', error);-->
<!--            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ª–∞–π–∫–∞', 'error');-->
<!--        }-->
<!--    }-->

<!--    function sharePost(event, button) {-->
<!--        event.stopPropagation();-->
<!--        const postId = button.getAttribute('data-post-id');-->

<!--        if (navigator.share) {-->
<!--            navigator.share({-->
<!--                title: '–ü–æ—Å—Ç –∏–∑ Cleopatra',-->
<!--                url: `${window.location.origin}/posts/${postId}`-->
<!--            });-->
<!--        } else {-->
<!--            // Fallback - –∫–æ–ø–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞-->
<!--            const url = `${window.location.origin}/posts/${postId}`;-->
<!--            navigator.clipboard.writeText(url).then(() => {-->
<!--                showNotification('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');-->
<!--            }).catch(() => {-->
<!--                showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É', 'error');-->
<!--            });-->
<!--        }-->
<!--    }-->

<!--    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã-->
<!--    document.addEventListener('DOMContentLoaded', function() {-->
<!--        initializePostComposer();-->

<!--        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ –ø–æ–¥–ø–∏—Å–∫–∏-->
<!--        document.querySelectorAll('.follow-btn').forEach(btn => {-->
<!--            btn.addEventListener('click', function() {-->
<!--                if (this.textContent === '–ß–∏—Ç–∞—Ç—å') {-->
<!--                    this.textContent = '–ß–∏—Ç–∞–µ–º';-->
<!--                    this.style.background = '#10b981';-->
<!--                } else {-->
<!--                    this.textContent = '–ß–∏—Ç–∞—Ç—å';-->
<!--                    this.style.background = '';-->
<!--                }-->
<!--            });-->
<!--        });-->

<!--        // –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è tool buttons-->
<!--        document.querySelectorAll('.tool-btn').forEach(btn => {-->
<!--            btn.addEventListener('click', function() {-->
<!--                this.style.transform = 'scale(0.95)';-->
<!--                setTimeout(() => {-->
<!--                    this.style.transform = '';-->
<!--                }, 150);-->
<!--            });-->
<!--        });-->

<!--        console.log('üê¶ Dashboard –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');-->
<!--        console.log('üìù Composer –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ');-->
<!--        console.log('üë• –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω—ã');-->
<!--    });-->

<!--    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –µ—Å–ª–∏ DOM —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω-->
<!--    if (document.readyState === 'loading') {-->
<!--        document.addEventListener('DOMContentLoaded', initializePostComposer);-->
<!--    } else {-->
<!--        initializePostComposer();-->
<!--    }-->

<!--    console.log('üìù –°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω');-->
<!--</script>-->
<!--</body>-->
<!--</html>-->


<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–ª–∞–≤–Ω–∞—è - Cleopatra</title>

    <!-- External CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap"
          rel="stylesheet">

    <style>
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
        body {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-accent) 100%);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-weight: 400;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Layout Grid */
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 0;
            min-height: 100vh;
            margin-left: 280px; /* –û—Ç—Å—Ç—É–ø –¥–ª—è sidebar */
        }

        /* Main Content Area */
        .content-area {
            max-width: 600px;
            margin: 0 auto;
            padding: 0;
            border-left: 1px solid var(--border-primary);
            border-right: 1px solid var(--border-primary);
            background: var(--bg-secondary);
            min-height: 100vh;
        }

        /* Header */
        .content-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-secondary);
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.25rem;
            font-weight: 600;
            margin: 0;
            color: var(--text-primary);
        }

        /* Create Post Section */
        .create-post {
            padding: 1.5rem;
            border-bottom: 8px solid var(--border-secondary);
            background: var(--bg-secondary);
        }

        .post-composer {
            display: flex;
            gap: 1rem;
        }

        .composer-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
            flex-shrink: 0;
            box-shadow: var(--shadow-sm);
            overflow: hidden;
        }

        .composer-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .composer-content {
            flex: 1;
        }

        .post-textarea {
            width: 100%;
            border: none;
            outline: none;
            background: transparent;
            font-size: 1.25rem;
            color: var(--text-primary);
            resize: none;
            min-height: 120px;
            font-family: inherit;
            line-height: 1.5;
        }

        .post-textarea::placeholder {
            color: var(--text-muted);
        }

        .composer-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-secondary);
        }

        .composer-tools {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .tool-btn {
            background: none;
            border: none;
            color: var(--accent-primary);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--radius-sm);
            transition: all 0.2s;
            font-size: 1.125rem;
        }

        .tool-btn:hover {
            background: rgba(37, 99, 235, 0.1);
            transform: scale(1.05);
        }

        .post-btn {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 9999px;
            font-weight: 600;
            font-size: 0.9375rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            letter-spacing: 0.01em;
            position: relative;
            min-width: 120px;
        }

        .post-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .post-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .post-btn:disabled .btn-text {
            opacity: 0;
        }

        .post-btn:not(:disabled) .btn-spinner {
            display: none !important;
        }

        .btn-spinner {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        /* Image Preview */
        .image-preview {
            position: relative;
            margin: 1rem 0;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border-primary, #e5e7eb);
        }

        .preview-image {
            width: 100%;
            max-height: 300px;
            object-fit: cover;
        }

        .remove-image-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 12px;
        }

        .remove-image-btn:hover {
            background: #dc2626;
            transform: scale(1.1);
        }

        /* Character Counter */
        .char-counter {
            font-size: 0.875rem;
            color: var(--text-muted, #6b7280);
            margin-left: auto;
            margin-right: 1rem;
        }

        .char-counter.warning {
            color: #f59e0b;
        }

        .char-counter.danger {
            color: #dc2626;
        }

        /* Feed Section */
        .feed {
            background: var(--bg-secondary);
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø–æ—Å—Ç–æ–≤ */
        .posts-container {
            display: flex;
            flex-direction: column;
        }

        .post-item {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-secondary);
            transition: background-color 0.2s;
            cursor: pointer;
            animation: slideIn 0.3s ease-out;
        }

        .post-item:hover {
            background: var(--bg-accent);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .post-header {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .post-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--bg-accent), #f1f5f9);
            flex-shrink: 0;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
        }

        .post-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .default-avatar {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .post-meta {
            flex: 1;
        }

        .post-author {
            font-weight: 600;
            color: var(--text-primary);
            margin-right: 0.5rem;
            text-decoration: none;
        }

        .post-author:hover {
            color: var(--accent-primary);
            text-decoration: underline;
        }

        .post-handle {
            color: var(--text-muted);
            font-size: 0.9375rem;
        }

        .post-time {
            color: var(--text-muted);
            font-size: 0.875rem;
            margin-left: 0.5rem;
        }

        .post-content {
            margin-left: 3rem;
            color: var(--text-primary);
            line-height: 1.6;
            margin-bottom: 1rem;
            word-wrap: break-word;
        }

        .post-image {
            margin-left: 3rem;
            margin-bottom: 1rem;
            border-radius: 12px;
            max-width: calc(100% - 3rem);
            height: auto;
            border: 1px solid var(--border-secondary);
        }

        .post-actions {
            margin-left: 3rem;
            display: flex;
            gap: 2rem;
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--radius-sm);
            transition: all 0.2s;
            font-size: 0.875rem;
        }

        .action-btn:hover {
            color: var(--accent-primary);
            background: rgba(37, 99, 235, 0.1);
        }

        .action-btn.liked {
            color: #ef4444;
        }

        .action-btn.retweeted {
            color: #10b981;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loading-indicator {
            display: none;
            padding: 20px;
            text-align: center;
            border-top: 1px solid #eee;
            margin-top: 20px;
        }

        .loading-spinner {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            color: #666;
        }

        .loading-spinner i {
            font-size: 24px;
            color: #1da1f2;
        }

        .loading-spinner span {
            font-size: 14px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –ø–æ—Å—Ç–æ–≤ */
        .no-more-posts {
            display: none;
            padding: 20px;
            text-align: center;
            border-top: 1px solid #eee;
            margin-top: 20px;
            color: #666;
        }

        .no-more-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .no-more-content i {
            font-size: 20px;
            color: #4caf50;
        }

        .no-more-content span {
            font-size: 14px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ */
        .error-message {
            display: none;
            padding: 20px;
            text-align: center;
            border-top: 1px solid #eee;
            margin-top: 20px;
            background-color: #ffebee;
            border-radius: 8px;
        }

        .error-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            color: #d32f2f;
        }

        .error-content i {
            font-size: 20px;
        }

        .retry-btn {
            background-color: #1da1f2;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 8px;
            transition: background-color 0.2s;
        }

        .retry-btn:hover {
            background-color: #1991db;
        }

        /* Empty State */
        .empty-feed {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-muted);
        }

        .empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .empty-description {
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 2rem;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .empty-action {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--accent-primary);
            color: white;
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .empty-action:hover {
            background: var(--accent-secondary);
            transform: translateY(-1px);
            color: white;
            text-decoration: none;
        }

        /* View More Button */
        .view-more-container {
            text-align: center;
            margin-top: 2rem;
            padding: 1.5rem;
            border-top: 1px solid var(--border-secondary);
        }

        .view-more-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: var(--accent-primary);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .view-more-btn:hover {
            background: var(--accent-secondary);
            transform: translateY(-1px);
            text-decoration: none;
            color: white;
        }

        .view-more-btn i {
            font-size: 0.9rem;
        }

        /* Right Sidebar */
        .right-sidebar {
            padding: 1rem;
            background: var(--bg-primary);
            overflow-y: auto;
            max-height: 100vh;
        }

        /* Widget Styles */
        .widget {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            margin-bottom: 1.5rem;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-secondary);
        }

        .widget-header {
            padding: 1.25rem 1.5rem 1rem;
            border-bottom: 1px solid var(--border-secondary);
        }

        .widget-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .widget-content {
            padding: 1rem 1.5rem 1.5rem;
        }

        /* Trending Widget */
        .trending-item {
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-secondary);
            transition: all 0.2s;
            cursor: pointer;
        }

        .trending-item:last-child {
            border-bottom: none;
        }

        .trending-item:hover {
            background: var(--bg-accent);
            margin: 0 -1.5rem;
            padding-left: 1.5rem;
            padding-right: 1.5rem;
        }

        .trending-topic {
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 0.25rem 0;
            font-size: 0.9375rem;
        }

        .trending-count {
            color: var(--text-muted);
            font-size: 0.8125rem;
            margin: 0;
        }

        /* Suggestions Widget */
        .suggestion-item {
            display: flex;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-secondary);
            transition: all 0.2s;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-item:hover {
            background: var(--bg-accent);
            margin: 0 -1.5rem;
            padding-left: 1.5rem;
            padding-right: 1.5rem;
        }

        .suggestion-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--bg-accent), #f1f5f9);
            margin-right: 0.75rem;
            flex-shrink: 0;
        }

        .suggestion-info {
            flex: 1;
        }

        .suggestion-name {
            font-weight: 600;
            font-size: 0.9375rem;
            color: var(--text-primary);
            margin: 0 0 0.25rem;
        }

        .suggestion-handle {
            font-size: 0.8125rem;
            color: var(--text-muted);
            margin: 0;
        }

        .follow-btn {
            background: var(--accent-primary);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-weight: 500;
            font-size: 0.8125rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .follow-btn:hover {
            background: var(--accent-secondary);
            transform: translateY(-1px);
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.success {
            background: linear-gradient(135deg, #059669, #10b981);
        }

        .notification.error {
            background: linear-gradient(135deg, #dc2626, #ef4444);
        }

        .notification.show {
            transform: translateX(0);
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr 300px;
            }
        }

        @media (max-width: 1024px) {
            .main-layout {
                margin-left: 80px;
                grid-template-columns: 1fr 280px;
            }
        }

        @media (max-width: 768px) {
            .main-layout {
                grid-template-columns: 1fr;
                margin-left: 0;
                margin-top: 60px;
            }

            .content-area {
                border-left: none;
                border-right: none;
            }

            .right-sidebar {
                display: none;
            }

            .post-content,
            .post-actions,
            .post-image {
                margin-left: 0;
            }

            .view-more-container {
                margin-top: 1.5rem;
                padding: 1rem;
            }

            .view-more-btn {
                padding: 0.625rem 1.25rem;
                font-size: 0.9rem;
            }

            .loading-indicator,
            .no-more-posts,
            .error-message {
                margin: 15px;
                padding: 15px;
            }

            .loading-spinner,
            .no-more-content,
            .error-content {
                gap: 8px;
            }

            .loading-spinner i,
            .no-more-content i,
            .error-content i {
                font-size: 18px;
            }

            .loading-spinner span,
            .no-more-content span,
            .error-content {
                font-size: 13px;
            }
        }

        @media (max-width: 480px) {
            .post-composer {
                flex-direction: column;
                gap: 1rem;
            }

            .composer-avatar {
                align-self: flex-start;
            }

            .post-actions {
                justify-content: space-around;
                gap: 1rem;
            }
        }
    </style>
    <!-- Sidebar Styles -->
    <th:block th:replace="~{fragments/sidebar :: sidebar-styles}"></th:block>
</head>
<body>

<!-- Mobile Header -->
<th:block th:replace="~{fragments/sidebar :: mobile-header}"></th:block>

<!-- Sidebar -->
<th:block th:replace="~{fragments/sidebar :: sidebar(${activeSection})}"></th:block>

<div class="main-layout">
    <!-- Main Content Area -->
    <main class="content-area">
        <!-- Header -->
        <div class="content-header">
            <h1 class="header-title">–ì–ª–∞–≤–Ω–∞—è</h1>
        </div>

        <!-- Create Post Section —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π AJAX -->
        <div class="create-post">
            <div class="post-composer">
                <div class="composer-avatar">
                    <i class="fas fa-user" th:if="${currentUser?.imageUrl == null}"></i>
                    <img th:if="${currentUser?.imageUrl}" th:src="${currentUser.imageUrl}" alt="Avatar"
                         style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                </div>
                <div class="composer-content">
                    <!-- –§–æ—Ä–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞ -->
                    <form id="createPostForm" enctype="multipart/form-data">
                <textarea
                        class="post-textarea"
                        placeholder="–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?"
                        maxlength="1000"
                        id="postContent"
                        name="content"
                        required></textarea>

                        <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
                        <input type="file"
                               id="imageInput"
                               name="image"
                               accept="image/jpeg,image/jpg,image/png,image/heif,image/heic"
                               style="display: none;">

                        <!-- –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
                        <div id="imagePreview" class="image-preview" style="display: none;">
                            <img id="previewImg" src="" alt="Preview" class="preview-image">
                            <button type="button" class="remove-image-btn" onclick="removeImage()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>

                        <div class="composer-actions">
                            <div class="composer-tools">
                                <button type="button" class="tool-btn" title="–î–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" onclick="selectImage()">
                                    <i class="fas fa-image"></i>
                                </button>
                                <button type="button" class="tool-btn" title="–î–æ–±–∞–≤–∏—Ç—å GIF">
                                    <i class="fas fa-photo-video"></i>
                                </button>
                                <button type="button" class="tool-btn" title="–°–æ–∑–¥–∞—Ç—å –æ–ø—Ä–æ—Å">
                                    <i class="fas fa-poll"></i>
                                </button>
                                <button type="button" class="tool-btn" title="–î–æ–±–∞–≤–∏—Ç—å —ç–º–æ–¥–∑–∏">
                                    <i class="fas fa-smile"></i>
                                </button>

                                <!-- –°—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤ -->
                                <div class="char-counter">
                                    <span id="charCount">0</span>/1000
                                </div>
                            </div>
                            <button type="submit" class="post-btn" id="postButton" disabled onclick="handleButtonClick(event)">
                                <span class="btn-text">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</span>
                                <i class="fas fa-spinner fa-spin btn-spinner" style="display: none;"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Feed -->
        <div class="feed" id="feed">
            <!-- –ï—Å–ª–∏ –µ—Å—Ç—å –ø–æ—Å—Ç—ã -->
            <div th:if="${recentPosts != null and !recentPosts.posts.empty}" class="posts-container">
                <div class="post-item" th:each="post : ${recentPosts.posts}"
                     onclick="navigateToPost(event, this)"
                     th:data-post-id="${post.id}">

                    <div class="post-header">
                        <a th:href="@{/profile/{userId}(userId=${post.author.id})}" class="post-avatar">
                            <img th:if="${post.author.imageUrl}"
                                 th:src="${post.author.imageUrl}"
                                 th:alt="${post.author.firstName + ' ' + post.author.lastName}">
                            <div th:unless="${post.author.imageUrl}" class="default-avatar">
                                <span th:text="${#strings.substring(post.author.firstName, 0, 1) + #strings.substring(post.author.lastName, 0, 1)}">AB</span>
                            </div>
                        </a>

                        <div class="post-meta">
                            <a th:href="@{/profile/{userId}(userId=${post.author.id})}" class="post-author">
                                <span th:text="${post.author.firstName + ' ' + post.author.lastName}">–ò–º—è –ê–≤—Ç–æ—Ä–∞</span>
                            </a>
                            <span class="post-handle" th:text="'@' + ${post.author.firstName?.toLowerCase()}">@–∞–≤—Ç–æ—Ä</span>
                            <span class="post-time" th:text="'¬∑ ' + ${#temporals.format(post.createdAt, 'HH:mm', new java.util.Locale('ru'))}">¬∑ 2—á</span>
                        </div>
                    </div>

                    <div class="post-content" th:text="${post.content}">
                        –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ—Å—Ç–∞...
                    </div>

                    <img th:if="${post.hasImage}"
                         th:src="${post.imageUrl}"
                         alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—Å—Ç–∞"
                         class="post-image">

                    <div class="post-actions">
                        <button class="action-btn comment-btn" onclick="openComments(event, this)"
                                th:data-post-id="${post.id}">
                            <i class="fas fa-comment"></i>
                            <span th:text="${post.commentsCount}">0</span>
                        </button>

                        <button class="action-btn like-btn" onclick="toggleLike(event, this)"
                                th:data-post-id="${post.id}">
                            <i class="fas fa-heart"></i>
                            <span th:text="${post.likesCount}">0</span>
                        </button>

                        <button class="action-btn share-btn" onclick="sharePost(event, this)"
                                th:data-post-id="${post.id}">
                            <i class="fas fa-share"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- –ï—Å–ª–∏ –Ω–µ—Ç –ø–æ—Å—Ç–æ–≤ -->
            <div th:unless="${recentPosts != null and !recentPosts.posts.empty}" class="empty-feed">
                <div class="empty-icon">
                    <i class="fas fa-rss"></i>
                </div>
                <h3 class="empty-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h3>
                <p class="empty-description">
                    –í–∞—à–∞ –ª–µ–Ω—Ç–∞ –ø—É—Å—Ç–∞. –ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö –ª—é–¥–µ–π, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –∏—Ö –ø–æ—Å—Ç—ã –∑–¥–µ—Å—å.
                    <br>–ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –ø–æ—Å—Ç!
                </p>
                <a href="/recommendations" class="empty-action">
                    <i class="fas fa-user-plus"></i>
                    –ù–∞–π—Ç–∏ –ª—é–¥–µ–π
                </a>
            </div>
        </div>

        <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–ª–Ω—É—é –ª–µ–Ω—Ç—É (—Å–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏) -->
        <div th:if="${recentPosts != null and !recentPosts.posts.empty}" class="view-more-container" id="viewMoreContainer" style="display: none;">
            <a href="/feed" class="view-more-btn">
                <i class="fas fa-arrow-right"></i>
                –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å—é –ª–µ–Ω—Ç—É
            </a>
        </div>

    </main>

    <!-- Right Sidebar -->
    <aside class="right-sidebar">
        <!-- Trending Topics -->
        <div class="widget">
            <div class="widget-header">
                <h3 class="widget-title">–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ç–µ–º—ã</h3>
            </div>
            <div class="widget-content">
                <div class="trending-item">
                    <p class="trending-topic">#–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏–ë—É–¥—É—â–µ–≥–æ</p>
                    <p class="trending-count">12.5K –æ–±—Å—É–∂–¥–µ–Ω–∏–π</p>
                </div>
                <div class="trending-item">
                    <p class="trending-topic">#–î–∏–∑–∞–π–Ω–¢—Ä–µ–Ω–¥—ã2025</p>
                    <p class="trending-count">8.3K –æ–±—Å—É–∂–¥–µ–Ω–∏–π</p>
                </div>
                <div class="trending-item">
                    <p class="trending-topic">#–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç</p>
                    <p class="trending-count">15.7K –æ–±—Å—É–∂–¥–µ–Ω–∏–π</p>
                </div>
                <div class="trending-item">
                    <p class="trending-topic">#Web–î–µ–≤–µ–ª–æ–ø–º–µ–Ω—Ç</p>
                    <p class="trending-count">6.2K –æ–±—Å—É–∂–¥–µ–Ω–∏–π</p>
                </div>
                <div class="trending-item">
                    <p class="trending-topic">#–£–¥–∞–ª–µ–Ω–Ω–∞—è–†–∞–±–æ—Ç–∞</p>
                    <p class="trending-count">9.1K –æ–±—Å—É–∂–¥–µ–Ω–∏–π</p>
                </div>
            </div>
        </div>

        <!-- Who to Follow -->
        <div class="widget">
            <div class="widget-header">
                <h3 class="widget-title">–ö–æ–≥–æ —á–∏—Ç–∞—Ç—å</h3>
            </div>
            <div class="widget-content">
                <div class="suggestion-item">
                    <div class="suggestion-avatar"></div>
                    <div class="suggestion-info">
                        <p class="suggestion-name">–î–º–∏—Ç—Ä–∏–π –ö–æ–∑–ª–æ–≤</p>
                        <p class="suggestion-handle">@alex_startup</p>
                    </div>
                    <button class="follow-btn">–ß–∏—Ç–∞—Ç—å</button>
                </div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="widget">
            <div class="widget-header">
                <h3 class="widget-title">–í–∞—à–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h3>
            </div>
            <div class="widget-content">
                <div class="trending-item">
                    <p class="trending-topic">–ü—Ä–æ—Å–º–æ—Ç—Ä—ã –ø—Ä–æ—Ñ–∏–ª—è</p>
                    <p class="trending-count">47 –∑–∞ —ç—Ç—É –Ω–µ–¥–µ–ª—é</p>
                </div>
                <div class="trending-item">
                    <p class="trending-topic">–£–ø–æ–º–∏–Ω–∞–Ω–∏—è</p>
                    <p class="trending-count">12 –Ω–æ–≤—ã—Ö</p>
                </div>
                <div class="trending-item">
                    <p class="trending-topic">–ü–æ–¥–ø–∏—Å—á–∏–∫–∏</p>
                    <p class="trending-count">+5 –∑–∞ –¥–µ–Ω—å</p>
                </div>
            </div>
        </div>

        <!-- Footer Links -->
        <div style="padding: 1rem 0; font-size: 0.8125rem; color: var(--text-muted); line-height: 1.4;">
            <a href="/terms" style="color: inherit; text-decoration: none; margin-right: 1rem;">–£—Å–ª–æ–≤–∏—è</a>
            <a href="/privacy" style="color: inherit; text-decoration: none; margin-right: 1rem;">–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</a>
            <a href="/help" style="color: inherit; text-decoration: none;">–ü–æ–º–æ—â—å</a>
            <p style="margin-top: 0.5rem; margin-bottom: 0;">¬© 2025 Cleopatra</p>
        </div>
    </aside>
</div>

<!-- JS –≤ –∫–æ–Ω—Ü–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
<th:block th:replace="~{fragments/sidebar :: sidebar-scripts}"></th:block>

<script>
    // ============================================
    // –ü–ï–†–ï–ú–ï–ù–ù–´–ï –î–õ–Ø –ë–ï–°–ö–û–ù–ï–ß–ù–û–ô –ó–ê–ì–†–£–ó–ö–ò
    // ============================================
    let currentPage = 1; // –ù–∞—á–∏–Ω–∞–µ–º —Å 1, —Ç–∞–∫ –∫–∞–∫ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ 0 —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞
    let isLoading = false;
    let hasMorePosts = true;
    const postsPerPage = 10;

    // ============================================
    // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ë–ï–°–ö–û–ù–ï–ß–ù–û–ô –ó–ê–ì–†–£–ó–ö–ò
    // ============================================

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è HTML –ø–æ—Å—Ç–∞
    function createPostHTML(post) {
        const authorInitials = post.author.firstName.substring(0, 1) + post.author.lastName.substring(0, 1);
        const authorFullName = post.author.firstName + ' ' + post.author.lastName;
        const postTime = new Date(post.createdAt).toLocaleTimeString('ru-RU', {
            hour: '2-digit',
            minute: '2-digit'
        });

        return `
            <div class="post-item" onclick="navigateToPost(event, this)" data-post-id="${post.id}">
                <div class="post-header">
                    <a href="/profile/${post.author.id}" class="post-avatar">
                        ${post.author.imageUrl ?
            `<img src="${post.author.imageUrl}" alt="${authorFullName}">` :
            `<div class="default-avatar"><span>${authorInitials}</span></div>`
        }
                    </a>

                    <div class="post-meta">
                        <a href="/profile/${post.author.id}" class="post-author">
                            <span>${authorFullName}</span>
                        </a>
                        <span class="post-handle">@${post.author.firstName.toLowerCase()}</span>
                        <span class="post-time">¬∑ ${postTime}</span>
                    </div>
                </div>

                <div class="post-content">${post.content}</div>

                ${post.hasImage ? `<img src="${post.imageUrl}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—Å—Ç–∞" class="post-image">` : ''}

                <div class="post-actions">
                    <button class="action-btn comment-btn" onclick="openComments(event, this)" data-post-id="${post.id}">
                        <i class="fas fa-comment"></i>
                        <span>${post.commentsCount}</span>
                    </button>

                    <button class="action-btn like-btn" onclick="toggleLike(event, this)" data-post-id="${post.id}">
                        <i class="fas fa-heart"></i>
                        <span>${post.likesCount}</span>
                    </button>

                    <button class="action-btn share-btn" onclick="sharePost(event, this)" data-post-id="${post.id}">
                        <i class="fas fa-share"></i>
                    </button>
                </div>
            </div>
        `;
    }

    // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç–æ–≤
    async function loadMorePosts() {
        if (isLoading || !hasMorePosts) {
            return;
        }

        isLoading = true;
        showLoadingIndicator();

        try {
            const response = await fetch(`/feed/api/posts?page=${currentPage}&size=${postsPerPage}`);
            if (!response.ok) {
                throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç–æ–≤');
            }

            const data = await response.json();

            if (data.posts && data.posts.length > 0) {
                appendPostsToFeed(data.posts);
                currentPage++;

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –µ—â–µ –ø–æ—Å—Ç—ã
                hasMorePosts = data.posts.length === postsPerPage;
            } else {
                hasMorePosts = false;
                showNoMorePostsMessage();
            }

        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ—Å—Ç–æ–≤:', error);
            showErrorMessage();
        } finally {
            isLoading = false;
            hideLoadingIndicator();
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å—Ç–æ–≤ –≤ –ª–µ–Ω—Ç—É
    function appendPostsToFeed(posts) {
        const feedContainer = document.getElementById('feed');
        let existingPostsContainer = feedContainer.querySelector('.posts-container');

        // –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞–µ–º –µ–≥–æ
        if (!existingPostsContainer) {
            existingPostsContainer = document.createElement('div');
            existingPostsContainer.className = 'posts-container';

            // –í—Å—Ç–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ—Å–ª–µ —Å–µ–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞, –Ω–æ –¥–æ empty-feed
            const emptyFeed = feedContainer.querySelector('.empty-feed');
            if (emptyFeed) {
                feedContainer.insertBefore(existingPostsContainer, emptyFeed);
                emptyFeed.style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º empty state
            } else {
                feedContainer.appendChild(existingPostsContainer);
            }
        }

        posts.forEach(post => {
            const postElement = document.createElement('div');
            postElement.innerHTML = createPostHTML(post);
            existingPostsContainer.appendChild(postElement.firstElementChild);
        });
    }

    // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏
    function showLoadingIndicator() {
        let loadingIndicator = document.getElementById('loading-indicator');

        if (!loadingIndicator) {
            loadingIndicator = document.createElement('div');
            loadingIndicator.id = 'loading-indicator';
            loadingIndicator.className = 'loading-indicator';
            loadingIndicator.innerHTML = `
                <div class="loading-spinner">
                    <i class="fas fa-spinner fa-spin"></i>
                    <span>–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–æ–≤...</span>
                </div>
            `;
            document.getElementById('feed').appendChild(loadingIndicator);
        }

        loadingIndicator.style.display = 'block';
    }

    // –§—É–Ω–∫—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏
    function hideLoadingIndicator() {
        const loadingIndicator = document.getElementById('loading-indicator');
        if (loadingIndicator) {
            loadingIndicator.style.display = 'none';
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–æ—Å—Ç–æ–≤
    function showNoMorePostsMessage() {
        let noMoreMessage = document.getElementById('no-more-posts');

        if (!noMoreMessage) {
            noMoreMessage = document.createElement('div');
            noMoreMessage.id = 'no-more-posts';
            noMoreMessage.className = 'no-more-posts';
            noMoreMessage.innerHTML = `
                <div class="no-more-content">
                    <i class="fas fa-check-circle"></i>
                    <span>–í—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–ª–∏ –≤—Å–µ –ø–æ—Å—Ç—ã</span>
                </div>
            `;
            document.getElementById('feed').appendChild(noMoreMessage);
        }

        noMoreMessage.style.display = 'block';
    }

    // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
    function showErrorMessage() {
        let errorMessage = document.getElementById('error-message');

        if (!errorMessage) {
            errorMessage = document.createElement('div');
            errorMessage.id = 'error-message';
            errorMessage.className = 'error-message';
            errorMessage.innerHTML = `
                <div class="error-content">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</span>
                    <button onclick="retryLoading()" class="retry-btn">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
                </div>
            `;
            document.getElementById('feed').appendChild(errorMessage);
        }

        errorMessage.style.display = 'block';
    }

    // –§—É–Ω–∫—Ü–∏—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
    function retryLoading() {
        const errorMessage = document.getElementById('error-message');
        if (errorMessage) {
            errorMessage.style.display = 'none';
        }
        loadMorePosts();
    }

    // –§—É–Ω–∫—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∫–æ–Ω—Ü–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    function isNearBottom() {
        const threshold = 200; // –ó–∞–≥—Ä—É–∂–∞—Ç—å –∑–∞ 200px –¥–æ –∫–æ–Ω—Ü–∞
        return window.innerHeight + window.scrollY >= document.body.offsetHeight - threshold;
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∫—Ä–æ–ª–ª–∞ —Å throttling
    let scrollTimeout;
    function handleScroll() {
        if (scrollTimeout) {
            clearTimeout(scrollTimeout);
        }

        scrollTimeout = setTimeout(() => {
            if (isNearBottom()) {
                loadMorePosts();
            }
        }, 100); // Throttling –Ω–∞ 100ms
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
    function initInfiniteScroll() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –ø–æ—Å—Ç—ã
        const existingPosts = document.querySelectorAll('.post-item');
        if (existingPosts.length > 0) {
            // –ï—Å–ª–∏ –µ—Å—Ç—å –ø–æ—Å—Ç—ã, –∑–Ω–∞—á–∏—Ç –º—ã —É–∂–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ 0, —Å–ª–µ–¥—É—é—â–∞—è –±—É–¥–µ—Ç 1
            currentPage = 1;
            hasMorePosts = existingPosts.length === postsPerPage;
        } else {
            // –ï—Å–ª–∏ –ø–æ—Å—Ç–æ–≤ –Ω–µ—Ç, –Ω–∞—á–∏–Ω–∞–µ–º —Å 0
            currentPage = 0;
            hasMorePosts = true;
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∫—Ä–æ–ª–ª–∞
        window.addEventListener('scroll', handleScroll);

        console.log('–ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
    }

    // –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (–¥–ª—è SPA)
    function destroyInfiniteScroll() {
        window.removeEventListener('scroll', handleScroll);
        if (scrollTimeout) {
            clearTimeout(scrollTimeout);
        }
    }

    // ============================================
    // –û–†–ò–ì–ò–ù–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –°–û–ó–î–ê–ù–ò–Ø –ü–û–°–¢–û–í
    // ============================================

    console.log('üöÄ –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–æ–≤...');

    // –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ - –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ DOM –≥–æ—Ç–æ–≤
    function initializePostComposer() {
        console.log('üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è composer...');

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        const postContent = document.getElementById('postContent');
        const postButton = document.getElementById('postButton');
        const charCount = document.getElementById('charCount');
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');
        const previewImg = document.getElementById('previewImg');
        const createPostForm = document.getElementById('createPostForm');

        console.log('üìã –≠–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã:', {
            postContent: !!postContent,
            postButton: !!postButton,
            charCount: !!charCount,
            imageInput: !!imageInput,
            createPostForm: !!createPostForm
        });

        if (!postContent || !postButton || !createPostForm) {
            console.error('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã!');
            return;
        }

        // –°—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
        postContent.addEventListener('input', function() {
            console.log('üìù –í–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞:', this.value.length);
            const length = this.value.length;
            const maxLength = 1000;

            if (charCount) {
                charCount.textContent = length;

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∏–ª—å —Å—á–µ—Ç—á–∏–∫–∞
                const counter = charCount.parentElement;
                counter.className = 'char-counter';
                if (length > maxLength * 0.9) {
                    counter.classList.add('warning');
                }
                if (length > maxLength * 0.95) {
                    counter.classList.remove('warning');
                    counter.classList.add('danger');
                }
            }

            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º/–¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
            const isValid = length > 0 && length <= maxLength;
            postButton.disabled = !isValid;
            console.log('üîò –ö–Ω–æ–ø–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞:', isValid);
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        if (imageInput) {
            imageInput.addEventListener('change', function(event) {
                console.log('üñºÔ∏è –í—ã–±—Ä–∞–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
                handleImageSelect(event);
            });
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
        createPostForm.addEventListener('submit', function(event) {
            console.log('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã...');
            handleFormSubmit(event);
        });

        console.log('‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
    }

    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
    function selectImage() {
        console.log('üñºÔ∏è –û—Ç–∫—Ä—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è...');
        const imageInput = document.getElementById('imageInput');
        if (imageInput) {
            imageInput.click();
        } else {
            console.error('‚ùå imageInput –Ω–µ –Ω–∞–π–¥–µ–Ω');
        }
    }

    function handleImageSelect(event) {
        const file = event.target.files[0];
        if (!file) {
            console.log('‚ùå –§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω');
            return;
        }

        console.log('üìÅ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ñ–∞–π–ª:', file.name, file.type, file.size);

        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
        const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/heif', 'image/heic'];
        if (!allowedTypes.includes(file.type)) {
            showNotification('–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ JPG, PNG, HEIF –∏–ª–∏ HEIC.', 'error');
            event.target.value = '';
            return;
        }

        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (10MB)
        const maxSize = 10 * 1024 * 1024;
        if (file.size > maxSize) {
            showNotification('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10MB.', 'error');
            event.target.value = '';
            return;
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é
        const reader = new FileReader();
        reader.onload = function(e) {
            const previewImg = document.getElementById('previewImg');
            const imagePreview = document.getElementById('imagePreview');

            if (previewImg && imagePreview) {
                previewImg.src = e.target.result;
                imagePreview.style.display = 'block';
                console.log('‚úÖ –ü—Ä–µ–≤—å—é –ø–æ–∫–∞–∑–∞–Ω–æ');
            }
        };
        reader.readAsDataURL(file);
    }

    function removeImage() {
        console.log('üóëÔ∏è –£–¥–∞–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ...');
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');

        if (imageInput) imageInput.value = '';
        if (imagePreview) imagePreview.style.display = 'none';
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –∫–Ω–æ–ø–∫–∏ (–¥—É–±–ª–∏—Ä—É–µ—Ç submit)
    function handleButtonClick(event) {
        console.log('üñ±Ô∏è –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å');
        event.preventDefault();
        handleFormSubmit(event);
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
    async function handleFormSubmit(event) {
        event.preventDefault();
        console.log('üöÄ –ù–∞—á–∏–Ω–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã...');

        const postContent = document.getElementById('postContent');
        const imageInput = document.getElementById('imageInput');

        const content = postContent.value.trim();
        if (!content) {
            showNotification('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–∞', 'error');
            return;
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
        setLoadingState(true);

        try {
            // –°–æ–∑–¥–∞–µ–º FormData
            const formData = new FormData();
            formData.append('content', content);

            if (imageInput && imageInput.files[0]) {
                formData.append('image', imageInput.files[0]);
                console.log('üìé –î–æ–±–∞–≤–ª–µ–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫ –∑–∞–ø—Ä–æ—Å—É');
            }

            console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ /posts/api/create');

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
            const response = await fetch('/posts/api/create', {
                method: 'POST',
                body: formData
            });

            console.log('üì• –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç:', response.status, response.statusText);

            if (response.ok) {
                const result = await response.json();
                console.log('‚úÖ –ü–æ—Å—Ç —Å–æ–∑–¥–∞–Ω:', result);
                showNotification('–ü–æ—Å—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!', 'success');

                // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                resetForm();

                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–µ–Ω—Ç—É - –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø–æ—Å—Ç –≤ –Ω–∞—á–∞–ª–æ
                setTimeout(() => {
                    location.reload();
                }, 1000);

            } else {
                const errorText = await response.text();
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–≤–µ—Ç–∞:', errorText);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ—Å—Ç–∞: ' + response.status, 'error');
            }
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ—Å—Ç–∞:', error);
            showNotification('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ—Å—Ç–∞', 'error');
        } finally {
            setLoadingState(false);
        }
    }

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∑–∞–≥—Ä—É–∑–∫–∏
    function setLoadingState(loading) {
        console.log('‚è≥ –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏:', loading);
        const postButton = document.getElementById('postButton');
        const btnText = postButton?.querySelector('.btn-text');
        const btnSpinner = postButton?.querySelector('.btn-spinner');

        if (!postButton) return;

        postButton.disabled = loading;

        if (loading) {
            if (btnText) btnText.style.opacity = '0';
            if (btnSpinner) btnSpinner.style.display = 'inline-block';
        } else {
            if (btnText) btnText.style.opacity = '1';
            if (btnSpinner) btnSpinner.style.display = 'none';
        }
    }

    // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã
    function resetForm() {
        console.log('üîÑ –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É...');
        const postContent = document.getElementById('postContent');
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');
        const charCount = document.getElementById('charCount');
        const postButton = document.getElementById('postButton');

        if (postContent) postContent.value = '';
        if (imageInput) imageInput.value = '';
        if (imagePreview) imagePreview.style.display = 'none';
        if (charCount) {
            charCount.textContent = '0';
            charCount.parentElement.className = 'char-counter';
        }
        if (postButton) postButton.disabled = true;
    }

    // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    function showNotification(message, type = 'success') {
        console.log('üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ:', type, message);

        // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        const existingNotifications = document.querySelectorAll('.notification');
        existingNotifications.forEach(n => n.remove());

        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerHTML = `
            <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}" style="margin-right: 0.5rem;"></i>
            ${message}
        `;

        document.body.appendChild(notification);

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        setTimeout(() => {
            notification.classList.add('show');
        }, 100);

        // –°–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        }, 3000);
    }

    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ—Å—Ç–∞–º–∏
    function navigateToPost(event, element) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª–∏–∫ –Ω–µ –±—ã–ª –ø–æ –∫–Ω–æ–ø–∫–µ –¥–µ–π—Å—Ç–≤–∏—è
        if (event.target.closest('.action-btn') || event.target.closest('.post-author')) {
            return;
        }

        const postId = element.getAttribute('data-post-id');
        if (postId) {
            window.location.href = `/posts/${postId}`;
        }
    }

    function openComments(event, button) {
        event.stopPropagation();
        const postId = button.getAttribute('data-post-id');
        if (postId) {
            window.location.href = `/posts/${postId}#comments`;
        }
    }

    async function toggleLike(event, button) {
        event.stopPropagation();
        const postId = button.getAttribute('data-post-id');

        if (!postId) return;

        try {
            const response = await fetch(`/posts/${postId}/like`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                const result = await response.json();

                // –û–±–Ω–æ–≤–ª—è–µ–º UI
                const icon = button.querySelector('i');
                const count = button.querySelector('span');

                if (result.liked) {
                    button.classList.add('liked');
                    icon.classList.remove('far');
                    icon.classList.add('fas');
                } else {
                    button.classList.remove('liked');
                    icon.classList.remove('fas');
                    icon.classList.add('far');
                }

                count.textContent = result.likesCount;
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ª–∞–π–∫–µ:', error);
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ª–∞–π–∫–∞', 'error');
        }
    }

    function sharePost(event, button) {
        event.stopPropagation();
        const postId = button.getAttribute('data-post-id');

        if (navigator.share) {
            navigator.share({
                title: '–ü–æ—Å—Ç –∏–∑ Cleopatra',
                url: `${window.location.origin}/posts/${postId}`
            });
        } else {
            // Fallback - –∫–æ–ø–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
            const url = `${window.location.origin}/posts/${postId}`;
            navigator.clipboard.writeText(url).then(() => {
                showNotification('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
            }).catch(() => {
                showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É', 'error');
            });
        }
    }

    // ============================================
    // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
    // ============================================

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º composer
        initializePostComposer();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–µ—Å–∫–æ–Ω–µ—á–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É
        initInfiniteScroll();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ –ø–æ–¥–ø–∏—Å–∫–∏
        document.querySelectorAll('.follow-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                if (this.textContent === '–ß–∏—Ç–∞—Ç—å') {
                    this.textContent = '–ß–∏—Ç–∞–µ–º';
                    this.style.background = '#10b981';
                } else {
                    this.textContent = '–ß–∏—Ç–∞—Ç—å';
                    this.style.background = '';
                }
            });
        });

        // –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è tool buttons
        document.querySelectorAll('.tool-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                this.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    this.style.transform = '';
                }, 150);
            });
        });

        console.log('üê¶ Dashboard –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        console.log('üìù Composer –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ');
        console.log('üë• –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω—ã');
        console.log('‚ôæÔ∏è –ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –µ—Å–ª–∏ DOM —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            initializePostComposer();
            initInfiniteScroll();
        });
    } else {
        initializePostComposer();
        initInfiniteScroll();
    }

    // –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö —á–∞—Å—Ç—è—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    window.infiniteScroll = {
        init: initInfiniteScroll,
        destroy: destroyInfiniteScroll,
        loadMore: loadMorePosts
    };

    console.log('üìù –°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω');
    console.log('‚ôæÔ∏è –°–∫—Ä–∏–ø—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω');
</script>
</body>
</html>