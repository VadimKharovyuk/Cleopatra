<!--<!DOCTYPE html>-->
<!--<html lang="ru" xmlns:th="http://www.thymeleaf.org">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>Главная - Cleopatra</title>-->

<!--    &lt;!&ndash; External CSS &ndash;&gt;-->
<!--    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">-->
<!--    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">-->
<!--    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap"-->
<!--          rel="stylesheet">-->

<!--    <style>-->
<!--        /* Основные стили страницы */-->
<!--        body {-->
<!--            background: linear-gradient(135deg, var(&#45;&#45;bg-primary) 0%, var(&#45;&#45;bg-accent) 100%);-->
<!--            color: var(&#45;&#45;text-primary);-->
<!--            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;-->
<!--            font-weight: 400;-->
<!--            line-height: 1.6;-->
<!--            min-height: 100vh;-->
<!--        }-->

<!--        /* Layout Grid */-->
<!--        .main-layout {-->
<!--            display: grid;-->
<!--            grid-template-columns: 1fr 350px;-->
<!--            gap: 0;-->
<!--            min-height: 100vh;-->
<!--            margin-left: 280px; /* Отступ для sidebar */-->
<!--        }-->

<!--        /* Main Content Area */-->
<!--        .content-area {-->
<!--            max-width: 600px;-->
<!--            margin: 0 auto;-->
<!--            padding: 0;-->
<!--            border-left: 1px solid var(&#45;&#45;border-primary);-->
<!--            border-right: 1px solid var(&#45;&#45;border-primary);-->
<!--            background: var(&#45;&#45;bg-secondary);-->
<!--            min-height: 100vh;-->
<!--        }-->

<!--        /* Header */-->
<!--        .content-header {-->
<!--            padding: 1rem 1.5rem;-->
<!--            border-bottom: 1px solid var(&#45;&#45;border-secondary);-->
<!--            background: rgba(255, 255, 255, 0.8);-->
<!--            backdrop-filter: blur(20px);-->
<!--            position: sticky;-->
<!--            top: 0;-->
<!--            z-index: 100;-->
<!--        }-->

<!--        .header-title {-->
<!--            font-family: 'Playfair Display', serif;-->
<!--            font-size: 1.25rem;-->
<!--            font-weight: 600;-->
<!--            margin: 0;-->
<!--            color: var(&#45;&#45;text-primary);-->
<!--        }-->

<!--        /* Create Post Section */-->
<!--        .create-post {-->
<!--            padding: 1.5rem;-->
<!--            border-bottom: 8px solid var(&#45;&#45;border-secondary);-->
<!--            background: var(&#45;&#45;bg-secondary);-->
<!--        }-->

<!--        .post-composer {-->
<!--            display: flex;-->
<!--            gap: 1rem;-->
<!--        }-->

<!--        .composer-avatar {-->
<!--            width: 48px;-->
<!--            height: 48px;-->
<!--            border-radius: 50%;-->
<!--            background: linear-gradient(135deg, var(&#45;&#45;accent-primary), var(&#45;&#45;accent-secondary));-->
<!--            display: flex;-->
<!--            align-items: center;-->
<!--            justify-content: center;-->
<!--            color: white;-->
<!--            font-size: 1.25rem;-->
<!--            flex-shrink: 0;-->
<!--            box-shadow: var(&#45;&#45;shadow-sm);-->
<!--            overflow: hidden;-->
<!--        }-->

<!--        .composer-avatar img {-->
<!--            width: 100%;-->
<!--            height: 100%;-->
<!--            object-fit: cover;-->
<!--            border-radius: 50%;-->
<!--        }-->

<!--        .composer-content {-->
<!--            flex: 1;-->
<!--        }-->

<!--        .post-textarea {-->
<!--            width: 100%;-->
<!--            border: none;-->
<!--            outline: none;-->
<!--            background: transparent;-->
<!--            font-size: 1.25rem;-->
<!--            color: var(&#45;&#45;text-primary);-->
<!--            resize: none;-->
<!--            min-height: 120px;-->
<!--            font-family: inherit;-->
<!--            line-height: 1.5;-->
<!--        }-->

<!--        .post-textarea::placeholder {-->
<!--            color: var(&#45;&#45;text-muted);-->
<!--        }-->

<!--        .composer-actions {-->
<!--            display: flex;-->
<!--            justify-content: space-between;-->
<!--            align-items: center;-->
<!--            margin-top: 1rem;-->
<!--            padding-top: 1rem;-->
<!--            border-top: 1px solid var(&#45;&#45;border-secondary);-->
<!--        }-->

<!--        .composer-tools {-->
<!--            display: flex;-->
<!--            gap: 1rem;-->
<!--            align-items: center;-->
<!--        }-->

<!--        .tool-btn {-->
<!--            background: none;-->
<!--            border: none;-->
<!--            color: var(&#45;&#45;accent-primary);-->
<!--            cursor: pointer;-->
<!--            padding: 0.5rem;-->
<!--            border-radius: var(&#45;&#45;radius-sm);-->
<!--            transition: all 0.2s;-->
<!--            font-size: 1.125rem;-->
<!--        }-->

<!--        .tool-btn:hover {-->
<!--            background: rgba(37, 99, 235, 0.1);-->
<!--            transform: scale(1.05);-->
<!--        }-->

<!--        .post-btn {-->
<!--            background: linear-gradient(135deg, var(&#45;&#45;accent-primary), var(&#45;&#45;accent-secondary));-->
<!--            color: white;-->
<!--            border: none;-->
<!--            padding: 0.75rem 2rem;-->
<!--            border-radius: 9999px;-->
<!--            font-weight: 600;-->
<!--            font-size: 0.9375rem;-->
<!--            cursor: pointer;-->
<!--            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);-->
<!--            letter-spacing: 0.01em;-->
<!--            position: relative;-->
<!--            min-width: 120px;-->
<!--        }-->

<!--        .post-btn:hover {-->
<!--            transform: translateY(-2px);-->
<!--            box-shadow: var(&#45;&#45;shadow-lg);-->
<!--        }-->

<!--        .post-btn:disabled {-->
<!--            opacity: 0.5;-->
<!--            cursor: not-allowed;-->
<!--            transform: none;-->
<!--        }-->

<!--        .post-btn:disabled .btn-text {-->
<!--            opacity: 0;-->
<!--        }-->

<!--        .post-btn:not(:disabled) .btn-spinner {-->
<!--            display: none !important;-->
<!--        }-->

<!--        .btn-spinner {-->
<!--            position: absolute;-->
<!--            left: 50%;-->
<!--            top: 50%;-->
<!--            transform: translate(-50%, -50%);-->
<!--        }-->

<!--        /* Image Preview */-->
<!--        .image-preview {-->
<!--            position: relative;-->
<!--            margin: 1rem 0;-->
<!--            border-radius: 12px;-->
<!--            overflow: hidden;-->
<!--            border: 1px solid var(&#45;&#45;border-primary, #e5e7eb);-->
<!--        }-->

<!--        .preview-image {-->
<!--            width: 100%;-->
<!--            max-height: 300px;-->
<!--            object-fit: cover;-->
<!--        }-->

<!--        .remove-image-btn {-->
<!--            position: absolute;-->
<!--            top: 8px;-->
<!--            right: 8px;-->
<!--            background: rgba(0, 0, 0, 0.7);-->
<!--            color: white;-->
<!--            border: none;-->
<!--            border-radius: 50%;-->
<!--            width: 28px;-->
<!--            height: 28px;-->
<!--            display: flex;-->
<!--            align-items: center;-->
<!--            justify-content: center;-->
<!--            cursor: pointer;-->
<!--            transition: all 0.2s;-->
<!--            font-size: 12px;-->
<!--        }-->

<!--        .remove-image-btn:hover {-->
<!--            background: #dc2626;-->
<!--            transform: scale(1.1);-->
<!--        }-->

<!--        /* Character Counter */-->
<!--        .char-counter {-->
<!--            font-size: 0.875rem;-->
<!--            color: var(&#45;&#45;text-muted, #6b7280);-->
<!--            margin-left: auto;-->
<!--            margin-right: 1rem;-->
<!--        }-->

<!--        .char-counter.warning {-->
<!--            color: #f59e0b;-->
<!--        }-->

<!--        .char-counter.danger {-->
<!--            color: #dc2626;-->
<!--        }-->

<!--        /* Feed Section */-->
<!--        .feed {-->
<!--            background: var(&#45;&#45;bg-secondary);-->
<!--        }-->

<!--        .post-item {-->
<!--            padding: 1.5rem;-->
<!--            border-bottom: 1px solid var(&#45;&#45;border-secondary);-->
<!--            transition: background-color 0.2s;-->
<!--            cursor: pointer;-->
<!--        }-->

<!--        .post-item:hover {-->
<!--            background: var(&#45;&#45;bg-accent);-->
<!--        }-->

<!--        .post-header {-->
<!--            display: flex;-->
<!--            gap: 1rem;-->
<!--            margin-bottom: 1rem;-->
<!--        }-->

<!--        .post-avatar {-->
<!--            width: 40px;-->
<!--            height: 40px;-->
<!--            border-radius: 50%;-->
<!--            background: linear-gradient(135deg, var(&#45;&#45;bg-accent), #f1f5f9);-->
<!--            flex-shrink: 0;-->
<!--            overflow: hidden;-->
<!--            display: flex;-->
<!--            align-items: center;-->
<!--            justify-content: center;-->
<!--            text-decoration: none;-->
<!--        }-->

<!--        .post-avatar img {-->
<!--            width: 100%;-->
<!--            height: 100%;-->
<!--            object-fit: cover;-->
<!--            border-radius: 50%;-->
<!--        }-->

<!--        .default-avatar {-->
<!--            width: 100%;-->
<!--            height: 100%;-->
<!--            background: linear-gradient(135deg, var(&#45;&#45;accent-primary), var(&#45;&#45;accent-secondary));-->
<!--            display: flex;-->
<!--            align-items: center;-->
<!--            justify-content: center;-->
<!--            color: white;-->
<!--            font-weight: 600;-->
<!--            font-size: 0.875rem;-->
<!--        }-->

<!--        .post-meta {-->
<!--            flex: 1;-->
<!--        }-->

<!--        .post-author {-->
<!--            font-weight: 600;-->
<!--            color: var(&#45;&#45;text-primary);-->
<!--            margin-right: 0.5rem;-->
<!--            text-decoration: none;-->
<!--        }-->

<!--        .post-author:hover {-->
<!--            color: var(&#45;&#45;accent-primary);-->
<!--            text-decoration: underline;-->
<!--        }-->

<!--        .post-handle {-->
<!--            color: var(&#45;&#45;text-muted);-->
<!--            font-size: 0.9375rem;-->
<!--        }-->

<!--        .post-time {-->
<!--            color: var(&#45;&#45;text-muted);-->
<!--            font-size: 0.875rem;-->
<!--            margin-left: 0.5rem;-->
<!--        }-->

<!--        .post-content {-->
<!--            margin-left: 3rem;-->
<!--            color: var(&#45;&#45;text-primary);-->
<!--            line-height: 1.6;-->
<!--            margin-bottom: 1rem;-->
<!--            word-wrap: break-word;-->
<!--        }-->

<!--        .post-image {-->
<!--            margin-left: 3rem;-->
<!--            margin-bottom: 1rem;-->
<!--            border-radius: 12px;-->
<!--            max-width: calc(100% - 3rem);-->
<!--            height: auto;-->
<!--            border: 1px solid var(&#45;&#45;border-secondary);-->
<!--        }-->

<!--        .post-actions {-->
<!--            margin-left: 3rem;-->
<!--            display: flex;-->
<!--            gap: 2rem;-->
<!--        }-->

<!--        .action-btn {-->
<!--            display: flex;-->
<!--            align-items: center;-->
<!--            gap: 0.5rem;-->
<!--            background: none;-->
<!--            border: none;-->
<!--            color: var(&#45;&#45;text-muted);-->
<!--            cursor: pointer;-->
<!--            padding: 0.5rem;-->
<!--            border-radius: var(&#45;&#45;radius-sm);-->
<!--            transition: all 0.2s;-->
<!--            font-size: 0.875rem;-->
<!--        }-->

<!--        .action-btn:hover {-->
<!--            color: var(&#45;&#45;accent-primary);-->
<!--            background: rgba(37, 99, 235, 0.1);-->
<!--        }-->

<!--        .action-btn.liked {-->
<!--            color: #ef4444;-->
<!--        }-->

<!--        .action-btn.retweeted {-->
<!--            color: #10b981;-->
<!--        }-->

<!--        /* Empty State */-->
<!--        .empty-feed {-->
<!--            text-align: center;-->
<!--            padding: 4rem 2rem;-->
<!--            color: var(&#45;&#45;text-muted);-->
<!--        }-->

<!--        .empty-icon {-->
<!--            font-size: 3rem;-->
<!--            margin-bottom: 1rem;-->
<!--            opacity: 0.5;-->
<!--        }-->

<!--        .empty-title {-->
<!--            font-size: 1.5rem;-->
<!--            font-weight: 600;-->
<!--            margin-bottom: 1rem;-->
<!--            color: var(&#45;&#45;text-primary);-->
<!--        }-->

<!--        .empty-description {-->
<!--            font-size: 1rem;-->
<!--            line-height: 1.6;-->
<!--            margin-bottom: 2rem;-->
<!--            max-width: 400px;-->
<!--            margin-left: auto;-->
<!--            margin-right: auto;-->
<!--        }-->

<!--        .empty-action {-->
<!--            display: inline-flex;-->
<!--            align-items: center;-->
<!--            gap: 0.5rem;-->
<!--            background: var(&#45;&#45;accent-primary);-->
<!--            color: white;-->
<!--            text-decoration: none;-->
<!--            padding: 0.75rem 1.5rem;-->
<!--            border-radius: 9999px;-->
<!--            font-weight: 500;-->
<!--            transition: all 0.2s;-->
<!--        }-->

<!--        .empty-action:hover {-->
<!--            background: var(&#45;&#45;accent-secondary);-->
<!--            transform: translateY(-1px);-->
<!--            color: white;-->
<!--            text-decoration: none;-->
<!--        }-->

<!--        /* View More Button */-->
<!--        .view-more-container {-->
<!--            text-align: center;-->
<!--            margin-top: 2rem;-->
<!--            padding: 1.5rem;-->
<!--            border-top: 1px solid var(&#45;&#45;border-secondary);-->
<!--        }-->

<!--        .view-more-btn {-->
<!--            display: inline-flex;-->
<!--            align-items: center;-->
<!--            gap: 0.5rem;-->
<!--            padding: 0.75rem 1.5rem;-->
<!--            background: var(&#45;&#45;accent-primary);-->
<!--            color: white;-->
<!--            text-decoration: none;-->
<!--            border-radius: 25px;-->
<!--            font-weight: 500;-->
<!--            transition: all 0.2s ease;-->
<!--        }-->

<!--        .view-more-btn:hover {-->
<!--            background: var(&#45;&#45;accent-secondary);-->
<!--            transform: translateY(-1px);-->
<!--            text-decoration: none;-->
<!--            color: white;-->
<!--        }-->

<!--        .view-more-btn i {-->
<!--            font-size: 0.9rem;-->
<!--        }-->

<!--        /* Right Sidebar */-->
<!--        .right-sidebar {-->
<!--            padding: 1rem;-->
<!--            background: var(&#45;&#45;bg-primary);-->
<!--            overflow-y: auto;-->
<!--            max-height: 100vh;-->
<!--        }-->

<!--        /* Widget Styles */-->
<!--        .widget {-->
<!--            background: var(&#45;&#45;bg-secondary);-->
<!--            border-radius: var(&#45;&#45;radius-lg);-->
<!--            margin-bottom: 1.5rem;-->
<!--            overflow: hidden;-->
<!--            box-shadow: var(&#45;&#45;shadow-sm);-->
<!--            border: 1px solid var(&#45;&#45;border-secondary);-->
<!--        }-->

<!--        .widget-header {-->
<!--            padding: 1.25rem 1.5rem 1rem;-->
<!--            border-bottom: 1px solid var(&#45;&#45;border-secondary);-->
<!--        }-->

<!--        .widget-title {-->
<!--            font-family: 'Playfair Display', serif;-->
<!--            font-size: 1.25rem;-->
<!--            font-weight: 600;-->
<!--            color: var(&#45;&#45;text-primary);-->
<!--            margin: 0;-->
<!--        }-->

<!--        .widget-content {-->
<!--            padding: 1rem 1.5rem 1.5rem;-->
<!--        }-->

<!--        /* Trending Widget */-->
<!--        .trending-item {-->
<!--            padding: 0.75rem 0;-->
<!--            border-bottom: 1px solid var(&#45;&#45;border-secondary);-->
<!--            transition: all 0.2s;-->
<!--            cursor: pointer;-->
<!--        }-->

<!--        .trending-item:last-child {-->
<!--            border-bottom: none;-->
<!--        }-->

<!--        .trending-item:hover {-->
<!--            background: var(&#45;&#45;bg-accent);-->
<!--            margin: 0 -1.5rem;-->
<!--            padding-left: 1.5rem;-->
<!--            padding-right: 1.5rem;-->
<!--        }-->

<!--        .trending-topic {-->
<!--            font-weight: 600;-->
<!--            color: var(&#45;&#45;text-primary);-->
<!--            margin: 0 0 0.25rem 0;-->
<!--            font-size: 0.9375rem;-->
<!--        }-->

<!--        .trending-count {-->
<!--            color: var(&#45;&#45;text-muted);-->
<!--            font-size: 0.8125rem;-->
<!--            margin: 0;-->
<!--        }-->

<!--        /* Suggestions Widget */-->
<!--        .suggestion-item {-->
<!--            display: flex;-->
<!--            align-items: center;-->
<!--            padding: 1rem 0;-->
<!--            border-bottom: 1px solid var(&#45;&#45;border-secondary);-->
<!--            transition: all 0.2s;-->
<!--        }-->

<!--        .suggestion-item:last-child {-->
<!--            border-bottom: none;-->
<!--        }-->

<!--        .suggestion-item:hover {-->
<!--            background: var(&#45;&#45;bg-accent);-->
<!--            margin: 0 -1.5rem;-->
<!--            padding-left: 1.5rem;-->
<!--            padding-right: 1.5rem;-->
<!--        }-->

<!--        .suggestion-avatar {-->
<!--            width: 40px;-->
<!--            height: 40px;-->
<!--            border-radius: 50%;-->
<!--            background: linear-gradient(135deg, var(&#45;&#45;bg-accent), #f1f5f9);-->
<!--            margin-right: 0.75rem;-->
<!--            flex-shrink: 0;-->
<!--        }-->

<!--        .suggestion-info {-->
<!--            flex: 1;-->
<!--        }-->

<!--        .suggestion-name {-->
<!--            font-weight: 600;-->
<!--            font-size: 0.9375rem;-->
<!--            color: var(&#45;&#45;text-primary);-->
<!--            margin: 0 0 0.25rem;-->
<!--        }-->

<!--        .suggestion-handle {-->
<!--            font-size: 0.8125rem;-->
<!--            color: var(&#45;&#45;text-muted);-->
<!--            margin: 0;-->
<!--        }-->

<!--        .follow-btn {-->
<!--            background: var(&#45;&#45;accent-primary);-->
<!--            color: white;-->
<!--            border: none;-->
<!--            padding: 0.5rem 1rem;-->
<!--            border-radius: 9999px;-->
<!--            font-weight: 500;-->
<!--            font-size: 0.8125rem;-->
<!--            cursor: pointer;-->
<!--            transition: all 0.2s;-->
<!--        }-->

<!--        .follow-btn:hover {-->
<!--            background: var(&#45;&#45;accent-secondary);-->
<!--            transform: translateY(-1px);-->
<!--        }-->

<!--        /* Notifications */-->
<!--        .notification {-->
<!--            position: fixed;-->
<!--            top: 20px;-->
<!--            right: 20px;-->
<!--            padding: 1rem 1.5rem;-->
<!--            border-radius: 8px;-->
<!--            color: white;-->
<!--            font-weight: 500;-->
<!--            z-index: 1000;-->
<!--            transform: translateX(100%);-->
<!--            transition: transform 0.3s ease;-->
<!--        }-->

<!--        .notification.success {-->
<!--            background: linear-gradient(135deg, #059669, #10b981);-->
<!--        }-->

<!--        .notification.error {-->
<!--            background: linear-gradient(135deg, #dc2626, #ef4444);-->
<!--        }-->

<!--        .notification.show {-->
<!--            transform: translateX(0);-->
<!--        }-->

<!--        /* Responsive Design */-->
<!--        @media (max-width: 1200px) {-->
<!--            .main-layout {-->
<!--                grid-template-columns: 1fr 300px;-->
<!--            }-->
<!--        }-->

<!--        @media (max-width: 1024px) {-->
<!--            .main-layout {-->
<!--                margin-left: 80px;-->
<!--                grid-template-columns: 1fr 280px;-->
<!--            }-->
<!--        }-->

<!--        @media (max-width: 768px) {-->
<!--            .main-layout {-->
<!--                grid-template-columns: 1fr;-->
<!--                margin-left: 0;-->
<!--                margin-top: 60px;-->
<!--            }-->

<!--            .content-area {-->
<!--                border-left: none;-->
<!--                border-right: none;-->
<!--            }-->

<!--            .right-sidebar {-->
<!--                display: none;-->
<!--            }-->

<!--            .post-content,-->
<!--            .post-actions,-->
<!--            .post-image {-->
<!--                margin-left: 0;-->
<!--            }-->

<!--            .view-more-container {-->
<!--                margin-top: 1.5rem;-->
<!--                padding: 1rem;-->
<!--            }-->

<!--            .view-more-btn {-->
<!--                padding: 0.625rem 1.25rem;-->
<!--                font-size: 0.9rem;-->
<!--            }-->
<!--        }-->

<!--        @media (max-width: 480px) {-->
<!--            .post-composer {-->
<!--                flex-direction: column;-->
<!--                gap: 1rem;-->
<!--            }-->

<!--            .composer-avatar {-->
<!--                align-self: flex-start;-->
<!--            }-->

<!--            .post-actions {-->
<!--                justify-content: space-around;-->
<!--                gap: 1rem;-->
<!--            }-->
<!--        }-->
<!--    </style>-->
<!--    &lt;!&ndash; Sidebar Styles &ndash;&gt;-->
<!--    <th:block th:replace="~{fragments/sidebar :: sidebar-styles}"></th:block>-->
<!--</head>-->
<!--<body>-->

<!--&lt;!&ndash; Mobile Header &ndash;&gt;-->
<!--<th:block th:replace="~{fragments/sidebar :: mobile-header}"></th:block>-->

<!--&lt;!&ndash; Sidebar &ndash;&gt;-->
<!--<th:block th:replace="~{fragments/sidebar :: sidebar(${activeSection})}"></th:block>-->

<!--<div class="main-layout">-->
<!--    &lt;!&ndash; Main Content Area &ndash;&gt;-->
<!--    <main class="content-area">-->
<!--        &lt;!&ndash; Header &ndash;&gt;-->
<!--        <div class="content-header">-->
<!--            <h1 class="header-title">Главная</h1>-->
<!--        </div>-->

<!--        &lt;!&ndash; Create Post Section с интеграцией AJAX &ndash;&gt;-->
<!--        <div class="create-post">-->
<!--            <div class="post-composer">-->
<!--                <div class="composer-avatar">-->
<!--                    <i class="fas fa-user" th:if="${currentUser?.imageUrl == null}"></i>-->
<!--                    <img th:if="${currentUser?.imageUrl}" th:src="${currentUser.imageUrl}" alt="Avatar"-->
<!--                         style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">-->
<!--                </div>-->
<!--                <div class="composer-content">-->
<!--                    &lt;!&ndash; Форма для создания поста &ndash;&gt;-->
<!--                    <form id="createPostForm" enctype="multipart/form-data">-->
<!--                <textarea-->
<!--                        class="post-textarea"-->
<!--                        placeholder="Что происходит?"-->
<!--                        maxlength="1000"-->
<!--                        id="postContent"-->
<!--                        name="content"-->
<!--                        required></textarea>-->

<!--                        &lt;!&ndash; Скрытое поле для загрузки изображения &ndash;&gt;-->
<!--                        <input type="file"-->
<!--                               id="imageInput"-->
<!--                               name="image"-->
<!--                               accept="image/jpeg,image/jpg,image/png,image/heif,image/heic"-->
<!--                               style="display: none;">-->

<!--                        &lt;!&ndash; Предварительный просмотр изображения &ndash;&gt;-->
<!--                        <div id="imagePreview" class="image-preview" style="display: none;">-->
<!--                            <img id="previewImg" src="" alt="Preview" class="preview-image">-->
<!--                            <button type="button" class="remove-image-btn" onclick="removeImage()">-->
<!--                                <i class="fas fa-times"></i>-->
<!--                            </button>-->
<!--                        </div>-->

<!--                        <div class="composer-actions">-->
<!--                            <div class="composer-tools">-->
<!--                                <button type="button" class="tool-btn" title="Добавить изображение" onclick="selectImage()">-->
<!--                                    <i class="fas fa-image"></i>-->
<!--                                </button>-->
<!--                                <button type="button" class="tool-btn" title="Добавить GIF">-->
<!--                                    <i class="fas fa-photo-video"></i>-->
<!--                                </button>-->
<!--                                <button type="button" class="tool-btn" title="Создать опрос">-->
<!--                                    <i class="fas fa-poll"></i>-->
<!--                                </button>-->
<!--                                <button type="button" class="tool-btn" title="Добавить эмодзи">-->
<!--                                    <i class="fas fa-smile"></i>-->
<!--                                </button>-->

<!--                                &lt;!&ndash; Счетчик символов &ndash;&gt;-->
<!--                                <div class="char-counter">-->
<!--                                    <span id="charCount">0</span>/1000-->
<!--                                </div>-->
<!--                            </div>-->
<!--                            <button type="submit" class="post-btn" id="postButton" disabled onclick="handleButtonClick(event)">-->
<!--                                <span class="btn-text">Опубликовать</span>-->
<!--                                <i class="fas fa-spinner fa-spin btn-spinner" style="display: none;"></i>-->
<!--                            </button>-->
<!--                        </div>-->
<!--                    </form>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Feed &ndash;&gt;-->
<!--        <div class="feed" id="feed">-->
<!--            &lt;!&ndash; Если есть посты &ndash;&gt;-->
<!--            <div th:if="${recentPosts != null and !recentPosts.posts.empty}">-->
<!--                <div class="post-item" th:each="post : ${recentPosts.posts}"-->
<!--                     onclick="navigateToPost(event, this)"-->
<!--                     th:data-post-id="${post.id}">-->

<!--                    <div class="post-header">-->
<!--                        <a th:href="@{/profile/{userId}(userId=${post.author.id})}" class="post-avatar">-->
<!--                            <img th:if="${post.author.imageUrl}"-->
<!--                                 th:src="${post.author.imageUrl}"-->
<!--                                 th:alt="${post.author.firstName + ' ' + post.author.lastName}">-->
<!--                            <div th:unless="${post.author.imageUrl}" class="default-avatar">-->
<!--                                <span th:text="${#strings.substring(post.author.firstName, 0, 1) + #strings.substring(post.author.lastName, 0, 1)}">AB</span>-->
<!--                            </div>-->
<!--                        </a>-->

<!--                        <div class="post-meta">-->
<!--                            <a th:href="@{/profile/{userId}(userId=${post.author.id})}" class="post-author">-->
<!--                                <span th:text="${post.author.firstName + ' ' + post.author.lastName}">Имя Автора</span>-->
<!--                            </a>-->
<!--                            <span class="post-handle" th:text="'@' + ${post.author.firstName?.toLowerCase()}">@автор</span>-->
<!--                            <span class="post-time" th:text="'· ' + ${#temporals.format(post.createdAt, 'HH:mm', new java.util.Locale('ru'))}">· 2ч</span>-->
<!--                        </div>-->
<!--                    </div>-->

<!--                    <div class="post-content" th:text="${post.content}">-->
<!--                        Содержимое поста...-->
<!--                    </div>-->

<!--                    <img th:if="${post.hasImage}"-->
<!--                         th:src="${post.imageUrl}"-->
<!--                         alt="Изображение поста"-->
<!--                         class="post-image">-->

<!--                    <div class="post-actions">-->
<!--                        <button class="action-btn comment-btn" onclick="openComments(event, this)"-->
<!--                                th:data-post-id="${post.id}">-->
<!--                            <i class="fas fa-comment"></i>-->
<!--                            <span th:text="${post.commentsCount}">0</span>-->
<!--                        </button>-->

<!--                        <button class="action-btn like-btn" onclick="toggleLike(event, this)"-->
<!--                                th:data-post-id="${post.id}">-->
<!--                            <i class="fas fa-heart"></i>-->
<!--                            <span th:text="${post.likesCount}">0</span>-->
<!--                        </button>-->

<!--                        <button class="action-btn share-btn" onclick="sharePost(event, this)"-->
<!--                                th:data-post-id="${post.id}">-->
<!--                            <i class="fas fa-share"></i>-->
<!--                        </button>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->

<!--            &lt;!&ndash; Если нет постов &ndash;&gt;-->
<!--            <div th:unless="${recentPosts != null and !recentPosts.posts.empty}" class="empty-feed">-->
<!--                <div class="empty-icon">-->
<!--                    <i class="fas fa-rss"></i>-->
<!--                </div>-->
<!--                <h3 class="empty-title">Добро пожаловать!</h3>-->
<!--                <p class="empty-description">-->
<!--                    Ваша лента пуста. Подпишитесь на интересных людей, чтобы видеть их посты здесь.-->
<!--                    <br>Или создайте свой первый пост!-->
<!--                </p>-->
<!--                <a href="/recommendations" class="empty-action">-->
<!--                    <i class="fas fa-user-plus"></i>-->
<!--                    Найти людей-->
<!--                </a>-->
<!--            </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Ссылка на полную ленту &ndash;&gt;-->
<!--        <div th:if="${recentPosts != null and !recentPosts.posts.empty}" class="view-more-container">-->
<!--            <a href="/feed" class="view-more-btn">-->
<!--                <i class="fas fa-arrow-right"></i>-->
<!--                Посмотреть всю ленту-->
<!--            </a>-->
<!--        </div>-->


<!--    </main>-->

<!--    &lt;!&ndash; Right Sidebar &ndash;&gt;-->
<!--    <aside class="right-sidebar">-->
<!--        &lt;!&ndash; Trending Topics &ndash;&gt;-->
<!--        <div class="widget">-->
<!--            <div class="widget-header">-->
<!--                <h3 class="widget-title">Актуальные темы</h3>-->
<!--            </div>-->
<!--            <div class="widget-content">-->
<!--                <div class="trending-item">-->
<!--                    <p class="trending-topic">#ТехнологииБудущего</p>-->
<!--                    <p class="trending-count">12.5K обсуждений</p>-->
<!--                </div>-->
<!--                <div class="trending-item">-->
<!--                    <p class="trending-topic">#ДизайнТренды2025</p>-->
<!--                    <p class="trending-count">8.3K обсуждений</p>-->
<!--                </div>-->
<!--                <div class="trending-item">-->
<!--                    <p class="trending-topic">#ИскусственныйИнтеллект</p>-->
<!--                    <p class="trending-count">15.7K обсуждений</p>-->
<!--                </div>-->
<!--                <div class="trending-item">-->
<!--                    <p class="trending-topic">#WebДевелопмент</p>-->
<!--                    <p class="trending-count">6.2K обсуждений</p>-->
<!--                </div>-->
<!--                <div class="trending-item">-->
<!--                    <p class="trending-topic">#УдаленнаяРабота</p>-->
<!--                    <p class="trending-count">9.1K обсуждений</p>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Who to Follow &ndash;&gt;-->
<!--        <div class="widget">-->
<!--            <div class="widget-header">-->
<!--                <h3 class="widget-title">Кого читать</h3>-->
<!--            </div>-->
<!--            <div class="widget-content">-->
<!--                <div class="suggestion-item">-->
<!--                    <div class="suggestion-avatar"></div>-->
<!--                    <div class="suggestion-info">-->
<!--                        <p class="suggestion-name">Дмитрий Козлов</p>-->
<!--                        <p class="suggestion-handle">@alex_startup</p>-->
<!--                    </div>-->
<!--                    <button class="follow-btn">Читать</button>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Quick Stats &ndash;&gt;-->
<!--        <div class="widget">-->
<!--            <div class="widget-header">-->
<!--                <h3 class="widget-title">Ваша активность</h3>-->
<!--            </div>-->
<!--            <div class="widget-content">-->
<!--                <div class="trending-item">-->
<!--                    <p class="trending-topic">Просмотры профиля</p>-->
<!--                    <p class="trending-count">47 за эту неделю</p>-->
<!--                </div>-->
<!--                <div class="trending-item">-->
<!--                    <p class="trending-topic">Упоминания</p>-->
<!--                    <p class="trending-count">12 новых</p>-->
<!--                </div>-->
<!--                <div class="trending-item">-->
<!--                    <p class="trending-topic">Подписчики</p>-->
<!--                    <p class="trending-count">+5 за день</p>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Footer Links &ndash;&gt;-->
<!--        <div style="padding: 1rem 0; font-size: 0.8125rem; color: var(&#45;&#45;text-muted); line-height: 1.4;">-->
<!--            <a href="/terms" style="color: inherit; text-decoration: none; margin-right: 1rem;">Условия</a>-->
<!--            <a href="/privacy" style="color: inherit; text-decoration: none; margin-right: 1rem;">Конфиденциальность</a>-->
<!--            <a href="/help" style="color: inherit; text-decoration: none;">Помощь</a>-->
<!--            <p style="margin-top: 0.5rem; margin-bottom: 0;">© 2025 Cleopatra</p>-->
<!--        </div>-->
<!--    </aside>-->
<!--</div>-->

<!--&lt;!&ndash; JS в конце страницы &ndash;&gt;-->
<!--<th:block th:replace="~{fragments/sidebar :: sidebar-scripts}"></th:block>-->

<!--<script>-->
<!--    console.log('🚀 Загружаем скрипт создания постов...');-->

<!--    // Функция инициализации - вызывается когда DOM готов-->
<!--    function initializePostComposer() {-->
<!--        console.log('🔧 Инициализация composer...');-->

<!--        // Проверяем наличие всех элементов-->
<!--        const postContent = document.getElementById('postContent');-->
<!--        const postButton = document.getElementById('postButton');-->
<!--        const charCount = document.getElementById('charCount');-->
<!--        const imageInput = document.getElementById('imageInput');-->
<!--        const imagePreview = document.getElementById('imagePreview');-->
<!--        const previewImg = document.getElementById('previewImg');-->
<!--        const createPostForm = document.getElementById('createPostForm');-->

<!--        console.log('📋 Элементы формы:', {-->
<!--            postContent: !!postContent,-->
<!--            postButton: !!postButton,-->
<!--            charCount: !!charCount,-->
<!--            imageInput: !!imageInput,-->
<!--            createPostForm: !!createPostForm-->
<!--        });-->

<!--        if (!postContent || !postButton || !createPostForm) {-->
<!--            console.error('❌ Не найдены обязательные элементы формы!');-->
<!--            return;-->
<!--        }-->

<!--        // Счетчик символов и валидация-->
<!--        postContent.addEventListener('input', function() {-->
<!--            console.log('📝 Ввод текста:', this.value.length);-->
<!--            const length = this.value.length;-->
<!--            const maxLength = 1000;-->

<!--            if (charCount) {-->
<!--                charCount.textContent = length;-->

<!--                // Обновляем стиль счетчика-->
<!--                const counter = charCount.parentElement;-->
<!--                counter.className = 'char-counter';-->
<!--                if (length > maxLength * 0.9) {-->
<!--                    counter.classList.add('warning');-->
<!--                }-->
<!--                if (length > maxLength * 0.95) {-->
<!--                    counter.classList.remove('warning');-->
<!--                    counter.classList.add('danger');-->
<!--                }-->
<!--            }-->

<!--            // Активируем/деактивируем кнопку-->
<!--            const isValid = length > 0 && length <= maxLength;-->
<!--            postButton.disabled = !isValid;-->
<!--            console.log('🔘 Кнопка активна:', isValid);-->
<!--        });-->

<!--        // Обработка загрузки изображения-->
<!--        if (imageInput) {-->
<!--            imageInput.addEventListener('change', function(event) {-->
<!--                console.log('🖼️ Выбрано изображение');-->
<!--                handleImageSelect(event);-->
<!--            });-->
<!--        }-->

<!--        // Отправка формы-->
<!--        createPostForm.addEventListener('submit', function(event) {-->
<!--            console.log('📤 Отправка формы...');-->
<!--            handleFormSubmit(event);-->
<!--        });-->

<!--        console.log('✅ Инициализация завершена');-->
<!--    }-->

<!--    // Функции для работы с изображениями-->
<!--    function selectImage() {-->
<!--        console.log('🖼️ Открываем выбор изображения...');-->
<!--        const imageInput = document.getElementById('imageInput');-->
<!--        if (imageInput) {-->
<!--            imageInput.click();-->
<!--        } else {-->
<!--            console.error('❌ imageInput не найден');-->
<!--        }-->
<!--    }-->

<!--    function handleImageSelect(event) {-->
<!--        const file = event.target.files[0];-->
<!--        if (!file) {-->
<!--            console.log('❌ Файл не выбран');-->
<!--            return;-->
<!--        }-->

<!--        console.log('📁 Обрабатываем файл:', file.name, file.type, file.size);-->

<!--        // Валидация типа файла-->
<!--        const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/heif', 'image/heic'];-->
<!--        if (!allowedTypes.includes(file.type)) {-->
<!--            showNotification('Неподдерживаемый формат файла. Используйте JPG, PNG, HEIF или HEIC.', 'error');-->
<!--            event.target.value = '';-->
<!--            return;-->
<!--        }-->

<!--        // Валидация размера файла (10MB)-->
<!--        const maxSize = 10 * 1024 * 1024;-->
<!--        if (file.size > maxSize) {-->
<!--            showNotification('Файл слишком большой. Максимальный размер: 10MB.', 'error');-->
<!--            event.target.value = '';-->
<!--            return;-->
<!--        }-->

<!--        // Показываем превью-->
<!--        const reader = new FileReader();-->
<!--        reader.onload = function(e) {-->
<!--            const previewImg = document.getElementById('previewImg');-->
<!--            const imagePreview = document.getElementById('imagePreview');-->

<!--            if (previewImg && imagePreview) {-->
<!--                previewImg.src = e.target.result;-->
<!--                imagePreview.style.display = 'block';-->
<!--                console.log('✅ Превью показано');-->
<!--            }-->
<!--        };-->
<!--        reader.readAsDataURL(file);-->
<!--    }-->

<!--    function removeImage() {-->
<!--        console.log('🗑️ Удаляем изображение...');-->
<!--        const imageInput = document.getElementById('imageInput');-->
<!--        const imagePreview = document.getElementById('imagePreview');-->

<!--        if (imageInput) imageInput.value = '';-->
<!--        if (imagePreview) imagePreview.style.display = 'none';-->
<!--    }-->

<!--    // Обработчик клика кнопки (дублирует submit)-->
<!--    function handleButtonClick(event) {-->
<!--        console.log('🖱️ Клик по кнопке Опубликовать');-->
<!--        event.preventDefault();-->
<!--        handleFormSubmit(event);-->
<!--    }-->

<!--    // Обработка отправки формы-->
<!--    async function handleFormSubmit(event) {-->
<!--        event.preventDefault();-->
<!--        console.log('🚀 Начинаем отправку формы...');-->

<!--        const postContent = document.getElementById('postContent');-->
<!--        const imageInput = document.getElementById('imageInput');-->

<!--        const content = postContent.value.trim();-->
<!--        if (!content) {-->
<!--            showNotification('Введите текст поста', 'error');-->
<!--            return;-->
<!--        }-->

<!--        // Показываем состояние загрузки-->
<!--        setLoadingState(true);-->

<!--        try {-->
<!--            // Создаем FormData-->
<!--            const formData = new FormData();-->
<!--            formData.append('content', content);-->

<!--            if (imageInput && imageInput.files[0]) {-->
<!--                formData.append('image', imageInput.files[0]);-->
<!--                console.log('📎 Добавлено изображение к запросу');-->
<!--            }-->

<!--            console.log('📤 Отправляем запрос на /posts/api/create');-->

<!--            // Отправляем запрос-->
<!--            const response = await fetch('/posts/api/create', {-->
<!--                method: 'POST',-->
<!--                body: formData-->
<!--            });-->

<!--            console.log('📥 Получен ответ:', response.status, response.statusText);-->

<!--            if (response.ok) {-->
<!--                const result = await response.json();-->
<!--                console.log('✅ Пост создан:', result);-->
<!--                showNotification('Пост успешно создан!', 'success');-->

<!--                // Очищаем форму-->
<!--                resetForm();-->

<!--                // Обновляем ленту (можно добавить AJAX загрузку новых постов)-->
<!--                setTimeout(() => {-->
<!--                    location.reload();-->
<!--                }, 1000);-->

<!--            } else {-->
<!--                const errorText = await response.text();-->
<!--                console.error('❌ Ошибка ответа:', errorText);-->
<!--                showNotification('Ошибка при создании поста: ' + response.status, 'error');-->
<!--            }-->
<!--        } catch (error) {-->
<!--            console.error('❌ Ошибка при создании поста:', error);-->
<!--            showNotification('Произошла ошибка при создании поста', 'error');-->
<!--        } finally {-->
<!--            setLoadingState(false);-->
<!--        }-->
<!--    }-->

<!--    // Управление состоянием загрузки-->
<!--    function setLoadingState(loading) {-->
<!--        console.log('⏳ Состояние загрузки:', loading);-->
<!--        const postButton = document.getElementById('postButton');-->
<!--        const btnText = postButton?.querySelector('.btn-text');-->
<!--        const btnSpinner = postButton?.querySelector('.btn-spinner');-->

<!--        if (!postButton) return;-->

<!--        postButton.disabled = loading;-->

<!--        if (loading) {-->
<!--            if (btnText) btnText.style.opacity = '0';-->
<!--            if (btnSpinner) btnSpinner.style.display = 'inline-block';-->
<!--        } else {-->
<!--            if (btnText) btnText.style.opacity = '1';-->
<!--            if (btnSpinner) btnSpinner.style.display = 'none';-->
<!--        }-->
<!--    }-->

<!--    // Сброс формы-->
<!--    function resetForm() {-->
<!--        console.log('🔄 Сбрасываем форму...');-->
<!--        const postContent = document.getElementById('postContent');-->
<!--        const imageInput = document.getElementById('imageInput');-->
<!--        const imagePreview = document.getElementById('imagePreview');-->
<!--        const charCount = document.getElementById('charCount');-->
<!--        const postButton = document.getElementById('postButton');-->

<!--        if (postContent) postContent.value = '';-->
<!--        if (imageInput) imageInput.value = '';-->
<!--        if (imagePreview) imagePreview.style.display = 'none';-->
<!--        if (charCount) {-->
<!--            charCount.textContent = '0';-->
<!--            charCount.parentElement.className = 'char-counter';-->
<!--        }-->
<!--        if (postButton) postButton.disabled = true;-->
<!--    }-->

<!--    // Показ уведомлений-->
<!--    function showNotification(message, type = 'success') {-->
<!--        console.log('🔔 Уведомление:', type, message);-->

<!--        // Удаляем существующие уведомления-->
<!--        const existingNotifications = document.querySelectorAll('.notification');-->
<!--        existingNotifications.forEach(n => n.remove());-->

<!--        // Создаем новое уведомление-->
<!--        const notification = document.createElement('div');-->
<!--        notification.className = `notification ${type}`;-->
<!--        notification.innerHTML = `-->
<!--            <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}" style="margin-right: 0.5rem;"></i>-->
<!--            ${message}-->
<!--        `;-->

<!--        document.body.appendChild(notification);-->

<!--        // Показываем уведомление-->
<!--        setTimeout(() => {-->
<!--            notification.classList.add('show');-->
<!--        }, 100);-->

<!--        // Скрываем через 3 секунды-->
<!--        setTimeout(() => {-->
<!--            notification.classList.remove('show');-->
<!--            setTimeout(() => {-->
<!--                if (notification.parentNode) {-->
<!--                    notification.parentNode.removeChild(notification);-->
<!--                }-->
<!--            }, 300);-->
<!--        }, 3000);-->
<!--    }-->

<!--    // Функции для работы с постами-->
<!--    function navigateToPost(event, element) {-->
<!--        // Проверяем, что клик не был по кнопке действия-->
<!--        if (event.target.closest('.action-btn') || event.target.closest('.post-author')) {-->
<!--            return;-->
<!--        }-->

<!--        const postId = element.getAttribute('data-post-id');-->
<!--        if (postId) {-->
<!--            window.location.href = `/posts/${postId}`;-->
<!--        }-->
<!--    }-->

<!--    function openComments(event, button) {-->
<!--        event.stopPropagation();-->
<!--        const postId = button.getAttribute('data-post-id');-->
<!--        if (postId) {-->
<!--            window.location.href = `/posts/${postId}#comments`;-->
<!--        }-->
<!--    }-->

<!--    async function toggleLike(event, button) {-->
<!--        event.stopPropagation();-->
<!--        const postId = button.getAttribute('data-post-id');-->

<!--        if (!postId) return;-->

<!--        try {-->
<!--            const response = await fetch(`/posts/${postId}/like`, {-->
<!--                method: 'POST',-->
<!--                headers: {-->
<!--                    'Content-Type': 'application/json'-->
<!--                }-->
<!--            });-->

<!--            if (response.ok) {-->
<!--                const result = await response.json();-->

<!--                // Обновляем UI-->
<!--                const icon = button.querySelector('i');-->
<!--                const count = button.querySelector('span');-->

<!--                if (result.liked) {-->
<!--                    button.classList.add('liked');-->
<!--                    icon.classList.remove('far');-->
<!--                    icon.classList.add('fas');-->
<!--                } else {-->
<!--                    button.classList.remove('liked');-->
<!--                    icon.classList.remove('fas');-->
<!--                    icon.classList.add('far');-->
<!--                }-->

<!--                count.textContent = result.likesCount;-->
<!--            }-->
<!--        } catch (error) {-->
<!--            console.error('Ошибка при лайке:', error);-->
<!--            showNotification('Ошибка при обновлении лайка', 'error');-->
<!--        }-->
<!--    }-->

<!--    function sharePost(event, button) {-->
<!--        event.stopPropagation();-->
<!--        const postId = button.getAttribute('data-post-id');-->

<!--        if (navigator.share) {-->
<!--            navigator.share({-->
<!--                title: 'Пост из Cleopatra',-->
<!--                url: `${window.location.origin}/posts/${postId}`-->
<!--            });-->
<!--        } else {-->
<!--            // Fallback - копируем ссылку в буфер обмена-->
<!--            const url = `${window.location.origin}/posts/${postId}`;-->
<!--            navigator.clipboard.writeText(url).then(() => {-->
<!--                showNotification('Ссылка скопирована в буфер обмена', 'success');-->
<!--            }).catch(() => {-->
<!--                showNotification('Не удалось скопировать ссылку', 'error');-->
<!--            });-->
<!--        }-->
<!--    }-->

<!--    // Инициализация при загрузке страницы-->
<!--    document.addEventListener('DOMContentLoaded', function() {-->
<!--        initializePostComposer();-->

<!--        // Инициализация кнопок подписки-->
<!--        document.querySelectorAll('.follow-btn').forEach(btn => {-->
<!--            btn.addEventListener('click', function() {-->
<!--                if (this.textContent === 'Читать') {-->
<!--                    this.textContent = 'Читаем';-->
<!--                    this.style.background = '#10b981';-->
<!--                } else {-->
<!--                    this.textContent = 'Читать';-->
<!--                    this.style.background = '';-->
<!--                }-->
<!--            });-->
<!--        });-->

<!--        // Анимации для tool buttons-->
<!--        document.querySelectorAll('.tool-btn').forEach(btn => {-->
<!--            btn.addEventListener('click', function() {-->
<!--                this.style.transform = 'scale(0.95)';-->
<!--                setTimeout(() => {-->
<!--                    this.style.transform = '';-->
<!--                }, 150);-->
<!--            });-->
<!--        });-->

<!--        console.log('🐦 Dashboard инициализирован');-->
<!--        console.log('📝 Composer готов к работе');-->
<!--        console.log('👥 Социальные функции активированы');-->
<!--    });-->

<!--    // Инициализация если DOM уже загружен-->
<!--    if (document.readyState === 'loading') {-->
<!--        document.addEventListener('DOMContentLoaded', initializePostComposer);-->
<!--    } else {-->
<!--        initializePostComposer();-->
<!--    }-->

<!--    console.log('📝 Скрипт создания постов загружен');-->
<!--</script>-->
<!--</body>-->
<!--</html>-->


<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Главная - Cleopatra</title>

    <!-- External CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap"
          rel="stylesheet">

    <style>
        /* Основные стили страницы */
        body {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-accent) 100%);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-weight: 400;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Layout Grid */
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 0;
            min-height: 100vh;
            margin-left: 280px; /* Отступ для sidebar */
        }

        /* Main Content Area */
        .content-area {
            max-width: 600px;
            margin: 0 auto;
            padding: 0;
            border-left: 1px solid var(--border-primary);
            border-right: 1px solid var(--border-primary);
            background: var(--bg-secondary);
            min-height: 100vh;
        }

        /* Header */
        .content-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-secondary);
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.25rem;
            font-weight: 600;
            margin: 0;
            color: var(--text-primary);
        }

        /* Create Post Section */
        .create-post {
            padding: 1.5rem;
            border-bottom: 8px solid var(--border-secondary);
            background: var(--bg-secondary);
        }

        .post-composer {
            display: flex;
            gap: 1rem;
        }

        .composer-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
            flex-shrink: 0;
            box-shadow: var(--shadow-sm);
            overflow: hidden;
        }

        .composer-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .composer-content {
            flex: 1;
        }

        .post-textarea {
            width: 100%;
            border: none;
            outline: none;
            background: transparent;
            font-size: 1.25rem;
            color: var(--text-primary);
            resize: none;
            min-height: 120px;
            font-family: inherit;
            line-height: 1.5;
        }

        .post-textarea::placeholder {
            color: var(--text-muted);
        }

        .composer-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-secondary);
        }

        .composer-tools {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .tool-btn {
            background: none;
            border: none;
            color: var(--accent-primary);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--radius-sm);
            transition: all 0.2s;
            font-size: 1.125rem;
        }

        .tool-btn:hover {
            background: rgba(37, 99, 235, 0.1);
            transform: scale(1.05);
        }

        .post-btn {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 9999px;
            font-weight: 600;
            font-size: 0.9375rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            letter-spacing: 0.01em;
            position: relative;
            min-width: 120px;
        }

        .post-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .post-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .post-btn:disabled .btn-text {
            opacity: 0;
        }

        .post-btn:not(:disabled) .btn-spinner {
            display: none !important;
        }

        .btn-spinner {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        /* Image Preview */
        .image-preview {
            position: relative;
            margin: 1rem 0;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border-primary, #e5e7eb);
        }

        .preview-image {
            width: 100%;
            max-height: 300px;
            object-fit: cover;
        }

        .remove-image-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 12px;
        }

        .remove-image-btn:hover {
            background: #dc2626;
            transform: scale(1.1);
        }

        /* Character Counter */
        .char-counter {
            font-size: 0.875rem;
            color: var(--text-muted, #6b7280);
            margin-left: auto;
            margin-right: 1rem;
        }

        .char-counter.warning {
            color: #f59e0b;
        }

        .char-counter.danger {
            color: #dc2626;
        }

        /* Feed Section */
        .feed {
            background: var(--bg-secondary);
        }

        /* Контейнер для постов */
        .posts-container {
            display: flex;
            flex-direction: column;
        }

        .post-item {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-secondary);
            transition: background-color 0.2s;
            cursor: pointer;
            animation: slideIn 0.3s ease-out;
        }

        .post-item:hover {
            background: var(--bg-accent);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .post-header {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .post-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--bg-accent), #f1f5f9);
            flex-shrink: 0;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
        }

        .post-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .default-avatar {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .post-meta {
            flex: 1;
        }

        .post-author {
            font-weight: 600;
            color: var(--text-primary);
            margin-right: 0.5rem;
            text-decoration: none;
        }

        .post-author:hover {
            color: var(--accent-primary);
            text-decoration: underline;
        }

        .post-handle {
            color: var(--text-muted);
            font-size: 0.9375rem;
        }

        .post-time {
            color: var(--text-muted);
            font-size: 0.875rem;
            margin-left: 0.5rem;
        }

        .post-content {
            margin-left: 3rem;
            color: var(--text-primary);
            line-height: 1.6;
            margin-bottom: 1rem;
            word-wrap: break-word;
        }

        .post-image {
            margin-left: 3rem;
            margin-bottom: 1rem;
            border-radius: 12px;
            max-width: calc(100% - 3rem);
            height: auto;
            border: 1px solid var(--border-secondary);
        }

        .post-actions {
            margin-left: 3rem;
            display: flex;
            gap: 2rem;
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--radius-sm);
            transition: all 0.2s;
            font-size: 0.875rem;
        }

        .action-btn:hover {
            color: var(--accent-primary);
            background: rgba(37, 99, 235, 0.1);
        }

        .action-btn.liked {
            color: #ef4444;
        }

        .action-btn.retweeted {
            color: #10b981;
        }

        /* Стили для индикаторов загрузки */
        .loading-indicator {
            display: none;
            padding: 20px;
            text-align: center;
            border-top: 1px solid #eee;
            margin-top: 20px;
        }

        .loading-spinner {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            color: #666;
        }

        .loading-spinner i {
            font-size: 24px;
            color: #1da1f2;
        }

        .loading-spinner span {
            font-size: 14px;
        }

        /* Стили для сообщения об окончании постов */
        .no-more-posts {
            display: none;
            padding: 20px;
            text-align: center;
            border-top: 1px solid #eee;
            margin-top: 20px;
            color: #666;
        }

        .no-more-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .no-more-content i {
            font-size: 20px;
            color: #4caf50;
        }

        .no-more-content span {
            font-size: 14px;
        }

        /* Стили для сообщения об ошибке */
        .error-message {
            display: none;
            padding: 20px;
            text-align: center;
            border-top: 1px solid #eee;
            margin-top: 20px;
            background-color: #ffebee;
            border-radius: 8px;
        }

        .error-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            color: #d32f2f;
        }

        .error-content i {
            font-size: 20px;
        }

        .retry-btn {
            background-color: #1da1f2;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 8px;
            transition: background-color 0.2s;
        }

        .retry-btn:hover {
            background-color: #1991db;
        }

        /* Empty State */
        .empty-feed {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-muted);
        }

        .empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .empty-description {
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 2rem;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .empty-action {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--accent-primary);
            color: white;
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .empty-action:hover {
            background: var(--accent-secondary);
            transform: translateY(-1px);
            color: white;
            text-decoration: none;
        }

        /* View More Button */
        .view-more-container {
            text-align: center;
            margin-top: 2rem;
            padding: 1.5rem;
            border-top: 1px solid var(--border-secondary);
        }

        .view-more-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: var(--accent-primary);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .view-more-btn:hover {
            background: var(--accent-secondary);
            transform: translateY(-1px);
            text-decoration: none;
            color: white;
        }

        .view-more-btn i {
            font-size: 0.9rem;
        }

        /* Right Sidebar */
        .right-sidebar {
            padding: 1rem;
            background: var(--bg-primary);
            overflow-y: auto;
            max-height: 100vh;
        }

        /* Widget Styles */
        .widget {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            margin-bottom: 1.5rem;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-secondary);
        }

        .widget-header {
            padding: 1.25rem 1.5rem 1rem;
            border-bottom: 1px solid var(--border-secondary);
        }

        .widget-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .widget-content {
            padding: 1rem 1.5rem 1.5rem;
        }

        /* Trending Widget */
        .trending-item {
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-secondary);
            transition: all 0.2s;
            cursor: pointer;
        }

        .trending-item:last-child {
            border-bottom: none;
        }

        .trending-item:hover {
            background: var(--bg-accent);
            margin: 0 -1.5rem;
            padding-left: 1.5rem;
            padding-right: 1.5rem;
        }

        .trending-topic {
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 0.25rem 0;
            font-size: 0.9375rem;
        }

        .trending-count {
            color: var(--text-muted);
            font-size: 0.8125rem;
            margin: 0;
        }

        /* Suggestions Widget */
        .suggestion-item {
            display: flex;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-secondary);
            transition: all 0.2s;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-item:hover {
            background: var(--bg-accent);
            margin: 0 -1.5rem;
            padding-left: 1.5rem;
            padding-right: 1.5rem;
        }

        .suggestion-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--bg-accent), #f1f5f9);
            margin-right: 0.75rem;
            flex-shrink: 0;
        }

        .suggestion-info {
            flex: 1;
        }

        .suggestion-name {
            font-weight: 600;
            font-size: 0.9375rem;
            color: var(--text-primary);
            margin: 0 0 0.25rem;
        }

        .suggestion-handle {
            font-size: 0.8125rem;
            color: var(--text-muted);
            margin: 0;
        }

        .follow-btn {
            background: var(--accent-primary);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-weight: 500;
            font-size: 0.8125rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .follow-btn:hover {
            background: var(--accent-secondary);
            transform: translateY(-1px);
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.success {
            background: linear-gradient(135deg, #059669, #10b981);
        }

        .notification.error {
            background: linear-gradient(135deg, #dc2626, #ef4444);
        }

        .notification.show {
            transform: translateX(0);
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr 300px;
            }
        }

        @media (max-width: 1024px) {
            .main-layout {
                margin-left: 80px;
                grid-template-columns: 1fr 280px;
            }
        }

        @media (max-width: 768px) {
            .main-layout {
                grid-template-columns: 1fr;
                margin-left: 0;
                margin-top: 60px;
            }

            .content-area {
                border-left: none;
                border-right: none;
            }

            .right-sidebar {
                display: none;
            }

            .post-content,
            .post-actions,
            .post-image {
                margin-left: 0;
            }

            .view-more-container {
                margin-top: 1.5rem;
                padding: 1rem;
            }

            .view-more-btn {
                padding: 0.625rem 1.25rem;
                font-size: 0.9rem;
            }

            .loading-indicator,
            .no-more-posts,
            .error-message {
                margin: 15px;
                padding: 15px;
            }

            .loading-spinner,
            .no-more-content,
            .error-content {
                gap: 8px;
            }

            .loading-spinner i,
            .no-more-content i,
            .error-content i {
                font-size: 18px;
            }

            .loading-spinner span,
            .no-more-content span,
            .error-content {
                font-size: 13px;
            }
        }

        @media (max-width: 480px) {
            .post-composer {
                flex-direction: column;
                gap: 1rem;
            }

            .composer-avatar {
                align-self: flex-start;
            }

            .post-actions {
                justify-content: space-around;
                gap: 1rem;
            }
        }
    </style>
    <!-- Sidebar Styles -->
    <th:block th:replace="~{fragments/sidebar :: sidebar-styles}"></th:block>
</head>
<body>

<!-- Mobile Header -->
<th:block th:replace="~{fragments/sidebar :: mobile-header}"></th:block>

<!-- Sidebar -->
<th:block th:replace="~{fragments/sidebar :: sidebar(${activeSection})}"></th:block>

<div class="main-layout">
    <!-- Main Content Area -->
    <main class="content-area">
        <!-- Header -->
        <div class="content-header">
            <h1 class="header-title">Главная</h1>
        </div>

        <!-- Create Post Section с интеграцией AJAX -->
        <div class="create-post">
            <div class="post-composer">
                <div class="composer-avatar">
                    <i class="fas fa-user" th:if="${currentUser?.imageUrl == null}"></i>
                    <img th:if="${currentUser?.imageUrl}" th:src="${currentUser.imageUrl}" alt="Avatar"
                         style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                </div>
                <div class="composer-content">
                    <!-- Форма для создания поста -->
                    <form id="createPostForm" enctype="multipart/form-data">
                <textarea
                        class="post-textarea"
                        placeholder="Что происходит?"
                        maxlength="1000"
                        id="postContent"
                        name="content"
                        required></textarea>

                        <!-- Скрытое поле для загрузки изображения -->
                        <input type="file"
                               id="imageInput"
                               name="image"
                               accept="image/jpeg,image/jpg,image/png,image/heif,image/heic"
                               style="display: none;">

                        <!-- Предварительный просмотр изображения -->
                        <div id="imagePreview" class="image-preview" style="display: none;">
                            <img id="previewImg" src="" alt="Preview" class="preview-image">
                            <button type="button" class="remove-image-btn" onclick="removeImage()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>

                        <div class="composer-actions">
                            <div class="composer-tools">
                                <button type="button" class="tool-btn" title="Добавить изображение" onclick="selectImage()">
                                    <i class="fas fa-image"></i>
                                </button>
                                <button type="button" class="tool-btn" title="Добавить GIF">
                                    <i class="fas fa-photo-video"></i>
                                </button>
                                <button type="button" class="tool-btn" title="Создать опрос">
                                    <i class="fas fa-poll"></i>
                                </button>
                                <button type="button" class="tool-btn" title="Добавить эмодзи">
                                    <i class="fas fa-smile"></i>
                                </button>

                                <!-- Счетчик символов -->
                                <div class="char-counter">
                                    <span id="charCount">0</span>/1000
                                </div>
                            </div>
                            <button type="submit" class="post-btn" id="postButton" disabled onclick="handleButtonClick(event)">
                                <span class="btn-text">Опубликовать</span>
                                <i class="fas fa-spinner fa-spin btn-spinner" style="display: none;"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Feed -->
        <div class="feed" id="feed">
            <!-- Если есть посты -->
            <div th:if="${recentPosts != null and !recentPosts.posts.empty}" class="posts-container">
                <div class="post-item" th:each="post : ${recentPosts.posts}"
                     onclick="navigateToPost(event, this)"
                     th:data-post-id="${post.id}">

                    <div class="post-header">
                        <a th:href="@{/profile/{userId}(userId=${post.author.id})}" class="post-avatar">
                            <img th:if="${post.author.imageUrl}"
                                 th:src="${post.author.imageUrl}"
                                 th:alt="${post.author.firstName + ' ' + post.author.lastName}">
                            <div th:unless="${post.author.imageUrl}" class="default-avatar">
                                <span th:text="${#strings.substring(post.author.firstName, 0, 1) + #strings.substring(post.author.lastName, 0, 1)}">AB</span>
                            </div>
                        </a>

                        <div class="post-meta">
                            <a th:href="@{/profile/{userId}(userId=${post.author.id})}" class="post-author">
                                <span th:text="${post.author.firstName + ' ' + post.author.lastName}">Имя Автора</span>
                            </a>
                            <span class="post-handle" th:text="'@' + ${post.author.firstName?.toLowerCase()}">@автор</span>
                            <span class="post-time" th:text="'· ' + ${#temporals.format(post.createdAt, 'HH:mm', new java.util.Locale('ru'))}">· 2ч</span>
                        </div>
                    </div>

                    <div class="post-content" th:text="${post.content}">
                        Содержимое поста...
                    </div>

                    <img th:if="${post.hasImage}"
                         th:src="${post.imageUrl}"
                         alt="Изображение поста"
                         class="post-image">

                    <div class="post-actions">
                        <button class="action-btn comment-btn" onclick="openComments(event, this)"
                                th:data-post-id="${post.id}">
                            <i class="fas fa-comment"></i>
                            <span th:text="${post.commentsCount}">0</span>
                        </button>

                        <button class="action-btn like-btn" onclick="toggleLike(event, this)"
                                th:data-post-id="${post.id}">
                            <i class="fas fa-heart"></i>
                            <span th:text="${post.likesCount}">0</span>
                        </button>

                        <button class="action-btn share-btn" onclick="sharePost(event, this)"
                                th:data-post-id="${post.id}">
                            <i class="fas fa-share"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Если нет постов -->
            <div th:unless="${recentPosts != null and !recentPosts.posts.empty}" class="empty-feed">
                <div class="empty-icon">
                    <i class="fas fa-rss"></i>
                </div>
                <h3 class="empty-title">Добро пожаловать!</h3>
                <p class="empty-description">
                    Ваша лента пуста. Подпишитесь на интересных людей, чтобы видеть их посты здесь.
                    <br>Или создайте свой первый пост!
                </p>
                <a href="/recommendations" class="empty-action">
                    <i class="fas fa-user-plus"></i>
                    Найти людей
                </a>
            </div>
        </div>

        <!-- Ссылка на полную ленту (скрываем при использовании бесконечной загрузки) -->
        <div th:if="${recentPosts != null and !recentPosts.posts.empty}" class="view-more-container" id="viewMoreContainer" style="display: none;">
            <a href="/feed" class="view-more-btn">
                <i class="fas fa-arrow-right"></i>
                Посмотреть всю ленту
            </a>
        </div>

    </main>

    <!-- Right Sidebar -->
    <aside class="right-sidebar">
        <!-- Trending Topics -->
        <div class="widget">
            <div class="widget-header">
                <h3 class="widget-title">Актуальные темы</h3>
            </div>
            <div class="widget-content">
                <div class="trending-item">
                    <p class="trending-topic">#ТехнологииБудущего</p>
                    <p class="trending-count">12.5K обсуждений</p>
                </div>
                <div class="trending-item">
                    <p class="trending-topic">#ДизайнТренды2025</p>
                    <p class="trending-count">8.3K обсуждений</p>
                </div>
                <div class="trending-item">
                    <p class="trending-topic">#ИскусственныйИнтеллект</p>
                    <p class="trending-count">15.7K обсуждений</p>
                </div>
                <div class="trending-item">
                    <p class="trending-topic">#WebДевелопмент</p>
                    <p class="trending-count">6.2K обсуждений</p>
                </div>
                <div class="trending-item">
                    <p class="trending-topic">#УдаленнаяРабота</p>
                    <p class="trending-count">9.1K обсуждений</p>
                </div>
            </div>
        </div>

        <!-- Who to Follow -->
        <div class="widget">
            <div class="widget-header">
                <h3 class="widget-title">Кого читать</h3>
            </div>
            <div class="widget-content">
                <div class="suggestion-item">
                    <div class="suggestion-avatar"></div>
                    <div class="suggestion-info">
                        <p class="suggestion-name">Дмитрий Козлов</p>
                        <p class="suggestion-handle">@alex_startup</p>
                    </div>
                    <button class="follow-btn">Читать</button>
                </div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="widget">
            <div class="widget-header">
                <h3 class="widget-title">Ваша активность</h3>
            </div>
            <div class="widget-content">
                <div class="trending-item">
                    <p class="trending-topic">Просмотры профиля</p>
                    <p class="trending-count">47 за эту неделю</p>
                </div>
                <div class="trending-item">
                    <p class="trending-topic">Упоминания</p>
                    <p class="trending-count">12 новых</p>
                </div>
                <div class="trending-item">
                    <p class="trending-topic">Подписчики</p>
                    <p class="trending-count">+5 за день</p>
                </div>
            </div>
        </div>

        <!-- Footer Links -->
        <div style="padding: 1rem 0; font-size: 0.8125rem; color: var(--text-muted); line-height: 1.4;">
            <a href="/terms" style="color: inherit; text-decoration: none; margin-right: 1rem;">Условия</a>
            <a href="/privacy" style="color: inherit; text-decoration: none; margin-right: 1rem;">Конфиденциальность</a>
            <a href="/help" style="color: inherit; text-decoration: none;">Помощь</a>
            <p style="margin-top: 0.5rem; margin-bottom: 0;">© 2025 Cleopatra</p>
        </div>
    </aside>
</div>

<!-- JS в конце страницы -->
<th:block th:replace="~{fragments/sidebar :: sidebar-scripts}"></th:block>

<script>
    // ============================================
    // ПЕРЕМЕННЫЕ ДЛЯ БЕСКОНЕЧНОЙ ЗАГРУЗКИ
    // ============================================
    let currentPage = 1; // Начинаем с 1, так как страница 0 уже загружена
    let isLoading = false;
    let hasMorePosts = true;
    const postsPerPage = 10;

    // ============================================
    // ФУНКЦИИ ДЛЯ БЕСКОНЕЧНОЙ ЗАГРУЗКИ
    // ============================================

    // Функция для создания HTML поста
    function createPostHTML(post) {
        const authorInitials = post.author.firstName.substring(0, 1) + post.author.lastName.substring(0, 1);
        const authorFullName = post.author.firstName + ' ' + post.author.lastName;
        const postTime = new Date(post.createdAt).toLocaleTimeString('ru-RU', {
            hour: '2-digit',
            minute: '2-digit'
        });

        return `
            <div class="post-item" onclick="navigateToPost(event, this)" data-post-id="${post.id}">
                <div class="post-header">
                    <a href="/profile/${post.author.id}" class="post-avatar">
                        ${post.author.imageUrl ?
            `<img src="${post.author.imageUrl}" alt="${authorFullName}">` :
            `<div class="default-avatar"><span>${authorInitials}</span></div>`
        }
                    </a>

                    <div class="post-meta">
                        <a href="/profile/${post.author.id}" class="post-author">
                            <span>${authorFullName}</span>
                        </a>
                        <span class="post-handle">@${post.author.firstName.toLowerCase()}</span>
                        <span class="post-time">· ${postTime}</span>
                    </div>
                </div>

                <div class="post-content">${post.content}</div>

                ${post.hasImage ? `<img src="${post.imageUrl}" alt="Изображение поста" class="post-image">` : ''}

                <div class="post-actions">
                    <button class="action-btn comment-btn" onclick="openComments(event, this)" data-post-id="${post.id}">
                        <i class="fas fa-comment"></i>
                        <span>${post.commentsCount}</span>
                    </button>

                    <button class="action-btn like-btn" onclick="toggleLike(event, this)" data-post-id="${post.id}">
                        <i class="fas fa-heart"></i>
                        <span>${post.likesCount}</span>
                    </button>

                    <button class="action-btn share-btn" onclick="sharePost(event, this)" data-post-id="${post.id}">
                        <i class="fas fa-share"></i>
                    </button>
                </div>
            </div>
        `;
    }

    // Функция загрузки постов
    async function loadMorePosts() {
        if (isLoading || !hasMorePosts) {
            return;
        }

        isLoading = true;
        showLoadingIndicator();

        try {
            const response = await fetch(`/feed/api/posts?page=${currentPage}&size=${postsPerPage}`);
            if (!response.ok) {
                throw new Error('Ошибка загрузки постов');
            }

            const data = await response.json();

            if (data.posts && data.posts.length > 0) {
                appendPostsToFeed(data.posts);
                currentPage++;

                // Проверяем, есть ли еще посты
                hasMorePosts = data.posts.length === postsPerPage;
            } else {
                hasMorePosts = false;
                showNoMorePostsMessage();
            }

        } catch (error) {
            console.error('Ошибка при загрузке постов:', error);
            showErrorMessage();
        } finally {
            isLoading = false;
            hideLoadingIndicator();
        }
    }

    // Функция добавления постов в ленту
    function appendPostsToFeed(posts) {
        const feedContainer = document.getElementById('feed');
        let existingPostsContainer = feedContainer.querySelector('.posts-container');

        // Если контейнер не существует, создаем его
        if (!existingPostsContainer) {
            existingPostsContainer = document.createElement('div');
            existingPostsContainer.className = 'posts-container';

            // Вставляем контейнер после секции создания поста, но до empty-feed
            const emptyFeed = feedContainer.querySelector('.empty-feed');
            if (emptyFeed) {
                feedContainer.insertBefore(existingPostsContainer, emptyFeed);
                emptyFeed.style.display = 'none'; // Скрываем empty state
            } else {
                feedContainer.appendChild(existingPostsContainer);
            }
        }

        posts.forEach(post => {
            const postElement = document.createElement('div');
            postElement.innerHTML = createPostHTML(post);
            existingPostsContainer.appendChild(postElement.firstElementChild);
        });
    }

    // Функция показа индикатора загрузки
    function showLoadingIndicator() {
        let loadingIndicator = document.getElementById('loading-indicator');

        if (!loadingIndicator) {
            loadingIndicator = document.createElement('div');
            loadingIndicator.id = 'loading-indicator';
            loadingIndicator.className = 'loading-indicator';
            loadingIndicator.innerHTML = `
                <div class="loading-spinner">
                    <i class="fas fa-spinner fa-spin"></i>
                    <span>Загрузка постов...</span>
                </div>
            `;
            document.getElementById('feed').appendChild(loadingIndicator);
        }

        loadingIndicator.style.display = 'block';
    }

    // Функция скрытия индикатора загрузки
    function hideLoadingIndicator() {
        const loadingIndicator = document.getElementById('loading-indicator');
        if (loadingIndicator) {
            loadingIndicator.style.display = 'none';
        }
    }

    // Функция показа сообщения об отсутствии постов
    function showNoMorePostsMessage() {
        let noMoreMessage = document.getElementById('no-more-posts');

        if (!noMoreMessage) {
            noMoreMessage = document.createElement('div');
            noMoreMessage.id = 'no-more-posts';
            noMoreMessage.className = 'no-more-posts';
            noMoreMessage.innerHTML = `
                <div class="no-more-content">
                    <i class="fas fa-check-circle"></i>
                    <span>Вы просмотрели все посты</span>
                </div>
            `;
            document.getElementById('feed').appendChild(noMoreMessage);
        }

        noMoreMessage.style.display = 'block';
    }

    // Функция показа сообщения об ошибке
    function showErrorMessage() {
        let errorMessage = document.getElementById('error-message');

        if (!errorMessage) {
            errorMessage = document.createElement('div');
            errorMessage.id = 'error-message';
            errorMessage.className = 'error-message';
            errorMessage.innerHTML = `
                <div class="error-content">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Ошибка загрузки. Попробуйте позже.</span>
                    <button onclick="retryLoading()" class="retry-btn">Повторить</button>
                </div>
            `;
            document.getElementById('feed').appendChild(errorMessage);
        }

        errorMessage.style.display = 'block';
    }

    // Функция повторной загрузки
    function retryLoading() {
        const errorMessage = document.getElementById('error-message');
        if (errorMessage) {
            errorMessage.style.display = 'none';
        }
        loadMorePosts();
    }

    // Функция определения достижения конца страницы
    function isNearBottom() {
        const threshold = 200; // Загружать за 200px до конца
        return window.innerHeight + window.scrollY >= document.body.offsetHeight - threshold;
    }

    // Обработчик скролла с throttling
    let scrollTimeout;
    function handleScroll() {
        if (scrollTimeout) {
            clearTimeout(scrollTimeout);
        }

        scrollTimeout = setTimeout(() => {
            if (isNearBottom()) {
                loadMorePosts();
            }
        }, 100); // Throttling на 100ms
    }

    // Инициализация бесконечной загрузки
    function initInfiniteScroll() {
        // Проверяем, есть ли уже загруженные посты
        const existingPosts = document.querySelectorAll('.post-item');
        if (existingPosts.length > 0) {
            // Если есть посты, значит мы уже на странице 0, следующая будет 1
            currentPage = 1;
            hasMorePosts = existingPosts.length === postsPerPage;
        } else {
            // Если постов нет, начинаем с 0
            currentPage = 0;
            hasMorePosts = true;
        }

        // Добавляем обработчик скролла
        window.addEventListener('scroll', handleScroll);

        console.log('Бесконечная загрузка инициализирована');
    }

    // Функция очистки обработчиков (для SPA)
    function destroyInfiniteScroll() {
        window.removeEventListener('scroll', handleScroll);
        if (scrollTimeout) {
            clearTimeout(scrollTimeout);
        }
    }

    // ============================================
    // ОРИГИНАЛЬНЫЕ ФУНКЦИИ СОЗДАНИЯ ПОСТОВ
    // ============================================

    console.log('🚀 Загружаем скрипт создания постов...');

    // Функция инициализации - вызывается когда DOM готов
    function initializePostComposer() {
        console.log('🔧 Инициализация composer...');

        // Проверяем наличие всех элементов
        const postContent = document.getElementById('postContent');
        const postButton = document.getElementById('postButton');
        const charCount = document.getElementById('charCount');
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');
        const previewImg = document.getElementById('previewImg');
        const createPostForm = document.getElementById('createPostForm');

        console.log('📋 Элементы формы:', {
            postContent: !!postContent,
            postButton: !!postButton,
            charCount: !!charCount,
            imageInput: !!imageInput,
            createPostForm: !!createPostForm
        });

        if (!postContent || !postButton || !createPostForm) {
            console.error('❌ Не найдены обязательные элементы формы!');
            return;
        }

        // Счетчик символов и валидация
        postContent.addEventListener('input', function() {
            console.log('📝 Ввод текста:', this.value.length);
            const length = this.value.length;
            const maxLength = 1000;

            if (charCount) {
                charCount.textContent = length;

                // Обновляем стиль счетчика
                const counter = charCount.parentElement;
                counter.className = 'char-counter';
                if (length > maxLength * 0.9) {
                    counter.classList.add('warning');
                }
                if (length > maxLength * 0.95) {
                    counter.classList.remove('warning');
                    counter.classList.add('danger');
                }
            }

            // Активируем/деактивируем кнопку
            const isValid = length > 0 && length <= maxLength;
            postButton.disabled = !isValid;
            console.log('🔘 Кнопка активна:', isValid);
        });

        // Обработка загрузки изображения
        if (imageInput) {
            imageInput.addEventListener('change', function(event) {
                console.log('🖼️ Выбрано изображение');
                handleImageSelect(event);
            });
        }

        // Отправка формы
        createPostForm.addEventListener('submit', function(event) {
            console.log('📤 Отправка формы...');
            handleFormSubmit(event);
        });

        console.log('✅ Инициализация завершена');
    }

    // Функции для работы с изображениями
    function selectImage() {
        console.log('🖼️ Открываем выбор изображения...');
        const imageInput = document.getElementById('imageInput');
        if (imageInput) {
            imageInput.click();
        } else {
            console.error('❌ imageInput не найден');
        }
    }

    function handleImageSelect(event) {
        const file = event.target.files[0];
        if (!file) {
            console.log('❌ Файл не выбран');
            return;
        }

        console.log('📁 Обрабатываем файл:', file.name, file.type, file.size);

        // Валидация типа файла
        const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/heif', 'image/heic'];
        if (!allowedTypes.includes(file.type)) {
            showNotification('Неподдерживаемый формат файла. Используйте JPG, PNG, HEIF или HEIC.', 'error');
            event.target.value = '';
            return;
        }

        // Валидация размера файла (10MB)
        const maxSize = 10 * 1024 * 1024;
        if (file.size > maxSize) {
            showNotification('Файл слишком большой. Максимальный размер: 10MB.', 'error');
            event.target.value = '';
            return;
        }

        // Показываем превью
        const reader = new FileReader();
        reader.onload = function(e) {
            const previewImg = document.getElementById('previewImg');
            const imagePreview = document.getElementById('imagePreview');

            if (previewImg && imagePreview) {
                previewImg.src = e.target.result;
                imagePreview.style.display = 'block';
                console.log('✅ Превью показано');
            }
        };
        reader.readAsDataURL(file);
    }

    function removeImage() {
        console.log('🗑️ Удаляем изображение...');
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');

        if (imageInput) imageInput.value = '';
        if (imagePreview) imagePreview.style.display = 'none';
    }

    // Обработчик клика кнопки (дублирует submit)
    function handleButtonClick(event) {
        console.log('🖱️ Клик по кнопке Опубликовать');
        event.preventDefault();
        handleFormSubmit(event);
    }

    // Обработка отправки формы
    async function handleFormSubmit(event) {
        event.preventDefault();
        console.log('🚀 Начинаем отправку формы...');

        const postContent = document.getElementById('postContent');
        const imageInput = document.getElementById('imageInput');

        const content = postContent.value.trim();
        if (!content) {
            showNotification('Введите текст поста', 'error');
            return;
        }

        // Показываем состояние загрузки
        setLoadingState(true);

        try {
            // Создаем FormData
            const formData = new FormData();
            formData.append('content', content);

            if (imageInput && imageInput.files[0]) {
                formData.append('image', imageInput.files[0]);
                console.log('📎 Добавлено изображение к запросу');
            }

            console.log('📤 Отправляем запрос на /posts/api/create');

            // Отправляем запрос
            const response = await fetch('/posts/api/create', {
                method: 'POST',
                body: formData
            });

            console.log('📥 Получен ответ:', response.status, response.statusText);

            if (response.ok) {
                const result = await response.json();
                console.log('✅ Пост создан:', result);
                showNotification('Пост успешно создан!', 'success');

                // Очищаем форму
                resetForm();

                // Обновляем ленту - можно перезагрузить страницу или добавить новый пост в начало
                setTimeout(() => {
                    location.reload();
                }, 1000);

            } else {
                const errorText = await response.text();
                console.error('❌ Ошибка ответа:', errorText);
                showNotification('Ошибка при создании поста: ' + response.status, 'error');
            }
        } catch (error) {
            console.error('❌ Ошибка при создании поста:', error);
            showNotification('Произошла ошибка при создании поста', 'error');
        } finally {
            setLoadingState(false);
        }
    }

    // Управление состоянием загрузки
    function setLoadingState(loading) {
        console.log('⏳ Состояние загрузки:', loading);
        const postButton = document.getElementById('postButton');
        const btnText = postButton?.querySelector('.btn-text');
        const btnSpinner = postButton?.querySelector('.btn-spinner');

        if (!postButton) return;

        postButton.disabled = loading;

        if (loading) {
            if (btnText) btnText.style.opacity = '0';
            if (btnSpinner) btnSpinner.style.display = 'inline-block';
        } else {
            if (btnText) btnText.style.opacity = '1';
            if (btnSpinner) btnSpinner.style.display = 'none';
        }
    }

    // Сброс формы
    function resetForm() {
        console.log('🔄 Сбрасываем форму...');
        const postContent = document.getElementById('postContent');
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');
        const charCount = document.getElementById('charCount');
        const postButton = document.getElementById('postButton');

        if (postContent) postContent.value = '';
        if (imageInput) imageInput.value = '';
        if (imagePreview) imagePreview.style.display = 'none';
        if (charCount) {
            charCount.textContent = '0';
            charCount.parentElement.className = 'char-counter';
        }
        if (postButton) postButton.disabled = true;
    }

    // Показ уведомлений
    function showNotification(message, type = 'success') {
        console.log('🔔 Уведомление:', type, message);

        // Удаляем существующие уведомления
        const existingNotifications = document.querySelectorAll('.notification');
        existingNotifications.forEach(n => n.remove());

        // Создаем новое уведомление
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerHTML = `
            <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}" style="margin-right: 0.5rem;"></i>
            ${message}
        `;

        document.body.appendChild(notification);

        // Показываем уведомление
        setTimeout(() => {
            notification.classList.add('show');
        }, 100);

        // Скрываем через 3 секунды
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        }, 3000);
    }

    // Функции для работы с постами
    function navigateToPost(event, element) {
        // Проверяем, что клик не был по кнопке действия
        if (event.target.closest('.action-btn') || event.target.closest('.post-author')) {
            return;
        }

        const postId = element.getAttribute('data-post-id');
        if (postId) {
            window.location.href = `/posts/${postId}`;
        }
    }

    function openComments(event, button) {
        event.stopPropagation();
        const postId = button.getAttribute('data-post-id');
        if (postId) {
            window.location.href = `/posts/${postId}#comments`;
        }
    }

    async function toggleLike(event, button) {
        event.stopPropagation();
        const postId = button.getAttribute('data-post-id');

        if (!postId) return;

        try {
            const response = await fetch(`/posts/${postId}/like`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                const result = await response.json();

                // Обновляем UI
                const icon = button.querySelector('i');
                const count = button.querySelector('span');

                if (result.liked) {
                    button.classList.add('liked');
                    icon.classList.remove('far');
                    icon.classList.add('fas');
                } else {
                    button.classList.remove('liked');
                    icon.classList.remove('fas');
                    icon.classList.add('far');
                }

                count.textContent = result.likesCount;
            }
        } catch (error) {
            console.error('Ошибка при лайке:', error);
            showNotification('Ошибка при обновлении лайка', 'error');
        }
    }

    function sharePost(event, button) {
        event.stopPropagation();
        const postId = button.getAttribute('data-post-id');

        if (navigator.share) {
            navigator.share({
                title: 'Пост из Cleopatra',
                url: `${window.location.origin}/posts/${postId}`
            });
        } else {
            // Fallback - копируем ссылку в буфер обмена
            const url = `${window.location.origin}/posts/${postId}`;
            navigator.clipboard.writeText(url).then(() => {
                showNotification('Ссылка скопирована в буфер обмена', 'success');
            }).catch(() => {
                showNotification('Не удалось скопировать ссылку', 'error');
            });
        }
    }

    // ============================================
    // ИНИЦИАЛИЗАЦИЯ
    // ============================================

    // Инициализация при загрузке страницы
    document.addEventListener('DOMContentLoaded', function() {
        // Инициализируем composer
        initializePostComposer();

        // Инициализируем бесконечную загрузку
        initInfiniteScroll();

        // Инициализация кнопок подписки
        document.querySelectorAll('.follow-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                if (this.textContent === 'Читать') {
                    this.textContent = 'Читаем';
                    this.style.background = '#10b981';
                } else {
                    this.textContent = 'Читать';
                    this.style.background = '';
                }
            });
        });

        // Анимации для tool buttons
        document.querySelectorAll('.tool-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                this.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    this.style.transform = '';
                }, 150);
            });
        });

        console.log('🐦 Dashboard инициализирован');
        console.log('📝 Composer готов к работе');
        console.log('👥 Социальные функции активированы');
        console.log('♾️ Бесконечная загрузка активирована');
    });

    // Инициализация если DOM уже загружен
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            initializePostComposer();
            initInfiniteScroll();
        });
    } else {
        initializePostComposer();
        initInfiniteScroll();
    }

    // Экспорт функций для использования в других частях приложения
    window.infiniteScroll = {
        init: initInfiniteScroll,
        destroy: destroyInfiniteScroll,
        loadMore: loadMorePosts
    };

    console.log('📝 Скрипт создания постов загружен');
    console.log('♾️ Скрипт бесконечной загрузки загружен');
</script>
</body>
</html>