<!--<!DOCTYPE html>-->
<!--<html lang="ru" xmlns:th="http://www.thymeleaf.org">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>Редактирование профиля - Cleopatra</title>-->

<!--    &lt;!&ndash; External CSS &ndash;&gt;-->
<!--    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">-->
<!--    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">-->
<!--    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">-->

<!--    &lt;!&ndash; Стили sidebar &ndash;&gt;-->
<!--    <th:block th:replace="~{fragments/sidebar :: sidebar-styles}"></th:block>-->

<!--    <style>-->
<!--        /* Основные стили страницы */-->
<!--        body {-->
<!--            background: linear-gradient(135deg, var(&#45;&#45;bg-primary) 0%, var(&#45;&#45;bg-accent) 100%);-->
<!--            color: var(&#45;&#45;text-primary);-->
<!--            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;-->
<!--            font-weight: 400;-->
<!--            line-height: 1.6;-->
<!--            min-height: 100vh;-->
<!--        }-->

<!--        /* Main Content */-->
<!--        .main-content {-->
<!--            margin-left: 280px;-->
<!--            min-height: 100vh;-->
<!--            padding: 2rem;-->
<!--        }-->

<!--        /* Page Header */-->
<!--        .page-header {-->
<!--            background: var(&#45;&#45;bg-secondary);-->
<!--            border-radius: var(&#45;&#45;radius-xl);-->
<!--            padding: 2rem 2.5rem;-->
<!--            margin-bottom: 2rem;-->
<!--            box-shadow: var(&#45;&#45;shadow-lg);-->
<!--            border: 1px solid var(&#45;&#45;border-primary);-->
<!--        }-->

<!--        .page-title {-->
<!--            font-family: 'Playfair Display', serif;-->
<!--            font-size: 2.25rem;-->
<!--            font-weight: 600;-->
<!--            color: var(&#45;&#45;text-primary);-->
<!--            margin: 0 0 0.5rem 0;-->
<!--            letter-spacing: -0.02em;-->
<!--        }-->

<!--        .page-subtitle {-->
<!--            color: var(&#45;&#45;text-secondary);-->
<!--            font-size: 1.125rem;-->
<!--            margin: 0;-->
<!--        }-->

<!--        /* Form Container */-->
<!--        .form-container {-->
<!--            background: var(&#45;&#45;bg-secondary);-->
<!--            border-radius: var(&#45;&#45;radius-xl);-->
<!--            box-shadow: var(&#45;&#45;shadow-lg);-->
<!--            border: 1px solid var(&#45;&#45;border-primary);-->
<!--            overflow: hidden;-->
<!--        }-->

<!--        /* Form Sections */-->
<!--        .form-section {-->
<!--            padding: 2.5rem;-->
<!--            border-bottom: 1px solid var(&#45;&#45;border-secondary);-->
<!--        }-->

<!--        .form-section:last-child {-->
<!--            border-bottom: none;-->
<!--        }-->

<!--        .section-title {-->
<!--            font-family: 'Playfair Display', serif;-->
<!--            font-size: 1.5rem;-->
<!--            font-weight: 600;-->
<!--            color: var(&#45;&#45;text-primary);-->
<!--            margin: 0 0 1.5rem 0;-->
<!--            letter-spacing: -0.01em;-->
<!--        }-->

<!--        .section-description {-->
<!--            color: var(&#45;&#45;text-secondary);-->
<!--            font-size: 0.9375rem;-->
<!--            margin-bottom: 2rem;-->
<!--            line-height: 1.6;-->
<!--        }-->

<!--        /* Profile Photo Section */-->
<!--        .photo-section {-->
<!--            background: linear-gradient(135deg, var(&#45;&#45;bg-accent), #f8fafc);-->
<!--        }-->

<!--        .photo-upload-area {-->
<!--            display: flex;-->
<!--            align-items: center;-->
<!--            gap: 2rem;-->
<!--            margin-bottom: 1.5rem;-->
<!--        }-->

<!--        .current-avatar {-->
<!--            position: relative;-->
<!--        }-->

<!--        .avatar-preview {-->
<!--            width: 120px;-->
<!--            height: 120px;-->
<!--            border-radius: 50%;-->
<!--            border: 4px solid var(&#45;&#45;bg-secondary);-->
<!--            box-shadow: var(&#45;&#45;shadow-md);-->
<!--            overflow: hidden;-->
<!--            background: linear-gradient(135deg, var(&#45;&#45;bg-accent), #f1f5f9);-->
<!--            display: flex;-->
<!--            align-items: center;-->
<!--            justify-content: center;-->
<!--            color: var(&#45;&#45;text-muted);-->
<!--            font-size: 2.5rem;-->
<!--        }-->

<!--        .avatar-image {-->
<!--            width: 100%;-->
<!--            height: 100%;-->
<!--            object-fit: cover;-->
<!--        }-->

<!--        .photo-controls {-->
<!--            flex: 1;-->
<!--        }-->

<!--        .upload-info {-->
<!--            margin-bottom: 1rem;-->
<!--        }-->

<!--        .upload-hint {-->
<!--            font-size: 0.875rem;-->
<!--            color: var(&#45;&#45;text-muted);-->
<!--            margin: 0;-->
<!--        }-->

<!--        /* Background Photo Section */-->
<!--        .background-preview {-->
<!--            width: 100%;-->
<!--            height: 200px;-->
<!--            border-radius: var(&#45;&#45;radius-lg);-->
<!--            border: 2px dashed var(&#45;&#45;border-primary);-->
<!--            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);-->
<!--            display: flex;-->
<!--            align-items: center;-->
<!--            justify-content: center;-->
<!--            margin-bottom: 1.5rem;-->
<!--            overflow: hidden;-->
<!--            position: relative;-->
<!--        }-->

<!--        .background-image {-->
<!--            width: 100%;-->
<!--            height: 100%;-->
<!--            object-fit: cover;-->
<!--        }-->

<!--        .background-placeholder {-->
<!--            text-align: center;-->
<!--            color: rgba(255, 255, 255, 0.8);-->
<!--        }-->

<!--        .background-placeholder i {-->
<!--            font-size: 2.5rem;-->
<!--            margin-bottom: 0.5rem;-->
<!--        }-->

<!--        /* Form Controls */-->
<!--        .form-group {-->
<!--            margin-bottom: 1.5rem;-->
<!--        }-->

<!--        .form-label {-->
<!--            font-weight: 600;-->
<!--            color: var(&#45;&#45;text-primary);-->
<!--            margin-bottom: 0.5rem;-->
<!--            font-size: 0.9375rem;-->
<!--            letter-spacing: 0.01em;-->
<!--        }-->

<!--        .form-control-luxury {-->
<!--            background: var(&#45;&#45;bg-accent);-->
<!--            border: 1px solid var(&#45;&#45;border-secondary);-->
<!--            border-radius: var(&#45;&#45;radius-md);-->
<!--            padding: 0.875rem 1.125rem;-->
<!--            font-size: 0.9375rem;-->
<!--            color: var(&#45;&#45;text-primary);-->
<!--            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);-->
<!--            width: 100%;-->
<!--            font-family: inherit;-->
<!--        }-->

<!--        .form-control-luxury:focus {-->
<!--            outline: none;-->
<!--            border-color: var(&#45;&#45;accent-primary);-->
<!--            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);-->
<!--            background: var(&#45;&#45;bg-secondary);-->
<!--        }-->

<!--        .form-control-luxury::placeholder {-->
<!--            color: var(&#45;&#45;text-muted);-->
<!--        }-->

<!--        /* File Upload */-->
<!--        .file-upload {-->
<!--            position: relative;-->
<!--            overflow: hidden;-->
<!--            display: inline-block;-->
<!--        }-->

<!--        .file-upload input[type=file] {-->
<!--            position: absolute;-->
<!--            left: -9999px;-->
<!--        }-->

<!--        .upload-btn {-->
<!--            background: linear-gradient(135deg, var(&#45;&#45;accent-primary), var(&#45;&#45;accent-secondary));-->
<!--            color: white;-->
<!--            border: none;-->
<!--            padding: 0.75rem 1.5rem;-->
<!--            border-radius: var(&#45;&#45;radius-md);-->
<!--            font-weight: 500;-->
<!--            font-size: 0.875rem;-->
<!--            cursor: pointer;-->
<!--            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);-->
<!--            display: inline-flex;-->
<!--            align-items: center;-->
<!--            gap: 0.5rem;-->
<!--            letter-spacing: 0.01em;-->
<!--        }-->

<!--        .upload-btn:hover {-->
<!--            transform: translateY(-2px);-->
<!--            box-shadow: var(&#45;&#45;shadow-lg);-->
<!--        }-->

<!--        .remove-btn {-->
<!--            background: linear-gradient(135deg, #dc2626, #b91c1c);-->
<!--            color: white;-->
<!--            border: none;-->
<!--            padding: 0.75rem 1.5rem;-->
<!--            border-radius: var(&#45;&#45;radius-md);-->
<!--            font-weight: 500;-->
<!--            font-size: 0.875rem;-->
<!--            cursor: pointer;-->
<!--            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);-->
<!--            display: inline-flex;-->
<!--            align-items: center;-->
<!--            gap: 0.5rem;-->
<!--            margin-left: 0.75rem;-->
<!--        }-->

<!--        .remove-btn:hover {-->
<!--            transform: translateY(-2px);-->
<!--            box-shadow: var(&#45;&#45;shadow-lg);-->
<!--        }-->

<!--        /* Action Buttons */-->
<!--        .form-actions {-->
<!--            display: flex;-->
<!--            gap: 1rem;-->
<!--            justify-content: flex-end;-->
<!--            align-items: center;-->
<!--        }-->

<!--        .btn-luxury {-->
<!--            padding: 0.875rem 2rem;-->
<!--            border-radius: var(&#45;&#45;radius-md);-->
<!--            font-weight: 600;-->
<!--            font-size: 0.9375rem;-->
<!--            letter-spacing: 0.01em;-->
<!--            text-decoration: none;-->
<!--            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);-->
<!--            border: 1px solid var(&#45;&#45;border-primary);-->
<!--            display: inline-flex;-->
<!--            align-items: center;-->
<!--            gap: 0.5rem;-->
<!--            cursor: pointer;-->
<!--            position: relative;-->
<!--            overflow: hidden;-->
<!--        }-->

<!--        .btn-luxury::before {-->
<!--            content: '';-->
<!--            position: absolute;-->
<!--            top: 0;-->
<!--            left: -100%;-->
<!--            width: 100%;-->
<!--            height: 100%;-->
<!--            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);-->
<!--            transition: left 0.5s;-->
<!--        }-->

<!--        .btn-luxury:hover::before {-->
<!--            left: 100%;-->
<!--        }-->

<!--        .btn-primary-luxury {-->
<!--            background: linear-gradient(135deg, var(&#45;&#45;accent-primary), var(&#45;&#45;accent-secondary));-->
<!--            color: white;-->
<!--            border-color: transparent;-->
<!--            box-shadow: var(&#45;&#45;shadow-md);-->
<!--        }-->

<!--        .btn-primary-luxury:hover {-->
<!--            transform: translateY(-2px);-->
<!--            box-shadow: var(&#45;&#45;shadow-lg);-->
<!--            color: white;-->
<!--        }-->

<!--        .btn-secondary-luxury {-->
<!--            background: var(&#45;&#45;bg-secondary);-->
<!--            color: var(&#45;&#45;text-primary);-->
<!--            border-color: var(&#45;&#45;border-secondary);-->
<!--        }-->

<!--        .btn-secondary-luxury:hover {-->
<!--            background: var(&#45;&#45;bg-accent);-->
<!--            color: var(&#45;&#45;text-primary);-->
<!--            transform: translateY(-1px);-->
<!--            box-shadow: var(&#45;&#45;shadow-md);-->
<!--            text-decoration: none;-->
<!--        }-->

<!--        /* Error Messages */-->
<!--        .error-message {-->
<!--            color: #dc2626;-->
<!--            font-size: 0.8125rem;-->
<!--            margin-top: 0.5rem;-->
<!--            display: flex;-->
<!--            align-items: center;-->
<!--            gap: 0.375rem;-->
<!--        }-->

<!--        .error-message i {-->
<!--            font-size: 0.75rem;-->
<!--        }-->

<!--        /* Success/Error Alerts */-->
<!--        .alert-luxury {-->
<!--            border: none;-->
<!--            border-radius: var(&#45;&#45;radius-md);-->
<!--            margin-bottom: 2rem;-->
<!--            padding: 1rem 1.5rem;-->
<!--            box-shadow: var(&#45;&#45;shadow-sm);-->
<!--            display: flex;-->
<!--            align-items: center;-->
<!--            gap: 0.75rem;-->
<!--        }-->

<!--        .alert-success-luxury {-->
<!--            background: linear-gradient(135deg, rgba(5, 150, 105, 0.1), rgba(16, 185, 129, 0.1));-->
<!--            color: var(&#45;&#45;accent-success);-->
<!--            border-left: 4px solid var(&#45;&#45;accent-success);-->
<!--        }-->

<!--        .alert-danger-luxury {-->
<!--            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(248, 113, 113, 0.1));-->
<!--            color: #dc2626;-->
<!--            border-left: 4px solid #dc2626;-->
<!--        }-->

<!--        /* Responsive Design */-->
<!--        @media (max-width: 1024px) {-->
<!--            .main-content {-->
<!--                margin-left: 80px;-->
<!--            }-->
<!--        }-->

<!--        @media (max-width: 768px) {-->
<!--            .main-content {-->
<!--                margin-left: 0;-->
<!--                margin-top: 60px;-->
<!--                padding: 1rem;-->
<!--            }-->

<!--            .page-header,-->
<!--            .form-section {-->
<!--                padding: 1.5rem;-->
<!--            }-->

<!--            .page-title {-->
<!--                font-size: 1.875rem;-->
<!--            }-->

<!--            .photo-upload-area {-->
<!--                flex-direction: column;-->
<!--                text-align: center;-->
<!--                gap: 1.5rem;-->
<!--            }-->

<!--            .form-actions {-->
<!--                flex-direction: column-reverse;-->
<!--                gap: 0.75rem;-->
<!--            }-->

<!--            .btn-luxury {-->
<!--                width: 100%;-->
<!--                justify-content: center;-->
<!--            }-->
<!--        }-->

<!--        @media (max-width: 480px) {-->
<!--            .avatar-preview {-->
<!--                width: 100px;-->
<!--                height: 100px;-->
<!--            }-->

<!--            .background-preview {-->
<!--                height: 150px;-->
<!--            }-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--&lt;!&ndash; Mobile Header &ndash;&gt;-->
<!--<th:block th:replace="~{fragments/sidebar :: mobile-header}"></th:block>-->

<!--&lt;!&ndash; Sidebar с активной секцией &ndash;&gt;-->
<!--<th:block th:replace="~{fragments/sidebar :: sidebar('profile')}"></th:block>-->

<!--&lt;!&ndash; Main Content &ndash;&gt;-->
<!--<main class="main-content">-->
<!--    &lt;!&ndash; Success/Error Messages &ndash;&gt;-->
<!--    <div th:if="${successMessage}" class="alert-luxury alert-success-luxury">-->
<!--        <i class="fas fa-check-circle"></i>-->
<!--        <span th:text="${successMessage}"></span>-->
<!--    </div>-->

<!--    <div th:if="${errorMessage}" class="alert-luxury alert-danger-luxury">-->
<!--        <i class="fas fa-exclamation-circle"></i>-->
<!--        <span th:text="${errorMessage}"></span>-->
<!--    </div>-->

<!--    &lt;!&ndash; Page Header &ndash;&gt;-->
<!--    <div class="page-header">-->
<!--        <h1 class="page-title">Редактирование профиля</h1>-->
<!--        <p class="page-subtitle">Персонализируйте свой профиль и настройте отображение</p>-->
<!--    </div>-->

<!--    &lt;!&ndash; Form Container &ndash;&gt;-->
<!--    <div class="form-container">-->
<!--        <form                   th:action="@{/profile/{userId}/update(userId=${user.id})}"-->
<!--                                th:object="${updateProfileDto}"-->
<!--                                method="post"-->
<!--                                enctype="multipart/form-data">-->

<!--            &lt;!&ndash; Personal Information Section &ndash;&gt;-->
<!--            <div class="form-section">-->
<!--                <h2 class="section-title">Личная информация</h2>-->
<!--                <p class="section-description">-->
<!--                    Обновите ваше имя и фамилию. Эта информация будет отображаться в вашем профиле и видна другим пользователям.-->
<!--                </p>-->

<!--                <div class="row">-->
<!--                    <div class="col-md-6">-->
<!--                        <div class="form-group">-->
<!--                            <label for="firstName" class="form-label">Имя</label>-->
<!--                            <input type="text"-->
<!--                                   id="firstName"-->
<!--                                   th:field="*{firstName}"-->
<!--                                   class="form-control-luxury"-->
<!--                                   placeholder="Введите ваше имя"-->
<!--                                   maxlength="50">-->
<!--                            <div th:if="${#fields.hasErrors('firstName')}" class="error-message">-->
<!--                                <i class="fas fa-exclamation-triangle"></i>-->
<!--                                <span th:errors="*{firstName}"></span>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                    <div class="col-md-6">-->
<!--                        <div class="form-group">-->
<!--                            <label for="lastName" class="form-label">Фамилия</label>-->
<!--                            <input type="text"-->
<!--                                   id="lastName"-->
<!--                                   th:field="*{lastName}"-->
<!--                                   class="form-control-luxury"-->
<!--                                   placeholder="Введите вашу фамилию"-->
<!--                                   maxlength="50">-->
<!--                            <div th:if="${#fields.hasErrors('lastName')}" class="error-message">-->
<!--                                <i class="fas fa-exclamation-triangle"></i>-->
<!--                                <span th:errors="*{lastName}"></span>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->

<!--            &lt;!&ndash; Profile Photo Section &ndash;&gt;-->
<!--            <div class="form-section photo-section">-->
<!--                <h2 class="section-title">Фотография профиля</h2>-->
<!--                <p class="section-description">-->
<!--                    Загрузите фотографию для вашего профиля. Рекомендуемый размер: 400x400 пикселей или больше.-->
<!--                </p>-->

<!--                <div class="photo-upload-area">-->
<!--                    <div class="current-avatar">-->
<!--                        <div class="avatar-preview">-->
<!--                            <img th:if="${user.imageUrl}"-->
<!--                                 th:src="${user.imageUrl}"-->
<!--                                 alt="Текущий аватар"-->
<!--                                 class="avatar-image"-->
<!--                                 id="avatarPreview">-->
<!--                            <div th:unless="${user.imageUrl}" id="avatarPlaceholder">-->
<!--                                <i class="fas fa-user"></i>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                    <div class="photo-controls">-->
<!--                        <div class="upload-info">-->
<!--                            <p class="upload-hint">-->
<!--                                <i class="fas fa-info-circle me-1"></i>-->
<!--                                Поддерживаемые форматы: JPG, PNG, GIF. Максимальный размер: 5 МБ-->
<!--                            </p>-->
<!--                        </div>-->
<!--                        <div class="file-upload">-->
<!--                            <input type="file"-->
<!--                                   id="profileImage"-->
<!--                                   name="profileImage"-->
<!--                                   accept="image/*"-->
<!--                                   onchange="previewImage(this, 'avatarPreview', 'avatarPlaceholder')">-->
<!--                            <label for="profileImage" class="upload-btn">-->
<!--                                <i class="fas fa-upload"></i>-->
<!--                                <span>Загрузить фото</span>-->
<!--                            </label>-->
<!--                        </div>-->
<!--                        <button type="button"-->
<!--                                class="remove-btn"-->
<!--                                onclick="removeImage('profileImage', 'avatarPreview', 'avatarPlaceholder')"-->
<!--                                th:if="${user.imageUrl}">-->
<!--                            <i class="fas fa-trash"></i>-->
<!--                            <span>Удалить</span>-->
<!--                        </button>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->

<!--            &lt;!&ndash; Background Photo Section &ndash;&gt;-->
<!--            <div class="form-section">-->
<!--                <h2 class="section-title">Фон профиля</h2>-->
<!--                <p class="section-description">-->
<!--                    Добавьте фоновое изображение для вашего профиля. Рекомендуемый размер: 1500x500 пикселей.-->
<!--                </p>-->

<!--                <div class="background-preview" id="backgroundPreview">-->
<!--                    <img th:if="${user.imgBackground}"-->
<!--                         th:src="${user.imgBackground}"-->
<!--                         alt="Фон профиля"-->
<!--                         class="background-image"-->
<!--                         id="backgroundImage">-->
<!--                    <div th:unless="${user.imgBackground}" class="background-placeholder" id="backgroundPlaceholder">-->
<!--                        <i class="fas fa-image"></i>-->
<!--                        <p>Фоновое изображение не установлено</p>-->
<!--                    </div>-->
<!--                </div>-->

<!--                <div style="margin-top: 1.5rem;">-->
<!--                    <div class="upload-info" style="margin-bottom: 1rem;">-->
<!--                        <p class="upload-hint">-->
<!--                            <i class="fas fa-info-circle me-1"></i>-->
<!--                            Поддерживаемые форматы: JPG, PNG. Максимальный размер: 10 МБ-->
<!--                        </p>-->
<!--                    </div>-->
<!--                    <div class="file-upload">-->
<!--                        <input type="file"-->
<!--                               id="backgroundImage"-->
<!--                               name="backgroundImage"-->
<!--                               accept="image/*"-->
<!--                               onchange="previewBackgroundImage(this)">-->
<!--                        <label for="backgroundImage" class="upload-btn">-->
<!--                            <i class="fas fa-upload"></i>-->
<!--                            <span>Загрузить фон</span>-->
<!--                        </label>-->
<!--                    </div>-->
<!--                    <button type="button"-->
<!--                            class="remove-btn"-->
<!--                            onclick="removeBackgroundImage()"-->
<!--                            th:if="${user.imgBackground}">-->
<!--                        <i class="fas fa-trash"></i>-->
<!--                        <span>Удалить фон</span>-->
<!--                    </button>-->
<!--                </div>-->
<!--            </div>-->

<!--            &lt;!&ndash; Form Actions &ndash;&gt;-->
<!--            <div class="form-section">-->
<!--                <div class="form-actions">-->
<!--                    <a th:href="@{/profile/{userId}(userId=${user.id})}"-->
<!--                       class="btn-luxury btn-secondary-luxury">-->
<!--                        <i class="fas fa-times"></i>-->
<!--                        <span>Отмена</span>-->
<!--                    </a>-->
<!--                    <button type="submit" class="btn-luxury btn-primary-luxury">-->
<!--                        <i class="fas fa-save"></i>-->
<!--                        <span>Сохранить изменения</span>-->
<!--                    </button>-->
<!--                </div>-->
<!--            </div>-->
<!--        </form>-->
<!--    </div>-->
<!--</main>-->

<!--&lt;!&ndash; JS в конце страницы &ndash;&gt;-->
<!--<th:block th:replace="~{fragments/sidebar :: sidebar-scripts}"></th:block>-->

<!--<script>-->
<!--    // Image preview functionality-->
<!--    function previewImage(input, previewId, placeholderId) {-->
<!--        const preview = document.getElementById(previewId);-->
<!--        const placeholder = document.getElementById(placeholderId);-->

<!--        if (input.files && input.files[0]) {-->
<!--            const reader = new FileReader();-->

<!--            reader.onload = function(e) {-->
<!--                if (preview) {-->
<!--                    preview.src = e.target.result;-->
<!--                    preview.style.display = 'block';-->
<!--                }-->
<!--                if (placeholder) {-->
<!--                    placeholder.style.display = 'none';-->
<!--                }-->
<!--            };-->

<!--            reader.readAsDataURL(input.files[0]);-->
<!--        }-->
<!--    }-->

<!--    // Background image preview-->
<!--    function previewBackgroundImage(input) {-->
<!--        const preview = document.getElementById('backgroundImage');-->
<!--        const placeholder = document.getElementById('backgroundPlaceholder');-->

<!--        if (input.files && input.files[0]) {-->
<!--            const reader = new FileReader();-->

<!--            reader.onload = function(e) {-->
<!--                if (preview) {-->
<!--                    preview.src = e.target.result;-->
<!--                    preview.style.display = 'block';-->
<!--                }-->
<!--                if (placeholder) {-->
<!--                    placeholder.style.display = 'none';-->
<!--                }-->
<!--            };-->

<!--            reader.readAsDataURL(input.files[0]);-->
<!--        }-->
<!--    }-->

<!--    // Remove image functionality-->
<!--    function removeImage(inputId, previewId, placeholderId) {-->
<!--        const input = document.getElementById(inputId);-->
<!--        const preview = document.getElementById(previewId);-->
<!--        const placeholder = document.getElementById(placeholderId);-->

<!--        if (input) input.value = '';-->
<!--        if (preview) preview.style.display = 'none';-->
<!--        if (placeholder) placeholder.style.display = 'flex';-->
<!--    }-->

<!--    // Remove background image-->
<!--    function removeBackgroundImage() {-->
<!--        const input = document.getElementById('backgroundImage');-->
<!--        const preview = document.getElementById('backgroundImage');-->
<!--        const placeholder = document.getElementById('backgroundPlaceholder');-->

<!--        if (input) input.value = '';-->
<!--        if (preview) preview.style.display = 'none';-->
<!--        if (placeholder) placeholder.style.display = 'flex';-->
<!--    }-->

<!--    // Form validation and enhancement-->
<!--    document.addEventListener('DOMContentLoaded', function() {-->
<!--        // Add loading state to submit button-->
<!--        const form = document.querySelector('form');-->
<!--        const submitBtn = document.querySelector('.btn-primary-luxury');-->

<!--        if (form && submitBtn) {-->
<!--            form.addEventListener('submit', function() {-->
<!--                submitBtn.disabled = true;-->
<!--                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> <span>Сохранение...</span>';-->
<!--            });-->
<!--        }-->

<!--        // Character counter for text inputs-->
<!--        const textInputs = document.querySelectorAll('input[maxlength]');-->
<!--        textInputs.forEach(input => {-->
<!--            const maxLength = input.getAttribute('maxlength');-->
<!--            const counterDiv = document.createElement('div');-->
<!--            counterDiv.className = 'character-counter';-->
<!--            counterDiv.style.fontSize = '0.75rem';-->
<!--            counterDiv.style.color = 'var(&#45;&#45;text-muted)';-->
<!--            counterDiv.style.textAlign = 'right';-->
<!--            counterDiv.style.marginTop = '0.25rem';-->

<!--            function updateCounter() {-->
<!--                const currentLength = input.value.length;-->
<!--                counterDiv.textContent = `${currentLength}/${maxLength}`;-->

<!--                if (currentLength > maxLength * 0.9) {-->
<!--                    counterDiv.style.color = '#d97706';-->
<!--                } else {-->
<!--                    counterDiv.style.color = 'var(&#45;&#45;text-muted)';-->
<!--                }-->
<!--            }-->

<!--            input.addEventListener('input', updateCounter);-->
<!--            input.parentNode.appendChild(counterDiv);-->
<!--            updateCounter();-->
<!--        });-->

<!--        console.log('📝 Profile edit page initialized');-->
<!--    });-->
<!--</script>-->
<!--</body>-->
<!--</html>-->
<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Редактирование профиля - Cleopatra</title>

    <!-- External CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Стили sidebar -->
    <th:block th:replace="~{fragments/sidebar :: sidebar-styles}"></th:block>

    <style>
        /* Основные стили страницы */
        body {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-accent) 100%);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-weight: 400;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            min-height: 100vh;
            padding: 2rem;
        }

        /* Page Header */
        .page-header {
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            padding: 2rem 2.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-primary);
        }

        .page-title {
            font-family: 'Playfair Display', serif;
            font-size: 2.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 0.5rem 0;
            letter-spacing: -0.02em;
        }

        .page-subtitle {
            color: var(--text-secondary);
            font-size: 1.125rem;
            margin: 0;
        }

        /* Form Container */
        .form-container {
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-primary);
            overflow: hidden;
        }

        /* Form Sections */
        .form-section {
            padding: 2.5rem;
            border-bottom: 1px solid var(--border-secondary);
        }

        .form-section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 1.5rem 0;
            letter-spacing: -0.01em;
        }

        .section-description {
            color: var(--text-secondary);
            font-size: 0.9375rem;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        /* Profile Photo Section */
        .photo-section {
            background: linear-gradient(135deg, var(--bg-accent), #f8fafc);
        }

        .photo-upload-area {
            display: flex;
            align-items: center;
            gap: 2rem;
            margin-bottom: 1.5rem;
        }

        .current-avatar {
            position: relative;
        }

        .avatar-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 4px solid var(--bg-secondary);
            box-shadow: var(--shadow-md);
            overflow: hidden;
            background: linear-gradient(135deg, var(--bg-accent), #f1f5f9);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            font-size: 2.5rem;
        }

        .avatar-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-controls {
            flex: 1;
        }

        .upload-info {
            margin-bottom: 1rem;
        }

        .upload-hint {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin: 0;
        }

        /* Background Photo Section */
        .background-preview {
            width: 100%;
            height: 200px;
            border-radius: var(--radius-lg);
            border: 2px dashed var(--border-primary);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1.5rem;
            overflow: hidden;
            position: relative;
        }

        .background-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .background-placeholder {
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
        }

        .background-placeholder i {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        /* Form Controls */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-size: 0.9375rem;
            letter-spacing: 0.01em;
        }

        .form-control-luxury {
            background: var(--bg-accent);
            border: 1px solid var(--border-secondary);
            border-radius: var(--radius-md);
            padding: 0.875rem 1.125rem;
            font-size: 0.9375rem;
            color: var(--text-primary);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            width: 100%;
            font-family: inherit;
        }

        .form-control-luxury:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
            background: var(--bg-secondary);
        }

        .form-control-luxury::placeholder {
            color: var(--text-muted);
        }

        /* File Upload */
        .file-upload {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-upload input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .upload-btn {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-md);
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            letter-spacing: 0.01em;
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .remove-btn {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-md);
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-left: 0.75rem;
        }

        .remove-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Action Buttons */
        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            align-items: center;
        }

        .btn-luxury {
            padding: 0.875rem 2rem;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 0.9375rem;
            letter-spacing: 0.01em;
            text-decoration: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--border-primary);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .btn-luxury::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-luxury:hover::before {
            left: 100%;
        }

        .btn-primary-luxury {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border-color: transparent;
            box-shadow: var(--shadow-md);
        }

        .btn-primary-luxury:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            color: white;
        }

        .btn-secondary-luxury {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-color: var(--border-secondary);
        }

        .btn-secondary-luxury:hover {
            background: var(--bg-accent);
            color: var(--text-primary);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
            text-decoration: none;
        }

        /* Error Messages */
        .error-message {
            color: #dc2626;
            font-size: 0.8125rem;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }

        .error-message i {
            font-size: 0.75rem;
        }

        /* Success/Error Alerts */
        .alert-luxury {
            border: none;
            border-radius: var(--radius-md);
            margin-bottom: 2rem;
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow-sm);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .alert-success-luxury {
            background: linear-gradient(135deg, rgba(5, 150, 105, 0.1), rgba(16, 185, 129, 0.1));
            color: var(--accent-success);
            border-left: 4px solid var(--accent-success);
        }

        .alert-danger-luxury {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(248, 113, 113, 0.1));
            color: #dc2626;
            border-left: 4px solid #dc2626;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-content {
                margin-left: 80px;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
                margin-top: 60px;
                padding: 1rem;
            }

            .page-header,
            .form-section {
                padding: 1.5rem;
            }

            .page-title {
                font-size: 1.875rem;
            }

            .photo-upload-area {
                flex-direction: column;
                text-align: center;
                gap: 1.5rem;
            }

            .form-actions {
                flex-direction: column-reverse;
                gap: 0.75rem;
            }

            .btn-luxury {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .avatar-preview {
                width: 100px;
                height: 100px;
            }

            .background-preview {
                height: 150px;
            }
        }
    </style>
</head>
<body>
<!-- Mobile Header -->
<th:block th:replace="~{fragments/sidebar :: mobile-header}"></th:block>

<!-- Sidebar с активной секцией -->
<th:block th:replace="~{fragments/sidebar :: sidebar('profile')}"></th:block>

<!-- Main Content -->
<main class="main-content">
    <!-- Success/Error Messages -->
    <div th:if="${successMessage}" class="alert-luxury alert-success-luxury">
        <i class="fas fa-check-circle"></i>
        <span th:text="${successMessage}"></span>
    </div>

    <div th:if="${errorMessage}" class="alert-luxury alert-danger-luxury">
        <i class="fas fa-exclamation-circle"></i>
        <span th:text="${errorMessage}"></span>
    </div>

    <!-- Page Header -->
    <div class="page-header">
        <h1 class="page-title">Редактирование профиля</h1>
        <p class="page-subtitle">Персонализируйте свой профиль и настройте отображение</p>
    </div>

    <!-- Form Container -->
    <div class="form-container">
        <form                   th:action="@{/profile/{userId}/update(userId=${user.id})}"
                                th:object="${updateProfileDto}"
                                method="post"
                                enctype="multipart/form-data">

            <!-- Personal Information Section -->
            <div class="form-section">
                <h2 class="section-title">Личная информация</h2>
                <p class="section-description">
                    Обновите ваше имя и фамилию. Эта информация будет отображаться в вашем профиле и видна другим пользователям.
                </p>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="firstName" class="form-label">Имя</label>
                            <input type="text"
                                   id="firstName"
                                   th:field="*{firstName}"
                                   class="form-control-luxury"
                                   placeholder="Введите ваше имя"
                                   maxlength="50">
                            <div th:if="${#fields.hasErrors('firstName')}" class="error-message">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span th:errors="*{firstName}"></span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="lastName" class="form-label">Фамилия</label>
                            <input type="text"
                                   id="lastName"
                                   th:field="*{lastName}"
                                   class="form-control-luxury"
                                   placeholder="Введите вашу фамилию"
                                   maxlength="50">
                            <div th:if="${#fields.hasErrors('lastName')}" class="error-message">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span th:errors="*{lastName}"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Photo Section -->
            <div class="form-section photo-section">
                <h2 class="section-title">Фотография профиля</h2>
                <p class="section-description">
                    Загрузите фотографию для вашего профиля. Рекомендуемый размер: 400x400 пикселей или больше.
                </p>

                <div class="photo-upload-area">
                    <div class="current-avatar">
                        <div class="avatar-preview">
                            <img th:if="${user.imageUrl}"
                                 th:src="${user.imageUrl}"
                                 alt="Текущий аватар"
                                 class="avatar-image"
                                 id="avatarPreview">
                            <div th:unless="${user.imageUrl}" id="avatarPlaceholder">
                                <i class="fas fa-user"></i>
                            </div>
                        </div>
                    </div>
                    <div class="photo-controls">
                        <div class="upload-info">
                            <p class="upload-hint">
                                <i class="fas fa-info-circle me-1"></i>
                                Поддерживаемые форматы: JPG, PNG, GIF. Максимальный размер: 5 МБ
                            </p>
                        </div>
                        <div class="file-upload">
                            <input type="file"
                                   id="profileImage"
                                   name="profileImage"
                                   accept="image/*"
                                   onchange="previewImage(this, 'avatarPreview', 'avatarPlaceholder')">
                            <label for="profileImage" class="upload-btn">
                                <i class="fas fa-upload"></i>
                                <span>Загрузить фото</span>
                            </label>
                        </div>
                        <button type="button"
                                class="remove-btn"
                                onclick="removeImage('profileImage', 'avatarPreview', 'avatarPlaceholder')"
                                th:if="${user.imageUrl}">
                            <i class="fas fa-trash"></i>
                            <span>Удалить</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Background Photo Section -->
            <div class="form-section">
                <h2 class="section-title">Фон профиля</h2>
                <p class="section-description">
                    Добавьте фоновое изображение для вашего профиля. Рекомендуемый размер: 1500x500 пикселей.
                </p>

                <div class="background-preview" id="backgroundPreview">
                    <img th:if="${user.imgBackground}"
                         th:src="${user.imgBackground}"
                         alt="Фон профиля"
                         class="background-image"
                         id="backgroundImage">
                    <div th:unless="${user.imgBackground}" class="background-placeholder" id="backgroundPlaceholder">
                        <i class="fas fa-image"></i>
                        <p>Фоновое изображение не установлено</p>
                    </div>
                </div>

                <div style="margin-top: 1.5rem;">
                    <div class="upload-info" style="margin-bottom: 1rem;">
                        <p class="upload-hint">
                            <i class="fas fa-info-circle me-1"></i>
                            Поддерживаемые форматы: JPG, PNG. Максимальный размер: 10 МБ
                        </p>
                    </div>
                    <div class="file-upload">
                        <input type="file"
                               id="backgroundImage"
                               name="backgroundImage"
                               accept="image/*"
                               onchange="previewBackgroundImage(this)">
                        <label for="backgroundImage" class="upload-btn">
                            <i class="fas fa-upload"></i>
                            <span>Загрузить фон</span>
                        </label>
                    </div>
                    <button type="button"
                            class="remove-btn"
                            onclick="removeBackgroundImage()"
                            th:if="${user.imgBackground}">
                        <i class="fas fa-trash"></i>
                        <span>Удалить фон</span>
                    </button>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-section">
                <div class="form-actions">
                    <a th:href="@{/profile/{userId}(userId=${user.id})}"
                       class="btn-luxury btn-secondary-luxury">
                        <i class="fas fa-times"></i>
                        <span>Отмена</span>
                    </a>
                    <button type="submit" class="btn-luxury btn-primary-luxury">
                        <i class="fas fa-save"></i>
                        <span>Сохранить изменения</span>
                    </button>
                </div>
            </div>
        </form>
    </div>
</main>

<!-- JS в конце страницы -->
<th:block th:replace="~{fragments/sidebar :: sidebar-scripts}"></th:block>

<script>
    // Image preview functionality
    function previewImage(input, previewId, placeholderId) {
        const preview = document.getElementById(previewId);
        const placeholder = document.getElementById(placeholderId);

        if (input.files && input.files[0]) {
            const reader = new FileReader();

            reader.onload = function(e) {
                if (preview) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                }
                if (placeholder) {
                    placeholder.style.display = 'none';
                }
            };

            reader.readAsDataURL(input.files[0]);
        }
    }

    // Background image preview
    function previewBackgroundImage(input) {
        const preview = document.getElementById('backgroundImage');
        const placeholder = document.getElementById('backgroundPlaceholder');

        if (input.files && input.files[0]) {
            const reader = new FileReader();

            reader.onload = function(e) {
                if (preview) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                }
                if (placeholder) {
                    placeholder.style.display = 'none';
                }
            };

            reader.readAsDataURL(input.files[0]);
        }
    }

    // Remove image functionality
    function removeImage(inputId, previewId, placeholderId) {
        const input = document.getElementById(inputId);
        const preview = document.getElementById(previewId);
        const placeholder = document.getElementById(placeholderId);

        if (input) input.value = '';
        if (preview) preview.style.display = 'none';
        if (placeholder) placeholder.style.display = 'flex';
    }

    // Remove background image
    function removeBackgroundImage() {
        const input = document.getElementById('backgroundImage');
        const preview = document.getElementById('backgroundImage');
        const placeholder = document.getElementById('backgroundPlaceholder');

        if (input) input.value = '';
        if (preview) preview.style.display = 'none';
        if (placeholder) placeholder.style.display = 'flex';
    }

    // Form validation and enhancement
    document.addEventListener('DOMContentLoaded', function() {
        // Add loading state to submit button
        const form = document.querySelector('form');
        const submitBtn = document.querySelector('.btn-primary-luxury');

        if (form && submitBtn) {
            form.addEventListener('submit', function() {
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> <span>Сохранение...</span>';
            });
        }

        // Character counter for text inputs
        const textInputs = document.querySelectorAll('input[maxlength]');
        textInputs.forEach(input => {
            const maxLength = input.getAttribute('maxlength');
            const counterDiv = document.createElement('div');
            counterDiv.className = 'character-counter';
            counterDiv.style.fontSize = '0.75rem';
            counterDiv.style.color = 'var(--text-muted)';
            counterDiv.style.textAlign = 'right';
            counterDiv.style.marginTop = '0.25rem';

            function updateCounter() {
                const currentLength = input.value.length;
                counterDiv.textContent = `${currentLength}/${maxLength}`;

                if (currentLength > maxLength * 0.9) {
                    counterDiv.style.color = '#d97706';
                } else {
                    counterDiv.style.color = 'var(--text-muted)';
                }
            }

            input.addEventListener('input', updateCounter);
            input.parentNode.appendChild(counterDiv);
            updateCounter();
        });

        console.log('📝 Profile edit page initialized');
    });
</script>
</body>
</html>