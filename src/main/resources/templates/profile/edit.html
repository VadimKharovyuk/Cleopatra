<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è - Cleopatra</title>

    <!-- External CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- –°—Ç–∏–ª–∏ sidebar -->
    <th:block th:replace="~{fragments/sidebar :: sidebar-styles}"></th:block>

    <style>
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
        body {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-accent) 100%);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-weight: 400;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            min-height: 100vh;
            padding: 2rem;
        }

        /* Page Header */
        .page-header {
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            padding: 2rem 2.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-primary);
        }

        .page-title {
            font-family: 'Playfair Display', serif;
            font-size: 2.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 0.5rem 0;
            letter-spacing: -0.02em;
        }

        .page-subtitle {
            color: var(--text-secondary);
            font-size: 1.125rem;
            margin: 0;
        }

        /* Form Container */
        .form-container {
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-primary);
            overflow: hidden;
        }

        /* Form Sections */
        .form-section {
            padding: 2.5rem;
            border-bottom: 1px solid var(--border-secondary);
        }

        .form-section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 1.5rem 0;
            letter-spacing: -0.01em;
        }

        .section-description {
            color: var(--text-secondary);
            font-size: 0.9375rem;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        /* Profile Photo Section */
        .photo-section {
            background: linear-gradient(135deg, var(--bg-accent), #f8fafc);
        }

        .photo-upload-area {
            display: flex;
            align-items: center;
            gap: 2rem;
            margin-bottom: 1.5rem;
        }

        .current-avatar {
            position: relative;
        }

        .avatar-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 4px solid var(--bg-secondary);
            box-shadow: var(--shadow-md);
            overflow: hidden;
            background: linear-gradient(135deg, var(--bg-accent), #f1f5f9);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            font-size: 2.5rem;
        }

        .avatar-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-controls {
            flex: 1;
        }

        .upload-info {
            margin-bottom: 1rem;
        }

        .upload-hint {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin: 0;
        }

        /* Background Photo Section */
        .background-preview {
            width: 100%;
            height: 200px;
            border-radius: var(--radius-lg);
            border: 2px dashed var(--border-primary);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1.5rem;
            overflow: hidden;
            position: relative;
        }

        .background-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .background-placeholder {
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
        }

        .background-placeholder i {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        /* Form Controls */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-size: 0.9375rem;
            letter-spacing: 0.01em;
        }

        .form-control-luxury {
            background: var(--bg-accent);
            border: 1px solid var(--border-secondary);
            border-radius: var(--radius-md);
            padding: 0.875rem 1.125rem;
            font-size: 0.9375rem;
            color: var(--text-primary);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            width: 100%;
            font-family: inherit;
        }

        .form-control-luxury:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
            background: var(--bg-secondary);
        }

        .form-control-luxury::placeholder {
            color: var(--text-muted);
        }

        /* File Upload */
        .file-upload {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-upload input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .upload-btn {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-md);
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            letter-spacing: 0.01em;
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .remove-btn {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-md);
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-left: 0.75rem;
        }

        .remove-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Action Buttons */
        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            align-items: center;
        }

        .btn-luxury {
            padding: 0.875rem 2rem;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 0.9375rem;
            letter-spacing: 0.01em;
            text-decoration: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--border-primary);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .btn-luxury::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-luxury:hover::before {
            left: 100%;
        }

        .btn-primary-luxury {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border-color: transparent;
            box-shadow: var(--shadow-md);
        }

        .btn-primary-luxury:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            color: white;
        }

        .btn-secondary-luxury {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-color: var(--border-secondary);
        }

        .btn-secondary-luxury:hover {
            background: var(--bg-accent);
            color: var(--text-primary);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
            text-decoration: none;
        }

        /* Error Messages */
        .error-message {
            color: #dc2626;
            font-size: 0.8125rem;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }

        .error-message i {
            font-size: 0.75rem;
        }

        /* Success/Error Alerts */
        .alert-luxury {
            border: none;
            border-radius: var(--radius-md);
            margin-bottom: 2rem;
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow-sm);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .alert-success-luxury {
            background: linear-gradient(135deg, rgba(5, 150, 105, 0.1), rgba(16, 185, 129, 0.1));
            color: var(--accent-success);
            border-left: 4px solid var(--accent-success);
        }

        .alert-danger-luxury {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(248, 113, 113, 0.1));
            color: #dc2626;
            border-left: 4px solid #dc2626;
        }

        /* Character Counter */
        .character-counter {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-align: right;
            margin-top: 0.25rem;
        }

        /* Loading States */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .upload-btn.loading {
            background: var(--text-muted);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-content {
                margin-left: 80px;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
                margin-top: 60px;
                padding: 1rem;
            }

            .page-header,
            .form-section {
                padding: 1.5rem;
            }

            .page-title {
                font-size: 1.875rem;
            }

            .photo-upload-area {
                flex-direction: column;
                text-align: center;
                gap: 1.5rem;
            }

            .form-actions {
                flex-direction: column-reverse;
                gap: 0.75rem;
            }

            .btn-luxury {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .avatar-preview {
                width: 100px;
                height: 100px;
            }

            .background-preview {
                height: 150px;
            }
        }
    </style>
</head>
<body>
<!-- Mobile Header -->
<th:block th:replace="~{fragments/sidebar :: mobile-header}"></th:block>

<!-- Sidebar —Å –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ–∫—Ü–∏–µ–π -->
<th:block th:replace="~{fragments/sidebar :: sidebar('profile')}"></th:block>

<!-- Main Content -->
<main class="main-content">
    <!-- Success/Error Messages -->
    <div th:if="${successMessage}" class="alert-luxury alert-success-luxury">
        <i class="fas fa-check-circle"></i>
        <span th:text="${successMessage}"></span>
    </div>

    <div th:if="${errorMessage}" class="alert-luxury alert-danger-luxury">
        <i class="fas fa-exclamation-circle"></i>
        <span th:text="${errorMessage}"></span>
    </div>

    <!-- Page Header -->
    <div class="page-header">
        <h1 class="page-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è</h1>
        <p class="page-subtitle">–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ</p>
    </div>

    <!-- Form Container -->
    <div class="form-container">
        <!-- Personal Information Form -->
        <form th:action="@{/profile/{userId}/edit(userId=${user.id})}"
              th:object="${updateProfileDto}"
              method="post"
              enctype="multipart/form-data">


            <!-- Personal Information Section -->
            <div class="form-section">
                <h2 class="section-title">–õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
                <p class="section-description">
                    –û–±–Ω–æ–≤–∏—Ç–µ –≤–∞—à–µ –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é. –≠—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ –≤–∞—à–µ–º –ø—Ä–æ—Ñ–∏–ª–µ –∏ –≤–∏–¥–Ω–∞ –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.
                </p>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="firstName" class="form-label">–ò–º—è</label>
                            <input type="text"
                                   id="firstName"
                                   th:field="*{firstName}"
                                   class="form-control-luxury"
                                   placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è"
                                   maxlength="50">
                            <div th:if="${#fields.hasErrors('firstName')}" class="error-message">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span th:errors="*{firstName}"></span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="lastName" class="form-label">–§–∞–º–∏–ª–∏—è</label>
                            <input type="text"
                                   id="lastName"
                                   th:field="*{lastName}"
                                   class="form-control-luxury"
                                   placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à—É —Ñ–∞–º–∏–ª–∏—é"
                                   maxlength="50">
                            <div th:if="${#fields.hasErrors('lastName')}" class="error-message">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span th:errors="*{lastName}"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="city" class="form-label">–ì–æ—Ä–æ–¥</label>
                            <input type="text"
                                   id="city"
                                   th:field="*{city}"
                                   class="form-control-luxury"
                                   placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –≥–æ—Ä–æ–¥"
                                   maxlength="100">
                            <div th:if="${#fields.hasErrors('city')}" class="error-message">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span th:errors="*{city}"></span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Form Actions -->
            <div class="form-section">
                <div class="form-actions">
                    <a th:href="@{/profile/{userId}(userId=${user.id})}"
                       class="btn-luxury btn-secondary-luxury">
                        <i class="fas fa-times"></i>
                        <span>–û—Ç–º–µ–Ω–∞</span>
                    </a>
                    <button type="submit" class="btn-luxury btn-primary-luxury" id="saveProfileBtn">
                        <i class="fas fa-save"></i>
                        <span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</span>
                    </button>
                </div>
            </div>
        </form>

        <!-- Profile Photo Section -->
        <div class="form-section photo-section">
            <h2 class="section-title">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –ø—Ä–æ—Ñ–∏–ª—è</h2>
            <p class="section-description">
                –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: 400x400 –ø–∏–∫—Å–µ–ª–µ–π –∏–ª–∏ –±–æ–ª—å—à–µ.
            </p>

            <div class="photo-upload-area">
                <div class="current-avatar">
                    <div class="avatar-preview">
                        <img th:if="${user.imageUrl}"
                             th:src="${user.imageUrl}"
                             alt="–¢–µ–∫—É—â–∏–π –∞–≤–∞—Ç–∞—Ä"
                             class="avatar-image"
                             id="avatarPreview">
                        <div th:unless="${user.imageUrl}" id="avatarPlaceholder">
                            <i class="fas fa-user"></i>
                        </div>
                    </div>
                </div>
                <div class="photo-controls">
                    <div class="upload-info">
                        <p class="upload-hint">
                            <i class="fas fa-info-circle me-1"></i>
                            –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: <span th:text="${allowedFormats}">JPG, PNG</span>.
                            –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: <span th:text="${maxFileSize}">10</span> –ú–ë
                        </p>
                    </div>

<!--                    <form id="avatarUploadForm" enctype="multipart/form-data">-->
<!--                        <input-->
<!--                                type="file"-->
<!--                                id="avatarFile"-->
<!--                                name="avatar"-->
<!--                                accept="image/*"-->
<!--                                onchange="uploadAvatarAjax()"-->
<!--                        required-->
<!--                        >-->
<!--                        <label for="avatarFile" class="upload-btn" id="avatarUploadBtn">-->
<!--                            <i class="fas fa-upload"></i>-->
<!--                            <span>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</span>-->
<!--                        </label>-->
<!--                    </form>-->





                    <form th:action="@{/profile/{userId}/avatar(userId=${user.id})}"
                          method="post"
                          enctype="multipart/form-data"
                          id="avatarUploadForm"
                          style="display: inline-block;">
                        <div class="file-upload">
                            <input type="file"
                                   id="avatarFile"
                                   name="avatar"
                                   accept="image/*"
                                   onchange="uploadAvatar()"
                                   required>
                            <label for="avatarFile" class="upload-btn" id="avatarUploadBtn">
                                <i class="fas fa-upload"></i>
                                <span>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</span>
                            </label>
                        </div>
                    </form>

                    <!-- ‚úÖ –û–¢–î–ï–õ–¨–ù–ê–Ø –§–û–†–ú–ê –î–õ–Ø –£–î–ê–õ–ï–ù–ò–Ø –ê–í–ê–¢–ê–†–ê -->
                    <form th:action="@{/profile/{userId}/avatar/delete(userId=${user.id})}"
                          method="post"
                          style="display: inline-block;"
                          th:if="${user.imageUrl}"
                          onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –ø—Ä–æ—Ñ–∏–ª—è?')">
                        <button type="submit" class="remove-btn">
                            <i class="fas fa-trash"></i>
                            <span>–£–¥–∞–ª–∏—Ç—å</span>
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Background Photo Section -->
        <div class="form-section">
            <h2 class="section-title">–§–æ–Ω –ø—Ä–æ—Ñ–∏–ª—è</h2>
            <p class="section-description">
                –î–æ–±–∞–≤—å—Ç–µ —Ñ–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: 1500x500 –ø–∏–∫—Å–µ–ª–µ–π.
            </p>

            <div class="background-preview" id="backgroundPreview">
                <img th:if="${user.imgBackground}"
                     th:src="${user.imgBackground}"
                     alt="–§–æ–Ω –ø—Ä–æ—Ñ–∏–ª—è"
                     class="background-image"
                     id="backgroundImagePreview">
                <div th:unless="${user.imgBackground}" class="background-placeholder" id="backgroundPlaceholder">
                    <i class="fas fa-image"></i>
                    <p>–§–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</p>
                </div>
            </div>

            <div style="margin-top: 1.5rem;">
                <div class="upload-info" style="margin-bottom: 1rem;">
                    <p class="upload-hint">
                        <i class="fas fa-info-circle me-1"></i>
                        –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: <span th:text="${allowedFormats}">JPG, PNG</span>.
                        –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: <span th:text="${maxFileSize}">10</span> –ú–ë
                    </p>
                </div>

<!--                <form id="backgroundUploadForm" enctype="multipart/form-data">-->
<!--                    <input type="file"-->
<!--                           id="backgroundFile"-->
<!--                           name="background"-->
<!--                           accept="image/*"-->
<!--                           onchange="uploadBackgroundAjax()"-->
<!--                    required>-->
<!--                    <label for="backgroundFile" class="upload-btn" id="backgroundUploadBtn">-->
<!--                        <i class="fas fa-upload"></i>-->
<!--                        <span>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ–Ω</span>-->
<!--                    </label>-->
<!--                </form>-->


                <form th:action="@{/profile/{userId}/background/upload(userId=${user.id})}"
                      method="post"
                      enctype="multipart/form-data"
                      id="backgroundUploadForm"
                      style="display: inline-block;">
                    <div class="file-upload">
                        <input type="file"
                               id="backgroundFile"
                               name="backgroundFile"
                               accept="image/*"
                               onchange="uploadBackground()"
                               required>
                        <label for="backgroundFile" class="upload-btn" id="backgroundUploadBtn">
                            <i class="fas fa-upload"></i>
                            <span>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ–Ω</span>
                        </label>
                    </div>
                </form>

                <!-- ‚úÖ –û–¢–î–ï–õ–¨–ù–ê–Ø –§–û–†–ú–ê –î–õ–Ø –£–î–ê–õ–ï–ù–ò–Ø –§–û–ù–ê -->
                <form th:action="@{/profile/{userId}/background/delete(userId=${user.id})}"
                      method="post"
                      style="display: inline-block;"
                      th:if="${user.imgBackground}"
                      onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ñ–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ?')">
                    <button type="submit" class="remove-btn">
                        <i class="fas fa-trash"></i>
                        <span>–£–¥–∞–ª–∏—Ç—å —Ñ–æ–Ω</span>
                    </button>
                </form>
            </div>
        </div>
    </div>
</main>


<!-- JS –≤ –∫–æ–Ω—Ü–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
<th:block th:replace="~{fragments/sidebar :: sidebar-scripts}"></th:block>

<!--<script th:src="@{/js/profile/AjaxAvatarUploader.js}"></script>-->
<!--<script th:src="@{/js/profile/AjaxBackgroundUploader.js}"></script>-->
<script>
    // ========================================
    // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –í–ê–õ–ò–î–ê–¶–ò–ò –ò–ó BACKEND
    // ========================================

    // –ü–æ–ª—É—á–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏–∑ Thymeleaf
    const VALIDATION_CONFIG = {
        maxFileSize: /*[[${maxFileSize}]]*/ 10, // –ú–ë –∏–∑ ImageValidator
        allowedFormats: /*[[${allowedFormats}]]*/ ['.jpg', '.jpeg', '.png'],
        validationRules: /*[[${validationRules}]]*/ '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10 MB. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: .jpg, .jpeg, .png'
    };

    console.log('‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:', VALIDATION_CONFIG);

    // ========================================
    // –§–£–ù–ö–¶–ò–ò –ó–ê–ì–†–£–ó–ö–ò –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô
    // ========================================

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ñ–∞–π–ª–∞
    function uploadAvatar() {
        const form = document.getElementById('avatarUploadForm');
        const fileInput = document.getElementById('avatarFile');
        const uploadBtn = document.getElementById('avatarUploadBtn');

        console.log('üîç Upload Avatar:', { form: !!form, fileInput: !!fileInput });

        if (fileInput && fileInput.files && fileInput.files[0]) {
            const file = fileInput.files[0];
            console.log('üìÅ –§–∞–π–ª –≤—ã–±—Ä–∞–Ω:', file.name, `(${(file.size / 1024 / 1024).toFixed(2)} MB)`);

            // ‚úÖ –í–ê–õ–ò–î–ê–¶–ò–Ø –ü–ï–†–ï–î –ó–ê–ì–†–£–ó–ö–û–ô
            if (!validateImageFile(file, 'avatar')) {
                fileInput.value = ''; // –û—á–∏—â–∞–µ–º input
                return;
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é
            previewImage(fileInput, 'avatarPreview', 'avatarPlaceholder');

            // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –î–æ–±–∞–≤–ª—è–µ–º loading —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ü–†–ê–í–ò–õ–¨–ù–û
            if (uploadBtn) {
                uploadBtn.classList.add('loading');
                uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> <span>–ó–∞–≥—Ä—É–∂–∞–µ–º...</span>';
            }

            // ‚úÖ –ü–æ–º–µ—á–∞–µ–º —Ñ–æ—Ä–º—É –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª—è—é—â—É—é—Å—è
            form.setAttribute('data-submitting', 'true');

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É
            console.log('üöÄ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É –∞–≤–∞—Ç–∞—Ä–∞');
            form.submit();
        } else {
            console.warn('‚ö†Ô∏è –§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω –∏–ª–∏ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
        }
    }

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ–Ω–∞ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ñ–∞–π–ª–∞
    function uploadBackground() {
        const form = document.getElementById('backgroundUploadForm');
        const fileInput = document.getElementById('backgroundFile');
        const uploadBtn = document.getElementById('backgroundUploadBtn');

        console.log('üîç Upload Background:', { form: !!form, fileInput: !!fileInput });

        if (fileInput && fileInput.files && fileInput.files[0]) {
            const file = fileInput.files[0];
            console.log('üìÅ –§–æ–Ω–æ–≤—ã–π —Ñ–∞–π–ª –≤—ã–±—Ä–∞–Ω:', file.name, `(${(file.size / 1024 / 1024).toFixed(2)} MB)`);

            // ‚úÖ –í–ê–õ–ò–î–ê–¶–ò–Ø –ü–ï–†–ï–î –ó–ê–ì–†–£–ó–ö–û–ô
            if (!validateImageFile(file, 'background')) {
                fileInput.value = ''; // –û—á–∏—â–∞–µ–º input
                return;
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é
            previewBackgroundImage(fileInput);

            // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –î–æ–±–∞–≤–ª—è–µ–º loading —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ü–†–ê–í–ò–õ–¨–ù–û
            if (uploadBtn) {
                uploadBtn.classList.add('loading');
                uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> <span>–ó–∞–≥—Ä—É–∂–∞–µ–º...</span>';
            }

            // ‚úÖ –ü–æ–º–µ—á–∞–µ–º —Ñ–æ—Ä–º—É –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª—è—é—â—É—é—Å—è
            form.setAttribute('data-submitting', 'true');

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É
            console.log('üöÄ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É —Ñ–æ–Ω–∞');
            form.submit();
        } else {
            console.warn('‚ö†Ô∏è –§–æ–Ω–æ–≤—ã–π —Ñ–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω –∏–ª–∏ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
        }
    }

    // ========================================
    // –§–£–ù–ö–¶–ò–ò –ü–†–ï–í–¨–Æ –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô
    // ========================================

    // Image preview functionality –¥–ª—è –ê–í–ê–¢–ê–†–ê
    function previewImage(input, previewId, placeholderId) {
        const preview = document.getElementById(previewId);
        const placeholder = document.getElementById(placeholderId);

        console.log('üñºÔ∏è Preview Avatar:', {
            preview: !!preview,
            placeholder: !!placeholder,
            file: input.files?.[0]?.name
        });

        if (input.files && input.files[0]) {
            const reader = new FileReader();

            reader.onload = function(e) {
                if (preview) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    console.log('‚úÖ –ü—Ä–µ–≤—å—é –∞–≤–∞—Ç–∞—Ä–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
                }
                if (placeholder) {
                    placeholder.style.display = 'none';
                }
            };

            reader.onerror = function() {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞ –∞–≤–∞—Ç–∞—Ä–∞');
                showErrorAlert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');
            };

            reader.readAsDataURL(input.files[0]);
        }
    }

    // Background image preview –¥–ª—è –§–û–ù–ê
    function previewBackgroundImage(input) {
        const preview = document.getElementById('backgroundImagePreview');
        const placeholder = document.getElementById('backgroundPlaceholder');

        console.log('üñºÔ∏è Preview Background:', {
            preview: !!preview,
            placeholder: !!placeholder,
            file: input.files?.[0]?.name
        });

        if (input.files && input.files[0]) {
            const reader = new FileReader();

            reader.onload = function(e) {
                if (preview) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    console.log('‚úÖ –ü—Ä–µ–≤—å—é —Ñ–æ–Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
                }
                if (placeholder) {
                    placeholder.style.display = 'none';
                }
            };

            reader.onerror = function() {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞ —Ñ–æ–Ω–∞');
                showErrorAlert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');
            };

            reader.readAsDataURL(input.files[0]);
        }
    }

    // ========================================
    // –£–õ–£–ß–®–ï–ù–ù–ê–Ø –í–ê–õ–ò–î–ê–¶–ò–Ø –§–ê–ô–õ–û–í
    // ========================================

    function validateImageFile(file, type = 'image') {
        console.log(`üîç –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–∞ ${type}:`, {
            name: file.name,
            size: `${(file.size / 1024 / 1024).toFixed(2)} MB`,
            type: file.type,
            maxAllowed: `${VALIDATION_CONFIG.maxFileSize} MB`
        });

        // ‚úÖ 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ backend)
        if (file.size > VALIDATION_CONFIG.maxFileSize * 1024 * 1024) {
            const fileSizeMB = (file.size / 1024 / 1024).toFixed(2);
            const errorMessage = `–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π: ${fileSizeMB} MB. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: ${VALIDATION_CONFIG.maxFileSize} MB`;

            console.warn('‚ùå –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –ø—Ä–µ–≤—ã—à–µ–Ω:', errorMessage);
            showErrorAlert(errorMessage);
            return false;
        }

        // ‚úÖ 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Å—Ç–æ–≥–æ —Ñ–∞–π–ª–∞
        if (file.size === 0) {
            const errorMessage = '–§–∞–π–ª –ø—É—Å—Ç–æ–π –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω';
            console.warn('‚ùå –ü—É—Å—Ç–æ–π —Ñ–∞–π–ª:', errorMessage);
            showErrorAlert(errorMessage);
            return false;
        }

        // ‚úÖ 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ MIME —Ç–∏–ø–∞
        const allowedMimeTypes = ['image/jpeg', 'image/jpg', 'image/png'];
        if (!allowedMimeTypes.includes(file.type.toLowerCase())) {
            const errorMessage = `–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç: ${file.type}. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: JPG, PNG`;
            console.warn('‚ùå –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø:', errorMessage);
            showErrorAlert(errorMessage);
            return false;
        }

        // ‚úÖ 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ–∞–π–ª–∞
        const fileName = file.name.toLowerCase();
        const hasValidExtension = VALIDATION_CONFIG.allowedFormats.some(ext =>
            fileName.endsWith(ext.toLowerCase())
        );

        if (!hasValidExtension) {
            const errorMessage = `–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: ${VALIDATION_CONFIG.allowedFormats.join(', ')}`;
            console.warn('‚ùå –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ:', errorMessage);
            showErrorAlert(errorMessage);
            return false;
        }

        // ‚úÖ 5. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è —Ñ–æ–Ω–∞ (–±–æ–ª—å—à–∏–π —Ä–∞–∑–º–µ—Ä)
        if (type === 'background') {
            // –î–ª—è —Ñ–æ–Ω–∞ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
            if (file.size < 50 * 1024) { // –ú–∏–Ω–∏–º—É–º 50KB
                const errorMessage = '–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–π –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–º–∏–Ω–∏–º—É–º 50KB)';
                console.warn('‚ùå –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–π:', errorMessage);
                showErrorAlert(errorMessage);
                return false;
            }
        }

        console.log('‚úÖ –§–∞–π–ª –ø—Ä–æ—à–µ–ª –≤–∞–ª–∏–¥–∞—Ü–∏—é');
        return true;
    }

    // ========================================
    // –°–ò–°–¢–ï–ú–ê –£–í–ï–î–û–ú–õ–ï–ù–ò–ô
    // ========================================

    function showErrorAlert(message) {
        // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∞–ª–µ—Ä—Ç—ã
        removeExistingAlerts();

        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –∞–ª–µ—Ä—Ç
        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert-luxury alert-danger-luxury validation-alert';
        alertDiv.innerHTML = `
            <i class="fas fa-exclamation-circle"></i>
            <span>${message}</span>
            <button type="button" class="alert-close" onclick="this.parentElement.remove()">
                <i class="fas fa-times"></i>
            </button>
        `;

        // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è
        alertDiv.querySelector('.alert-close').style.cssText = `
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            float: right;
            font-size: 1.2rem;
            opacity: 0.7;
            padding: 0;
            margin-left: 1rem;
            transition: opacity 0.2s ease;
        `;

        // –í—Å—Ç–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ main-content
        const mainContent = document.querySelector('.main-content');
        if (mainContent) {
            mainContent.insertBefore(alertDiv, mainContent.firstChild);
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
        alertDiv.style.opacity = '0';
        alertDiv.style.transform = 'translateY(-20px)';
        alertDiv.style.transition = 'opacity 0.3s ease, transform 0.3s ease';

        setTimeout(() => {
            alertDiv.style.opacity = '1';
            alertDiv.style.transform = 'translateY(0)';
        }, 10);

        // –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 7 —Å–µ–∫—É–Ω–¥
        setTimeout(() => {
            if (alertDiv.parentNode) {
                alertDiv.style.opacity = '0';
                alertDiv.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    if (alertDiv.parentNode) {
                        alertDiv.remove();
                    }
                }, 300);
            }
        }, 7000);

        console.log('üö® –ü–æ–∫–∞–∑–∞–Ω –∞–ª–µ—Ä—Ç:', message);
    }

    function showSuccessAlert(message) {
        removeExistingAlerts();

        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert-luxury alert-success-luxury validation-alert';
        alertDiv.innerHTML = `
            <i class="fas fa-check-circle"></i>
            <span>${message}</span>
        `;

        const mainContent = document.querySelector('.main-content');
        if (mainContent) {
            mainContent.insertBefore(alertDiv, mainContent.firstChild);
        }

        // –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
            if (alertDiv.parentNode) {
                alertDiv.style.opacity = '0';
                setTimeout(() => alertDiv.remove(), 300);
            }
        }, 3000);
    }

    function removeExistingAlerts() {
        const existingAlerts = document.querySelectorAll('.validation-alert');
        existingAlerts.forEach(alert => alert.remove());
    }

    // ========================================
    // –°–ß–ï–¢–ß–ò–ö –°–ò–ú–í–û–õ–û–í
    // ========================================

    function addCharacterCounter(input) {
        const maxLength = input.getAttribute('maxlength');
        if (!maxLength) return;

        const counterDiv = document.createElement('div');
        counterDiv.className = 'character-counter';
        counterDiv.style.cssText = `
            font-size: 0.875rem;
            color: var(--text-muted);
            text-align: right;
            margin-top: 0.25rem;
            transition: color 0.2s ease;
        `;

        function updateCounter() {
            const currentLength = input.value.length;
            counterDiv.textContent = `${currentLength}/${maxLength}`;

            if (currentLength > maxLength * 0.9) {
                counterDiv.style.color = '#d97706';
            } else if (currentLength > maxLength * 0.8) {
                counterDiv.style.color = '#f59e0b';
            } else {
                counterDiv.style.color = 'var(--text-muted)';
            }
        }

        input.addEventListener('input', updateCounter);
        input.parentNode.appendChild(counterDiv);
        updateCounter();
    }

    // ========================================
    // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
    // ========================================

    document.addEventListener('DOMContentLoaded', function() {
        console.log('üîç –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è...');
        console.log('‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏–∑ backend:', VALIDATION_CONFIG);

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã
        const avatarForm = document.getElementById('avatarUploadForm');
        const avatarInput = document.getElementById('avatarFile');
        const avatarPreview = document.getElementById('avatarPreview');
        const avatarPlaceholder = document.getElementById('avatarPlaceholder');

        const backgroundForm = document.getElementById('backgroundUploadForm');
        const backgroundInput = document.getElementById('backgroundFile');
        const backgroundPreview = document.getElementById('backgroundImagePreview');
        const backgroundPlaceholder = document.getElementById('backgroundPlaceholder');

        const profileForm = document.getElementById('profileForm');
        const saveBtn = document.getElementById('saveProfileBtn');

        console.log('üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤:');
        console.log('  –ê–≤–∞—Ç–∞—Ä:', {
            form: !!avatarForm,
            input: !!avatarInput,
            preview: !!avatarPreview,
            placeholder: !!avatarPlaceholder
        });

        console.log('  –§–æ–Ω:', {
            form: !!backgroundForm,
            input: !!backgroundInput,
            preview: !!backgroundPreview,
            placeholder: !!backgroundPlaceholder
        });

        console.log('  –ü—Ä–æ—Ñ–∏–ª—å:', {
            form: !!profileForm,
            saveBtn: !!saveBtn
        });

        // ========================================
        // –í–ê–õ–ò–î–ê–¶–ò–Ø –ê–í–ê–¢–ê–†–ê –° –ü–†–ï–î–í–ê–†–ò–¢–ï–õ–¨–ù–û–ô –ü–†–û–í–ï–†–ö–û–ô
        // ========================================

        if (avatarInput) {
            avatarInput.addEventListener('change', function() {
                const file = this.files[0];
                if (file) {
                    console.log('üìÅ –§–∞–π–ª –∞–≤–∞—Ç–∞—Ä–∞ –≤—ã–±—Ä–∞–Ω:', {
                        name: file.name,
                        size: (file.size / 1024 / 1024).toFixed(2) + 'MB',
                        type: file.type
                    });

                    // –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è (–±–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏)
                    if (!validateImageFile(file, 'avatar')) {
                        this.value = '';
                        return;
                    }

                    // –ï—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é
                    previewImage(this, 'avatarPreview', 'avatarPlaceholder');
                }
            });
        }

        // ========================================
        // –í–ê–õ–ò–î–ê–¶–ò–Ø –§–û–ù–ê –° –ü–†–ï–î–í–ê–†–ò–¢–ï–õ–¨–ù–û–ô –ü–†–û–í–ï–†–ö–û–ô
        // ========================================

        if (backgroundInput) {
            backgroundInput.addEventListener('change', function() {
                const file = this.files[0];
                if (file) {
                    console.log('üìÅ –§–∞–π–ª —Ñ–æ–Ω–∞ –≤—ã–±—Ä–∞–Ω:', {
                        name: file.name,
                        size: (file.size / 1024 / 1024).toFixed(2) + 'MB',
                        type: file.type
                    });

                    // –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è (–±–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏)
                    if (!validateImageFile(file, 'background')) {
                        this.value = '';
                        return;
                    }

                    // –ï—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é
                    previewBackgroundImage(this);
                }
            });
        }

        // ========================================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –û–ë–†–ê–ë–û–¢–ß–ò–ö–û–í –§–û–†–ú
        // ========================================

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ñ–æ—Ä–º
        handleFormSubmission('profileForm');
        handleFormSubmission('avatarUploadForm');
        handleFormSubmission('backgroundUploadForm');

        // ========================================
        // –§–û–†–ú–ê –ü–†–û–§–ò–õ–Ø
        // ========================================

        if (profileForm && saveBtn) {
            profileForm.addEventListener('submit', function() {
                saveBtn.disabled = true;
                saveBtn.classList.add('loading');
                saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> <span>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...</span>';

                // –ü–æ–º–µ—á–∞–µ–º —Ñ–æ—Ä–º—É –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª—è—é—â—É—é—Å—è
                this.setAttribute('data-submitting', 'true');

                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥ (–Ω–∞ —Å–ª—É—á–∞–π –æ—à–∏–±–∫–∏)
                setTimeout(() => {
                    saveBtn.disabled = false;
                    saveBtn.classList.remove('loading');
                    saveBtn.innerHTML = '<i class="fas fa-save"></i> <span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</span>';
                    this.removeAttribute('data-submitting');
                }, 10000);
            });
        }

        // ========================================
        // –°–ß–ï–¢–ß–ò–ö–ò –°–ò–ú–í–û–õ–û–í
        // ========================================

        const textInputs = document.querySelectorAll('input[maxlength]');
        textInputs.forEach(addCharacterCounter);

        // ========================================
        // –ê–ù–ò–ú–ê–¶–ò–ò
        // ========================================

        // –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        const animatedElements = document.querySelectorAll('.form-section');
        animatedElements.forEach((element, index) => {
            element.style.opacity = '0';
            element.style.transform = 'translateY(20px)';
            element.style.transition = 'opacity 0.6s ease, transform 0.6s ease';

            setTimeout(() => {
                element.style.opacity = '1';
                element.style.transform = 'translateY(0)';
            }, index * 150);
        });

        // Hover —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –∫–Ω–æ–ø–æ–∫
        document.querySelectorAll('.upload-btn, .remove-btn, .btn-luxury').forEach(btn => {
            btn.addEventListener('mouseenter', function() {
                if (!this.classList.contains('loading')) {
                    this.style.transform = 'translateY(-2px)';
                }
            });

            btn.addEventListener('mouseleave', function() {
                if (!this.classList.contains('loading')) {
                    this.style.transform = 'translateY(0)';
                }
            });
        });

        // ========================================
        // –ì–û–†–Ø–ß–ò–ï –ö–õ–ê–í–ò–®–ò
        // ========================================

        document.addEventListener('keydown', function(e) {
            // Ctrl+S –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                if (profileForm) {
                    profileForm.submit();
                }
            }

            // Escape –¥–ª—è –æ—Ç–º–µ–Ω—ã
            if (e.key === 'Escape') {
                const cancelBtn = document.querySelector('.btn-secondary-luxury');
                if (cancelBtn) {
                    cancelBtn.click();
                }
            }
        });

        // ========================================
        // –ó–ê–í–ï–†–®–ï–ù–ò–ï –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–ò
        // ========================================

        console.log('‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –≥–æ—Ç–æ–≤–∞!');
        console.log('üéØ –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:');
        console.log('  - –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞ —Å –ø—Ä–µ–≤—å—é –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π');
        console.log('  - –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ–Ω–∞ —Å –ø—Ä–µ–≤—å—é –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π');
        console.log(`  - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ (–º–∞–∫—Å. ${VALIDATION_CONFIG.maxFileSize} MB)`);
        console.log('  - –ö—Ä–∞—Å–∏–≤—ã–µ –∞–ª–µ—Ä—Ç—ã –¥–ª—è –æ—à–∏–±–æ–∫');
        console.log('  - –°—á–µ—Ç—á–∏–∫–∏ —Å–∏–º–≤–æ–ª–æ–≤');
        console.log('  - –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ (Ctrl+S, Escape)');
    });

    // ========================================
    // –≠–ö–°–ü–û–†–¢ –§–£–ù–ö–¶–ò–ô –í –ì–õ–û–ë–ê–õ–¨–ù–£–Æ –û–ë–õ–ê–°–¢–¨
    // ========================================

    // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –¥–ª—è onclick handlers
    window.uploadAvatar = uploadAvatar;
    window.uploadBackground = uploadBackground;
    window.previewImage = previewImage;
    window.previewBackgroundImage = previewBackgroundImage;
    window.validateImageFile = validateImageFile;
    window.showErrorAlert = showErrorAlert;
    window.showSuccessAlert = showSuccessAlert;

    // ========================================
    // –û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö –ó–ê–ì–†–£–ó–ö–ò
    // ========================================

    window.addEventListener('error', function(e) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:', e.error);

        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ —Ñ–æ—Ä–º—ã –ø—Ä–∏ –æ—à–∏–±–∫–µ
        document.querySelectorAll('form[data-submitting="true"]').forEach(form => {
            form.removeAttribute('data-submitting');
        });

        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ
        const loadingBtns = document.querySelectorAll('.upload-btn.loading, .btn-luxury.loading');
        loadingBtns.forEach(btn => {
            btn.classList.remove('loading');
            btn.disabled = false;

            if (btn.id === 'avatarUploadBtn') {
                btn.innerHTML = '<i class="fas fa-upload"></i> <span>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</span>';
            } else if (btn.id === 'backgroundUploadBtn') {
                btn.innerHTML = '<i class="fas fa-upload"></i> <span>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ–Ω</span>';
            } else if (btn.id === 'saveProfileBtn') {
                btn.innerHTML = '<i class="fas fa-save"></i> <span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</span>';
            }
        });

        showErrorAlert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
    });

    // ========================================
    // –û–ë–†–ê–ë–û–¢–ö–ê –ü–ï–†–ï–î –í–´–ì–†–£–ó–ö–û–ô –°–¢–†–ê–ù–ò–¶–´
    // ========================================

    window.addEventListener('beforeunload', function(e) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ —ç–ª–µ–º–µ–Ω—Ç—ã –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
        const activeUploads = document.querySelectorAll('.upload-btn.loading, #saveProfileBtn.loading');

        // –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º—ã –∫–æ—Ç–æ—Ä—ã–µ —Å–µ–π—á–∞—Å –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
        const submittingForms = document.querySelectorAll('form[data-submitting="true"]');

        if (activeUploads.length > 0 || submittingForms.length > 0) {
            console.log('‚ö†Ô∏è –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è: –∑–∞–≥—Ä—É–∑–∫–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ');
            e.preventDefault();
            e.returnValue = '–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ. –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø–æ–∫–∏–Ω—É—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É?';
            return e.returnValue;
        }
    });

    // ========================================
    // –£–õ–£–ß–®–ï–ù–ù–ê–Ø –û–ë–†–ê–ë–û–¢–ö–ê –û–¢–ü–†–ê–í–ö–ò –§–û–†–ú
    // ========================================

    function handleFormSubmission(formId, loadingClass = 'loading') {
        const form = document.getElementById(formId);
        if (!form) return;

        form.addEventListener('submit', function() {
            // –ü–æ–º–µ—á–∞–µ–º —Ñ–æ—Ä–º—É –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª—è—é—â—É—é—Å—è
            this.setAttribute('data-submitting', 'true');

            // –î–æ–±–∞–≤–ª—è–µ–º loading –∫–ª–∞—Å—Å –∫ –∫–Ω–æ–ø–∫–∞–º
            const buttons = this.querySelectorAll('button, .upload-btn');
            buttons.forEach(btn => {
                btn.classList.add(loadingClass);
            });

            // –£–±–∏—Ä–∞–µ–º —Ñ–ª–∞–≥ —á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ redirect –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç)
            setTimeout(() => {
                this.removeAttribute('data-submitting');
                buttons.forEach(btn => {
                    btn.classList.remove(loadingClass);
                });
            }, 5000);
        });
    }
</script>



</body>
</html>