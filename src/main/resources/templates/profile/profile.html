<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Профиль пользователя - Cleopatra</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap"
          rel="stylesheet">

    <!-- ПОДКЛЮЧЕНИЕ ФРАГМЕНТА СТИЛЕЙ -->
    <th:block th:replace="~{fragments/sidebar :: sidebar-styles}"></th:block>

    <style>
        /* Переменные уже определены в sidebar-styles, поэтому убираем дублирование */

        * {
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-accent) 100%);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-weight: 400;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Typography Hierarchy */
        .serif-heading {
            font-family: 'Playfair Display', serif;
            font-weight: 600;
            letter-spacing: -0.02em;
        }

        .sans-serif-body {
            font-family: 'Inter', sans-serif;
            font-weight: 400;
        }

        .text-display {
            font-size: 2.5rem;
            font-weight: 700;
            letter-spacing: -0.03em;
        }

        .text-title {
            font-size: 1.75rem;
            font-weight: 600;
            letter-spacing: -0.02em;
        }

        .text-subtitle {
            font-size: 1.125rem;
            font-weight: 500;
        }

        .text-caption {
            font-size: 0.875rem;
            font-weight: 500;
            letter-spacing: 0.01em;
        }

        /* Main Content - адаптируем под фрагмент sidebar */
        .main-content {
            margin-left: 280px;
            margin-right: 380px;
            min-height: 100vh;
            padding: 2rem 0;
        }

        /* Right Sidebar */
        .right-sidebar {
            position: fixed;
            top: 0;
            right: 0;
            height: 100vh;
            width: 380px;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border-primary);
            padding: 2rem 1.5rem;
            overflow-y: auto;
            box-shadow: var(--shadow-sm);
        }

        /* Profile Container */
        .profile-container {
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            margin: 0 2rem;
        }

        /* Cover Section */
        .cover-section {
            height: 280px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
            overflow: hidden;
        }

        .cover-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .cover-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.1) 100%);
        }

        /* Profile Header */
        .profile-header {
            position: relative;
            padding: 0 2.5rem;
            background: var(--bg-secondary);
        }

        .profile-avatar-container {
            position: absolute;
            top: -80px;
            left: 2.5rem;
            z-index: 10;
        }

        .profile-avatar {
            width: 160px;
            height: 160px;
            border: 6px solid var(--bg-secondary);
            border-radius: 50%;
            background: var(--bg-accent);
            box-shadow: var(--shadow-xl);
            overflow: hidden;
            position: relative;
        }

        .avatar-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .default-avatar {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--bg-accent), #f1f5f9);
            color: var(--text-muted);
        }

        /* Profile Actions */
        .profile-actions {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .btn-luxury {
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-md);
            font-weight: 500;
            font-size: 0.875rem;
            letter-spacing: 0.01em;
            text-decoration: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--border-primary);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }

        .btn-luxury::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-luxury:hover::before {
            left: 100%;
        }

        .btn-primary-luxury {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border-color: transparent;
            box-shadow: var(--shadow-md);
        }

        .btn-primary-luxury:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            color: white;
        }

        .btn-secondary-luxury {
            background: var(--surface-elevated);
            color: var(--text-primary);
            border-color: var(--border-secondary);
        }

        .btn-secondary-luxury:hover {
            background: var(--bg-accent);
            color: var(--text-primary);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-danger-luxury {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
            border-color: transparent;
        }

        .btn-danger-luxury:hover {
            background: linear-gradient(135deg, #b91c1c, #991b1b);
            color: white;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        /* Profile Info */
        .profile-info {
            padding: 6rem 2.5rem 2.5rem;
        }

        .profile-name {
            font-family: 'Playfair Display', serif;
            font-size: 2.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        .profile-username {
            font-size: 1.125rem;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            font-weight: 400;
        }

        .profile-meta {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .meta-icon {
            width: 16px;
            height: 16px;
            opacity: 0.7;
        }

        /* Stats Section */
        .stats-section {
            display: flex;
            gap: 2rem;
            margin-bottom: 2rem;
            padding: 1.5rem 0;
            border-top: 1px solid var(--border-secondary);
            border-bottom: 1px solid var(--border-secondary);
        }

        .stat-item {
            text-decoration: none;
            color: inherit;
            transition: all 0.2s;
        }

        .stat-item:hover {
            color: var(--accent-primary);
            transform: translateY(-1px);
        }

        .stat-number {
            display: block;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.2;
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 400;
        }

        /* Navigation Tabs */
        .profile-nav {
            margin-bottom: 0;
        }

        .nav-tabs-luxury {
            border: none;
            gap: 0.5rem;
        }

        .nav-tab-luxury {
            padding: 1rem 1.5rem;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.875rem;
            letter-spacing: 0.01em;
            border-radius: var(--radius-md);
            transition: all 0.2s;
            position: relative;
        }

        .nav-tab-luxury:hover {
            background: var(--bg-accent);
            color: var(--text-primary);
        }

        .nav-tab-luxury.active {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.1), rgba(124, 58, 237, 0.1));
            color: var(--accent-primary);
        }

        .nav-tab-luxury.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 24px;
            height: 2px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 1px;
        }

        /* Content Area */
        .content-area {
            padding: 2.5rem;
            min-height: 400px;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
        }

        .empty-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--bg-accent), #f1f5f9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            color: var(--text-muted);
            font-size: 2rem;
        }

        .empty-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
        }

        .empty-description {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        /* Right Sidebar Widgets */
        .widget {
            background: var(--surface-elevated);
            border-radius: var(--radius-lg);
            margin-bottom: 1.5rem;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-secondary);
        }

        .widget-header {
            padding: 1.5rem 1.5rem 1rem;
            border-bottom: 1px solid var(--border-secondary);
        }

        .widget-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .widget-content {
            padding: 1rem 1.5rem 1.5rem;
        }

        .suggestion-item {
            display: flex;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-secondary);
            transition: all 0.2s;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-item:hover {
            background: var(--bg-accent);
            margin: 0 -1.5rem;
            padding-left: 1.5rem;
            padding-right: 1.5rem;
            border-radius: var(--radius-sm);
        }

        .suggestion-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--bg-accent), #f1f5f9);
            margin-right: 1rem;
            box-shadow: var(--shadow-sm);
        }

        .suggestion-info {
            flex: 1;
        }

        .suggestion-name {
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-primary);
            margin: 0 0 0.25rem;
        }

        .suggestion-handle {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin: 0;
        }

        .btn-follow {
            background: var(--accent-primary);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-sm);
            font-weight: 500;
            font-size: 0.75rem;
            transition: all 0.2s;
        }

        .btn-follow:hover {
            background: var(--accent-secondary);
            transform: translateY(-1px);
        }

        /* Alerts */
        .alert-luxury {
            border: none;
            border-radius: var(--radius-md);
            margin: 2rem;
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow-sm);
        }

        .alert-success-luxury {
            background: linear-gradient(135deg, rgba(5, 150, 105, 0.1), rgba(16, 185, 129, 0.1));
            color: var(--accent-success);
            border-left: 4px solid var(--accent-success);
        }

        .alert-danger-luxury {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(248, 113, 113, 0.1));
            color: #dc2626;
            border-left: 4px solid #dc2626;
        }

        /* Адаптация под мобильные устройства с учетом фрагмента */
        @media (max-width: 1400px) {
            .right-sidebar {
                display: none;
            }

            .main-content {
                margin-right: 0;
            }
        }

        @media (max-width: 1024px) {
            .main-content {
                margin-left: 80px;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
                margin-top: 60px;
                padding: 1rem 0;
            }

            .profile-container {
                margin: 0 1rem;
            }

            .profile-header, .profile-info, .content-area {
                padding-left: 1.5rem;
                padding-right: 1.5rem;
            }

            .profile-avatar-container {
                left: 1.5rem;
            }

            .profile-actions {
                justify-content: flex-start;
                gap: 0.5rem;
            }

            .btn-luxury {
                padding: 0.625rem 1rem;
                font-size: 0.8125rem;
                flex: 1;
                min-width: 100px;
                text-align: center;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .profile-actions {
                flex-direction: column;
                gap: 0.75rem;
            }

            .btn-luxury {
                width: 100%;
                flex: none;
            }

            .profile-info {
                padding-top: 5rem;
            }
        }

        /* Стили для рекомендаций (из оригинального кода) */
        .suggestion-avatar-link {
            text-decoration: none;
            display: flex;
            align-items: center;
        }

        .suggestion-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            overflow: hidden;
            flex-shrink: 0;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .suggestion-avatar:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(212, 175, 55, 0.3);
        }

        .suggestion-name-link {
            text-decoration: none;
            color: inherit;
            display: block;
        }

        .suggestion-name {
            margin: 0;
            font-weight: 600;
            color: var(--text-primary);
            transition: color 0.2s ease;
            cursor: pointer;
        }

        .suggestion-name-link:hover .suggestion-name {
            color: var(--accent-primary);
        }

        .suggestion-handle-link {
            text-decoration: none;
            color: inherit;
            display: block;
        }

        .suggestion-handle {
            margin: 0;
            font-size: 0.9rem;
            color: var(--text-secondary);
            transition: color 0.2s ease;
            cursor: pointer;
        }

        .suggestion-handle-link:hover .suggestion-handle {
            color: var(--accent-primary);
        }

        .widget-footer {
            padding: 1rem;
            border-top: 1px solid var(--border-color);
            background: var(--bg-accent);
            border-radius: 0 0 var(--radius-lg) var(--radius-lg);
        }

        .btn-show-all {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            padding: 0.75rem;
            background: transparent;
            color: var(--accent-primary);
            text-decoration: none;
            border-radius: var(--radius-md);
            font-weight: 500;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }

        .btn-show-all:hover {
            background: var(--bg-secondary);
            border-color: var(--accent-primary);
            transform: translateY(-1px);
        }

        .no-recommendations {
            padding: 2rem 1rem;
        }

        .empty-state {
            text-align: center;
            padding: 1rem;
        }

        .empty-state p {
            margin: 0;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .suggestion-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-color);
            transition: background 0.2s ease;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-item:hover {
            background: var(--bg-accent);
            border-radius: var(--radius-md);
        }

        .avatar-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            transition: border-color 0.2s ease;
        }

        .suggestion-avatar:hover .avatar-img {
            border-color: var(--accent-primary);
        }

        .suggestion-info {
            flex: 1;
            min-width: 0;
        }

        .suggestion-meta {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin: 0.25rem 0 0 0;
        }

        .btn-follow {
            padding: 0.5rem 1rem;
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            flex-shrink: 0;
        }

    </style>
    <link th:href="@{/css/feed/mention-suggestions.css}" rel="stylesheet">


</head>

<body th:data-current-user-id="${currentUserId}"
      th:data-profile-user-id="${user.id}"
      th:data-is-subscribed="${isSubscribed ?: false}">

<!-- ПОДКЛЮЧЕНИЕ МОБИЛЬНОГО ХЕДЕРА ИЗ ФРАГМЕНТА -->
<th:block th:replace="~{fragments/sidebar :: mobile-header}"></th:block>

<!-- ПОДКЛЮЧЕНИЕ SIDEBAR ИЗ ФРАГМЕНТА С УКАЗАНИЕМ АКТИВНОЙ СЕКЦИИ -->
<th:block th:replace="~{fragments/sidebar :: sidebar('profile')}"></th:block>

<!-- Main Content -->
<main class="main-content">

    <div style="display: none;"
         th:text="'Debug: user.id=' + ${user.id} + ', currentUserId=' + ${currentUserId} + ', isSubscribed=' + ${isSubscribed}">
    </div>
    <!-- Success/Error Messages -->
    <div th:if="${successMessage}" class="alert-luxury alert-success-luxury">
        <i class="fas fa-check-circle me-2"></i>
        <span th:text="${successMessage}"></span>
    </div>

    <div th:if="${errorMessage}" class="alert-luxury alert-danger-luxury">
        <i class="fas fa-exclamation-circle me-2"></i>
        <span th:text="${errorMessage}"></span>
    </div>

    <!-- Profile Container -->
    <div class="profile-container">
        <!-- Cover Section -->
        <div class="cover-section">
            <img th:if="${user.imgBackground}"
                 th:src="${user.imgBackground}"
                 alt="Cover"
                 class="cover-image">
            <div class="cover-overlay"></div>
        </div>

        <!-- Profile Header -->
        <div class="profile-header">
            <!-- Avatar -->
            <div class="profile-avatar-container">
                <div class="profile-avatar">
                    <img th:if="${user.imageUrl}"
                         th:src="${user.imageUrl}"
                         alt="Аватар"
                         class="avatar-image">
                    <div th:unless="${user.imageUrl}" class="default-avatar">
                        <i class="fas fa-user fa-3x"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Info -->
        <div class="profile-info">
            <h1 class="profile-name">
                <th:block th:if="${!#strings.isEmpty(user.firstName) || !#strings.isEmpty(user.lastName)}">
                    <span th:text="${user.firstName ?: ''}"></span>
                    <span th:text="${user.lastName ?: ''}"></span>
                </th:block>
                <th:block th:unless="${!#strings.isEmpty(user.firstName) || !#strings.isEmpty(user.lastName)}">
                    Добро пожаловать
                </th:block>
            </h1>
            <p class="profile-username" th:text="'@' + ${user.email.split('@')[0]}"></p>


            <div class="profile-actions">
                <!-- Кнопки для ЧУЖОГО профиля -->
                <th:block th:if="${currentUserId != null and currentUserId != user.id}">

                    <a th:href="@{/messages/chat/{userId}(userId=${user.id})}" class="btn-luxury btn-secondary-luxury">
                        <i class="fas fa-envelope"></i>
                        <span>Сообщение</span>
                    </a>


                    <!-- ПРОСТАЯ кнопка подписки -->
                    <button type="button"
                            id="follow-btn"
                            class="follow-btn"
                            data-action="follow"
                            th:data-user-id="${user.id}"
                            th:class="${isSubscribed} ? 'btn-luxury btn-secondary-luxury following' : 'btn-luxury btn-primary-luxury'"
                            onclick="simpleToggleFollow()">
                        <i th:class="${isSubscribed} ? 'fas fa-user-check' : 'fas fa-user-plus'" id="follow-icon"></i>
                        <span id="follow-text" th:text="${isSubscribed} ? 'Подписан' : 'Подписаться'">Подписаться</span>
                    </button>



                    <!-- Показывается только для чужих профилей -->
                    <div th:if="${currentUserId != null and currentUserId != user.id}" class="block-button-container">

                        <!-- Кнопка РАЗБЛОКИРОВАТЬ (показывается если пользователь заблокирован) -->
                        <a th:if="${iBlockedUser}"
                           href="#"
                           class="btn-luxury btn-success-luxury smart-block-btn"
                           data-action="unblock"
                           th:data-user-id="${user.id}"
                           th:data-user-name="${user.firstName + ' ' + user.lastName}"
                           title="Разблокировать пользователя">
                            <i class="fas fa-unlock"></i>
                            <span>Разблокировать</span>
                        </a>

                        <!-- Кнопка ЗАБЛОКИРОВАТЬ (показывается если пользователь НЕ заблокирован) -->
                        <a th:unless="${iBlockedUser}"
                           href="#"
                           class="btn-luxury btn-danger-luxury smart-block-btn"
                           data-action="block"
                           th:data-user-id="${user.id}"
                           th:data-user-name="${user.firstName + ' ' + user.lastName}"
                           title="Заблокировать пользователя">
                            <i class="fas fa-ban"></i>
                            <span>Заблокировать</span>
                        </a>

                    </div>

                    <!-- Дополнительные стили для умных кнопок -->
                    <style>
                        .block-button-container {
                            display: inline-block;
                            margin: 0.5rem 0;
                        }

                        .smart-block-btn {
                            display: inline-flex;
                            align-items: center;
                            gap: 0.5rem;
                            padding: 0.75rem 1.5rem;
                            border-radius: 8px;
                            text-decoration: none;
                            font-weight: 500;
                            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
                            cursor: pointer;
                            border: none;
                            font-size: 0.875rem;
                            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                        }

                        /* Стили для кнопки блокировки */
                        .btn-danger-luxury {
                            background: linear-gradient(135deg, #dc2626, #ef4444);
                            color: white;
                        }

                        .btn-danger-luxury:hover {
                            transform: translateY(-2px);
                            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
                            text-decoration: none;
                            color: white;
                        }

                        .btn-danger-luxury:active {
                            transform: translateY(0);
                            box-shadow: 0 2px 4px rgba(220, 38, 38, 0.2);
                        }

                        /* Стили для кнопки разблокировки */
                        .btn-success-luxury {
                            background: linear-gradient(135deg, #059669, #10b981);
                            color: white;
                        }

                        .btn-success-luxury:hover {
                            transform: translateY(-2px);
                            box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
                            text-decoration: none;
                            color: white;
                        }

                        .btn-success-luxury:active {
                            transform: translateY(0);
                            box-shadow: 0 2px 4px rgba(5, 150, 105, 0.2);
                        }

                        /* Анимация при изменении состояния */
                        .smart-block-btn {
                            animation: buttonFadeIn 0.3s ease-in-out;
                        }

                        @keyframes buttonFadeIn {
                            from {
                                opacity: 0;
                                transform: scale(0.9);
                            }
                            to {
                                opacity: 1;
                                transform: scale(1);
                            }
                        }

                        /* Индикатор загрузки */
                        .smart-block-btn.loading {
                            pointer-events: none;
                            opacity: 0.6;
                        }

                        .smart-block-btn.loading i {
                            animation: spin 1s linear infinite;
                        }

                        @keyframes spin {
                            from {
                                transform: rotate(0deg);
                            }
                            to {
                                transform: rotate(360deg);
                            }
                        }

                        /* Адаптивность */
                        @media (max-width: 768px) {
                            .smart-block-btn {
                                width: 100%;
                                justify-content: center;
                                padding: 1rem 1.5rem;
                                font-size: 1rem;
                            }
                        }
                    </style>


                </th:block>

                <!-- Кнопки для СОБСТВЕННОГО профиля -->
                <th:block th:if="${currentUserId != null and currentUserId == user.id}">

                    <a th:href="@{/profile/{userId}/edit(userId=${user.id})}" class="btn-luxury btn-primary-luxury">
                        <i class="fas fa-edit"></i>
                        <span>Редактировать профиль</span>
                    </a>

                    <a th:href="@{/showProfileStats/{userId}/stats(userId=${user.id})}"
                       class="btn-luxury btn-secondary-luxury">
                        <i class="fas fa-chart-bar"></i>
                        <span>Статистика</span>
                    </a>
                </th:block>

                <!-- Если никакие условия не сработали -->
                <div th:if="${currentUserId == null}">
                    <p style="color: red;">❌ Пользователь не авторизован</p>
                </div>
            </div>

            <!-- Meta Information -->
            <div class="profile-meta">
                <div class="meta-item">
                    <i class="fas fa-calendar-alt meta-icon"></i>
                    <span th:text="'Присоединился ' + ${#temporals.format(user.createdAt, 'MMMM yyyy', new java.util.Locale('ru'))}"></span>
                </div>

                <div class="meta-item">
                    <i class="fas fa-map-marker-alt meta-icon"></i>
                    <span th:if="${user.city != null and !#strings.isEmpty(user.city)}" th:text="${user.city}"></span>
                    <span th:if="${user.city == null or #strings.isEmpty(user.city)}">Местоположение не указано</span>
                </div>

                <!-- ✅ РАСШИРЕННЫЙ БЛОК: Детальный онлайн статус -->
                <div class="meta-item">
                    <!-- Онлайн с анимацией -->
                    <div th:if="${user.isOnline}" class="status-container online">
                        <div class="status-indicator">
                            <span class="status-dot online-dot"></span>
                            <i class="fas fa-wifi meta-icon"></i>
                        </div>
                        <div class="status-info">
                            <span class="status-main">Сейчас в сети</span>
                            <small class="status-sub">Активен</small>
                        </div>
                    </div>

                    <!-- Оффлайн с временем -->
                    <div th:unless="${user.isOnline}" class="status-container offline">
                        <div class="status-indicator">
                            <span class="status-dot offline-dot"></span>
                            <i class="fas fa-clock meta-icon"></i>
                        </div>
                        <div class="status-info">
                <span class="status-main" th:if="${user.lastSeen != null}">
                    Был в сети
                </span>
                            <span class="status-main" th:if="${user.lastSeen == null}">
                    Неактивен
                </span>
                            <small class="status-sub" th:if="${user.lastSeen != null}">
                                <span th:text="${#temporals.format(user.lastSeen, 'dd MMM yyyy, HH:mm', new java.util.Locale('ru'))}"></span>
                            </small>
                            <small class="status-sub" th:if="${user.lastSeen == null}">
                                Давно не заходил
                            </small>
                        </div>
                    </div>
                </div>
            </div>
            <style>
                .status-container {
                    display: flex;
                    align-items: center;
                    gap: 0.75rem;
                    padding: 0.5rem 0;
                }

                .status-indicator {
                    position: relative;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }

                .status-dot {
                    position: absolute;
                    width: 8px;
                    height: 8px;
                    border-radius: 50%;
                    top: -2px;
                    right: -2px;
                }

                .online-dot {
                    background: #10b981;
                    box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.3);
                    animation: pulse-dot 2s infinite;
                }

                .offline-dot {
                    background: #6b7280;
                }

                .status-info {
                    display: flex;
                    flex-direction: column;
                    gap: 0.2rem;
                }

                .status-main {
                    font-weight: 600;
                    font-size: 0.9rem;
                }

                .status-container.online .status-main {
                    color: #10b981;
                }

                .status-container.offline .status-main {
                    color: #374151;
                }

                .status-sub {
                    font-size: 0.8rem;
                    color: #6b7280;
                }

                /* Анимации */
                @keyframes pulse-dot {
                    0% {
                        box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.3);
                    }
                    50% {
                        box-shadow: 0 0 0 6px rgba(16, 185, 129, 0.1);
                    }
                    100% {
                        box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.3);
                    }
                }

                /* Темная тема (если используете) */
                @media (prefers-color-scheme: dark) {
                    .status-container.offline .status-main {
                        color: #d1d5db;
                    }
                }
            </style>


            <!-- Stats Section с правильными ссылками -->
            <div class="stats-section">
                <a th:href="@{/subscriptions/{userId}/following(userId=${user.id})}" class="stat-item">
                    <span class="stat-number" th:text="${user.followingCount ?: 0}">0</span>
                    <span class="stat-label">Подписок</span>
                </a>
                <a th:href="@{/subscriptions/{userId}/followers(userId=${user.id})}" class="stat-item">
                    <span class="stat-number" th:text="${user.followersCount ?: 0}">0</span>
                    <span class="stat-label">Подписчиков</span>
                </a>
                <a href="#" class="stat-item">
                    <span class="stat-number" th:text="${user.postsCount ?: 0}">0</span>
                    <span class="stat-label">Постов</span>
                </a>
            </div>


            <!-- Navigation Tabs -->
            <div class="profile-nav">
                <div class="nav-tabs-luxury d-flex">
                    <button class="nav-tab-luxury active">Посты</button>

                    <a th:href="@{'/stories/user/' + ${userId}}" class="nav-tab-luxury-link">
                        <button class="nav-tab-luxury">
                            Медиа
                        </button>
                    </a>

                    <!-- Добавляем ссылку на стену -->
                    <a th:href="@{'/wall/' + ${userId}}" class="nav-tab-luxury-link">
                        <button class="nav-tab-luxury">
                            Стена
                        </button>
                    </a>

                    <a th:href="@{/photos/user/{userId}(userId=${user.id})}" class="nav-tab-luxury-link">
                        <button class="nav-tab-luxury">
                            Фотографии
                        </button>
                    </a>
                </div>
            </div>
        </div>


        <!-- Content Area - заменить существующий блок -->
        <div class="content-area" id="profileContentArea">

            <!-- Если есть посты -->
            <div th:if="${posts != null and !posts.posts.empty}" id="postsSection">

                <!-- Список постов -->
                <div class="posts-container" id="postsContainer">
                    <!-- Обновленная статья поста с навигацией -->
                    <article class="post-card" th:each="post : ${posts.posts}">

                        <!-- Заголовок поста с автором -->
                        <div class="post-header">
                            <!-- Аватар автора -->
                            <a th:href="@{/profile/{userId}(userId=${post.author.id})}" class="author-avatar-link">
                                <div class="author-avatar">
                                    <img th:if="${post.author.imageUrl}"
                                         th:src="${post.author.imageUrl}"
                                         th:alt="${post.author.firstName + ' ' + (post.author.lastName ?: '')}"
                                         class="avatar-img">
                                    <div th:unless="${post.author.imageUrl}" class="default-avatar-small">
                                        <span th:text="${#strings.substring(post.author.firstName, 0, 1)}">A</span>
                                        <span th:if="${post.author.lastName != null and !#strings.isEmpty(post.author.lastName)}"
                                              th:text="${#strings.substring(post.author.lastName, 0, 1)}"></span>
                                    </div>
                                </div>
                            </a>

                            <!-- Информация об авторе -->
                            <div class="author-info">
                                <div class="author-main">
                                    <a th:href="@{/profile/{userId}(userId=${post.author.id})}" class="author-name">
                                        <span th:text="${post.author.firstName}">Имя</span>
                                        <span th:if="${post.author.lastName != null and !#strings.isEmpty(post.author.lastName)}"
                                              th:text="' ' + ${post.author.lastName}"> Фамилия</span>
                                    </a>
                                    <span class="author-handle" th:text="'@' + ${post.author.firstName?.toLowerCase()}">@автор</span>
                                    <!-- Дата теперь ссылка на пост -->
                                    <a th:href="@{/posts/{id}(id=${post.id})}" class="post-date-link">
                        <span class="post-date"
                              th:text="${#temporals.format(post.createdAt, 'dd MMM', new java.util.Locale('ru'))}">1 янв</span>
                                    </a>
                                </div>
                            </div>

                            <!-- Меню поста -->
                            <div class="post-menu">
                                <button class="post-menu-btn" onclick="togglePostMenu(this)">
                                    <i class="fas fa-ellipsis-h"></i>
                                </button>
                                <div class="post-menu-dropdown">
                                    <a th:href="@{/posts/{id}(id=${post.id})}" class="menu-item">
                                        <i class="fas fa-link"></i>
                                        Перейти к посту
                                    </a>
                                    <a href="#" class="menu-item" onclick="copyPostLink(this)"
                                       th:data-post-id="${post.id}">
                                        <i class="fas fa-copy"></i>
                                        Копировать ссылку
                                    </a>
                                    <a href="#" class="menu-item" th:if="${isOwnProfile}">
                                        <i class="fas fa-edit"></i>
                                        Редактировать
                                    </a>
                                    <a href="#" class="menu-item danger" th:if="${isOwnProfile}"
                                       onclick="deletePost(event, this)" th:data-post-id="${post.id}">
                                        <i class="fas fa-trash"></i>
                                        Удалить
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Содержимое поста - теперь кликабельное -->
                        <div class="post-content" onclick="navigateToPost(event, this)" th:data-post-id="${post.id}">
                            <!-- Текст поста -->


                            <div class="post-text" th:if="${post.content != null and !#strings.isEmpty(post.content)}">
                                <p th:utext="${post.content}" class="post-text">
                                    Содержимое поста...
                                </p>
                                <span th:if="${post.isLongContent}" class="read-more-link">
                    <a th:href="@{/posts/{id}(id=${post.id})}">Читать далее</a>
                </span>
                            </div>


                            <!-- Изображение поста -->
                            <div class="post-media" th:if="${post.hasImage}">
                                <div class="media-container">
                                    <img th:src="${post.imageUrl}"
                                         alt="Изображение поста"
                                         class="post-image">
                                </div>
                            </div>
                            <!-- Компактная версия для мобильных -->
                            <div th:if="${post.hasLocation()}" class="post-location-compact">
                                <i class="fas fa-map-marker-alt"></i>
                                <span th:text="${post.location.displayName}"></span>
                            </div>
                        </div>


                        <!-- Информация о лайках (новый блок) -->
                        <div class="post-likes-info"
                             th:if="${post.recentLikes != null and !post.recentLikes.empty and post.likesCount > 0}">
                            <div class="likes-avatars">
                                <!-- Показываем аватары последних пользователей, которые лайкнули -->
                                <div class="like-avatar" th:each="likeUser, iterStat : ${post.recentLikes}"
                                     th:if="${iterStat.index < 3}">
                                    <img th:if="${likeUser.imageUrl}"
                                         th:src="${likeUser.imageUrl}"
                                         th:alt="${likeUser.fullName}"
                                         th:title="${likeUser.fullName}"
                                         class="like-avatar-img">
                                    <div th:unless="${likeUser.imageUrl}"
                                         class="like-avatar-default"
                                         th:title="${likeUser.fullName}">
                                        <span th:text="${#strings.substring(likeUser.firstName, 0, 1)}">A</span>
                                    </div>
                                </div>

                                <!-- Если лайков больше 3, показываем "+N" -->
                                <div class="like-more" th:if="${post.likesCount > 3}">
                                    <span th:text="'+' + ${post.likesCount - 3}">+5</span>
                                </div>
                            </div>

                            <!-- Текст с информацией о лайках -->
                            <div class="likes-text">
                <span th:if="${post.likesCount == 1}">
                    Нравится <strong th:text="${post.recentLikes[0].fullName}">пользователю</strong>
                </span>
                                <span th:if="${post.likesCount == 2}">
                    Нравится <strong th:text="${post.recentLikes[0].fullName}">пользователю 1</strong>
                    и <strong th:text="${post.recentLikes[1].fullName}">пользователю 2</strong>
                </span>
                                <span th:if="${post.likesCount > 2}">
                    Нравится <strong th:text="${post.recentLikes[0].fullName}">пользователю 1</strong>
                    и еще <strong th:text="${post.likesCount - 1}">N</strong> пользователям
                </span>
                            </div>
                        </div>

                        <!-- Действия с постом -->
                        <div class="post-actions">

                            <!-- Комментарии -->
                            <button class="action-btn comment-btn"
                                    onclick="openComments(event, this)"
                                    th:data-post-id="${post.id}">
                                <i class="far fa-comment"></i>
                                <span th:text="${post.commentsCount}">0</span>
                            </button>

                            <!-- Обновленная кнопка лайка -->
                            <button class="action-btn like-btn"
                                    onclick="toggleLike(this)"
                                    th:data-post-id="${post.id}"
                                    th:classappend="${post.isLikedByCurrentUser ? 'liked' : ''}">
                                <i th:class="${post.isLikedByCurrentUser ? 'fas fa-heart' : 'far fa-heart'}"></i>
                                <span th:text="${post.likesCount}">0</span>
                            </button>

                            <button class="action-btn share-btn" onclick="sharePost(this)"
                                    th:data-post-id="${post.id}">
                                <i class="fas fa-share"></i>
                            </button>

                            <div class="action-stats">
               <span class="views-count">
                <i class="far fa-eye"></i>
                <span th:text="${post.viewsCount}">0</span>
                </span>
                            </div>

                        </div>

                    </article>
                </div>

            </div>


            <!-- Если постов нет -->
            <div th:unless="${posts != null and !posts.posts.empty}" class="empty-state" id="emptyState">
                <div class="empty-icon">
                    <i class="fas fa-feather-alt"></i>
                </div>
                <h3 class="empty-title" th:text="${isOwnProfile ? 'Ваша история начинается здесь' : 'Пока нет постов'}">
                    Ваша история начинается здесь
                </h3>
                <p class="empty-description"
                   th:text="${isOwnProfile ? 'Поделитесь своими мыслями и начните создавать свой уникальный контент' : 'Этот пользователь еще не публиковал посты'}">
                    Поделитесь своими мыслями и начните создавать свой уникальный контент
                </p>
                <a th:if="${isOwnProfile}"
                   href="/posts/create"
                   class="btn-luxury btn-primary-luxury">
                    <i class="fas fa-plus"></i>
                    Создать первый пост
                </a>
            </div>
        </div>

        <!-- Скрытые данные для JavaScript -->
        <script th:inline="javascript">
            // Данные профиля для JavaScript
            window.profileData = {
                userId: /*[[${user.id}]]*/ 0,
                currentUserId: /*[[${currentUserId}]]*/ 0,
                isOwnProfile: /*[[${isOwnProfile}]]*/ false,
                initialPostsCount: /*[[${posts?.posts?.size() ?: 0}]]*/ 0,
                hasMorePosts: /*[[${posts?.hasNext ?: false}]]*/ false
            };
        </script>

        <!-- CSS стили для бесконечного скролла -->
        <style>
            /* Стили для индикаторов загрузки в профиле */
            .profile-loading-indicator {
                display: none;
                padding: 30px;
                text-align: center;
                border-top: 1px solid var(--border-secondary);
                margin-top: 20px;
            }

            .profile-loading-spinner {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 15px;
                color: #666;
            }

            .profile-loading-spinner i {
                font-size: 28px;
                color: var(--accent-primary);
                animation: spin 1s linear infinite;
            }

            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(360deg);
                }
            }

            .profile-loading-spinner span {
                font-size: 16px;
                font-weight: 500;
            }

            /* Стили для сообщения об окончании постов */
            .profile-no-more-posts {
                display: none;
                padding: 30px;
                text-align: center;
                border-top: 1px solid var(--border-secondary);
                margin-top: 20px;
                color: #666;
            }

            .profile-no-more-content {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }

            .profile-no-more-content i {
                font-size: 24px;
                color: #4caf50;
            }

            .profile-no-more-content span {
                font-size: 16px;
                font-weight: 500;
            }

            /* Стили для сообщения об ошибке */
            .profile-error-message {
                display: none;
                padding: 25px;
                text-align: center;
                border-top: 1px solid var(--border-secondary);
                margin-top: 20px;
                background-color: #ffebee;
                border-radius: 12px;
                margin-left: 20px;
                margin-right: 20px;
            }

            .profile-error-content {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 15px;
                color: #d32f2f;
            }

            .profile-error-content i {
                font-size: 24px;
            }

            .profile-retry-btn {
                background-color: var(--accent-primary);
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 25px;
                cursor: pointer;
                font-size: 14px;
                font-weight: 500;
                margin-top: 10px;
                transition: all 0.2s;
            }

            .profile-retry-btn:hover {
                background-color: var(--accent-secondary);
                transform: translateY(-1px);
            }

            /* Анимация появления новых постов */
            .post-card {
                animation: slideInProfile 0.4s ease-out;
            }

            @keyframes slideInProfile {
                from {
                    opacity: 0;
                    transform: translateY(30px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            /* Адаптивность */
            @media (max-width: 768px) {
                .profile-loading-indicator,
                .profile-no-more-posts,
                .profile-error-message {
                    margin: 15px;
                    padding: 20px;
                }

                .profile-loading-spinner,
                .profile-no-more-content,
                .profile-error-content {
                    gap: 10px;
                }

                .profile-loading-spinner i,
                .profile-no-more-content i,
                .profile-error-content i {
                    font-size: 20px;
                }

                .profile-loading-spinner span,
                .profile-no-more-content span {
                    font-size: 14px;
                }
            }
        </style>

        <!-- JavaScript для бесконечного скролла профиля -->
        <script>
            // ============================================
            // ПЕРЕМЕННЫЕ ДЛЯ БЕСКОНЕЧНОЙ ЗАГРУЗКИ ПРОФИЛЯ
            // ============================================
            let profileCurrentPage = 1; // Начинаем с 1, так как страница 0 уже загружена
            let profileIsLoading = false;
            let profileHasMorePosts = window.profileData?.hasMorePosts || false;
            const profilePostsPerPage = 6;
            const profileUserId = window.profileData?.userId || 0;

            // ============================================
            // ФУНКЦИИ ДЛЯ БЕСКОНЕЧНОЙ ЗАГРУЗКИ ПРОФИЛЯ
            // ============================================

            // Вспомогательная функция для безопасного получения данных пользователя
            function getSafeUserData(user) {
                if (!user) {
                    return {
                        firstName: 'Пользователь',
                        lastName: '',
                        fullName: 'Пользователь',
                        imageUrl: null,
                        id: '#'
                    };
                }

                const firstName = user.firstName || 'Пользователь';
                const lastName = user.lastName || '';
                const fullName = user.fullName || `${firstName}${lastName ? ' ' + lastName : ''}`;

                return {
                    firstName,
                    lastName,
                    fullName,
                    imageUrl: user.imageUrl || null,
                    id: user.id || '#'
                };
            }

            // Функция для создания HTML поста в профиле
            function createProfilePostHTML(post) {
                // Безопасное получение данных поста
                if (!post) {
                    console.error('Пост не определен');
                    return '';
                }

                // Безопасное получение данных автора
                const author = getSafeUserData(post.author);
                const authorInitials = author.firstName.substring(0, 1) +
                    (author.lastName ? author.lastName.substring(0, 1) : '');

                let postDate = 'Недавно';
                try {
                    postDate = new Date(post.createdAt).toLocaleDateString('ru-RU', {
                        day: 'numeric',
                        month: 'short'
                    });
                } catch (e) {
                    console.warn('Ошибка форматирования даты:', e);
                }

                return `
            <article class="post-card">
                <div class="post-header">
                    <a href="/profile/${author.id}" class="author-avatar-link">
                        <div class="author-avatar">
                            ${author.imageUrl ?
                    `<img src="${author.imageUrl}" alt="${author.fullName}" class="avatar-img">` :
                    `<div class="default-avatar-small"><span>${authorInitials}</span></div>`
                }
                        </div>
                    </a>

                    <div class="author-info">
                        <div class="author-main">
                            <a href="/profile/${author.id}" class="author-name">
                                <span>${author.firstName}</span>
                                ${author.lastName ? `<span> ${author.lastName}</span>` : ''}
                            </a>
                            <span class="author-handle">@${author.firstName.toLowerCase()}</span>
                            <a href="/posts/${post.id}" class="post-date-link">
                                <span class="post-date">${postDate}</span>
                            </a>
                        </div>
                    </div>

                    <div class="post-menu">
                        <button class="post-menu-btn" onclick="togglePostMenu(this)">
                            <i class="fas fa-ellipsis-h"></i>
                        </button>
                        <div class="post-menu-dropdown">
                            <a href="/posts/${post.id}" class="menu-item">
                                <i class="fas fa-link"></i>
                                Перейти к посту
                            </a>
                            <a href="#" class="menu-item" onclick="copyPostLink(this)" data-post-id="${post.id}">
                                <i class="fas fa-copy"></i>
                                Копировать ссылку
                            </a>
                            ${window.profileData.isOwnProfile ? `
                                <a href="#" class="menu-item">
                                    <i class="fas fa-edit"></i>
                                    Редактировать
                                </a>
                                <a href="#" class="menu-item danger" onclick="deletePost(event, this)" data-post-id="${post.id}">
                                    <i class="fas fa-trash"></i>
                                    Удалить
                                </a>
                            ` : ''}
                        </div>
                    </div>
                </div>

                <div class="post-content" onclick="navigateToPost(event, this)" data-post-id="${post.id || ''}">
                    ${post.content ? `
                        <div class="post-text">
                            <p>${post.content}</p>
                            ${post.isLongContent ? `<span class="read-more-link"><a href="/posts/${post.id}">Читать далее</a></span>` : ''}
                        </div>
                    ` : ''}

                    ${post.hasImage && post.imageUrl ? `
                        <div class="post-media">
                            <div class="media-container">
                                <img src="${post.imageUrl}" alt="Изображение поста" class="post-image">
                            </div>
                        </div>
                    ` : ''}
                </div>

                ${post.recentLikes && Array.isArray(post.recentLikes) && post.recentLikes.length > 0 && post.likesCount > 0 ? `
                    <div class="post-likes-info">
                        <div class="likes-avatars">
                            ${post.recentLikes.slice(0, 3).map(likeUser => {
                    const user = getSafeUserData(likeUser);
                    const userInitial = user.firstName.substring(0, 1);

                    return `
                                    <div class="like-avatar">
                                        ${user.imageUrl ?
                        `<img src="${user.imageUrl}" alt="${user.fullName}" title="${user.fullName}" class="like-avatar-img">` :
                        `<div class="like-avatar-default" title="${user.fullName}"><span>${userInitial}</span></div>`
                    }
                                    </div>
                                `;
                }).join('')}
                            ${post.likesCount > 3 ? `<div class="like-more"><span>+${post.likesCount - 3}</span></div>` : ''}
                        </div>
                        <div class="likes-text">
                            ${(() => {
                    const firstUser = getSafeUserData(post.recentLikes[0]);
                    const secondUser = post.recentLikes[1] ? getSafeUserData(post.recentLikes[1]) : null;

                    if (post.likesCount === 1) {
                        return `<span>Нравится <strong>${firstUser.fullName}</strong></span>`;
                    } else if (post.likesCount === 2) {
                        return `<span>Нравится <strong>${firstUser.fullName}</strong> и <strong>${secondUser.fullName}</strong></span>`;
                    } else {
                        return `<span>Нравится <strong>${firstUser.fullName}</strong> и еще <strong>${post.likesCount - 1}</strong> пользователям</span>`;
                    }
                })()}
                        </div>
                    </div>
                ` : ''}

                <div class="post-actions">
                    <button class="action-btn comment-btn" onclick="openComments(event, this)" data-post-id="${post.id || ''}">
                        <i class="far fa-comment"></i>
                        <span>${post.commentsCount || 0}</span>
                    </button>

                    <button class="action-btn like-btn ${post.isLikedByCurrentUser ? 'liked' : ''}"
                            onclick="toggleLike(this)" data-post-id="${post.id || ''}">
                        <i class="${post.isLikedByCurrentUser ? 'fas fa-heart' : 'far fa-heart'}"></i>
                        <span>${post.likesCount || 0}</span>
                    </button>

                    <button class="action-btn share-btn" onclick="sharePost(this)" data-post-id="${post.id || ''}">
                        <i class="fas fa-share"></i>
                    </button>

                    <div class="action-stats">
                        <span class="views-count">
                            <i class="far fa-eye"></i>
                            <span>${post.viewsCount || 0}</span>
                        </span>
                    </div>
                </div>
            </article>
        `;
            }

            // Функция загрузки постов профиля
            async function loadMoreProfilePosts() {
                if (profileIsLoading || !profileHasMorePosts || !profileUserId) {
                    return;
                }

                profileIsLoading = true;
                showProfileLoadingIndicator();

                console.log(`🔄 Загружаем посты профиля ${profileUserId}, страница ${profileCurrentPage}`);

                try {
                    const url = `/profile/${profileUserId}/posts/api?page=${profileCurrentPage}&size=${profilePostsPerPage}`;
                    console.log('📡 Отправляем запрос:', url);

                    const response = await fetch(url, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                            'Content-Type': 'application/json'
                        },
                        credentials: 'same-origin'
                    });

                    console.log('📥 Получен ответ:', {
                        status: response.status,
                        statusText: response.statusText,
                        ok: response.ok
                    });

                    if (!response.ok) {
                        let errorMessage = `HTTP ${response.status}: ${response.statusText}`;

                        try {
                            const errorData = await response.json();
                            console.error('💥 Детали ошибки сервера:', errorData);

                            if (errorData.message) {
                                errorMessage = errorData.message;
                            } else if (errorData.error) {
                                errorMessage = errorData.error;
                            }
                        } catch (e) {
                            console.warn('Не удалось разобрать JSON ошибки');
                        }

                        if (response.status === 401) {
                            showNotification('Необходимо войти в систему', 'error');
                            setTimeout(() => {
                                window.location.href = '/login';
                            }, 2000);
                            return;
                        }

                        if (response.status === 403) {
                            showNotification('Доступ к профилю ограничен', 'error');
                            return;
                        }

                        throw new Error(errorMessage);
                    }

                    const data = await response.json();
                    console.log('📊 Получены данные профиля:', {
                        postsCount: data.posts ? data.posts.length : 0,
                        hasData: !!data,
                        hasNext: data.hasNext
                    });

                    if (data.posts && Array.isArray(data.posts) && data.posts.length > 0) {
                        console.log('✅ Добавляем посты в профиль');
                        // Фильтруем посты, чтобы убрать невалидные
                        const validPosts = data.posts.filter(post => {
                            if (!post) {
                                console.warn('Найден пустой пост, пропускаем');
                                return false;
                            }
                            if (!post.id) {
                                console.warn('Пост без ID, пропускаем:', post);
                                return false;
                            }
                            if (!post.author) {
                                console.warn('Пост без автора, пропускаем:', post);
                                return false;
                            }
                            return true;
                        });

                        if (validPosts.length > 0) {
                            appendPostsToProfile(validPosts);
                            profileCurrentPage++;

                            // Проверяем, есть ли еще посты
                            profileHasMorePosts = data.hasNext || false;
                            console.log('📄 Следующая страница:', profileCurrentPage, 'Есть еще посты:', profileHasMorePosts);
                        } else {
                            console.log('📭 Все полученные посты невалидны');
                            profileHasMorePosts = false;
                            showProfileNoMorePostsMessage();
                        }
                    } else {
                        console.log('📭 Больше постов в профиле нет');
                        profileHasMorePosts = false;
                        showProfileNoMorePostsMessage();
                    }

                } catch (error) {
                    console.error('💥 Ошибка при загрузке постов профиля:', error);

                    let userMessage = 'Ошибка загрузки постов';

                    if (error.message.includes('Failed to fetch')) {
                        userMessage = 'Проблема с подключением к серверу';
                    } else if (error.message.includes('401')) {
                        userMessage = 'Необходимо войти в систему';
                    } else if (error.message.includes('403')) {
                        userMessage = 'Доступ к профилю ограничен';
                    } else if (error.message.includes('500')) {
                        userMessage = 'Внутренняя ошибка сервера';
                    } else if (error.message) {
                        userMessage = error.message;
                    }

                    showProfileErrorMessage(userMessage);
                } finally {
                    profileIsLoading = false;
                    hideProfileLoadingIndicator();
                    console.log('🏁 Загрузка постов профиля завершена');
                }
            }

            // Функция добавления постов в профиль
            function appendPostsToProfile(posts) {
                if (!posts || !Array.isArray(posts)) {
                    console.warn('Невалидный массив постов:', posts);
                    return;
                }

                const contentArea = document.getElementById('profileContentArea');
                if (!contentArea) {
                    console.error('Контейнер профиля не найден');
                    return;
                }

                let postsContainer = document.getElementById('postsContainer');

                // Если контейнер не существует, создаем его
                if (!postsContainer) {
                    const postsSection = document.createElement('div');
                    postsSection.id = 'postsSection';

                    postsContainer = document.createElement('div');
                    postsContainer.className = 'posts-container';
                    postsContainer.id = 'postsContainer';

                    postsSection.appendChild(postsContainer);

                    // Скрываем empty state если он есть
                    const emptyState = document.getElementById('emptyState');
                    if (emptyState) {
                        emptyState.style.display = 'none';
                    }

                    contentArea.appendChild(postsSection);
                }

                posts.forEach((post, index) => {
                    try {
                        if (!post || !post.id) {
                            console.warn(`Пост ${index} невалиден:`, post);
                            return;
                        }

                        const postHTML = createProfilePostHTML(post);
                        if (!postHTML) {
                            console.warn(`Не удалось создать HTML для поста ${post.id}`);
                            return;
                        }

                        const postElement = document.createElement('article');
                        postElement.className = 'post-card';
                        postElement.innerHTML = postHTML;
                        postsContainer.appendChild(postElement);

                    } catch (error) {
                        console.error(`Ошибка при добавлении поста ${index}:`, error, post);
                    }
                });
            }

            // Функция показа индикатора загрузки профиля
            function showProfileLoadingIndicator() {
                let loadingIndicator = document.getElementById('profile-loading-indicator');

                if (!loadingIndicator) {
                    loadingIndicator = document.createElement('div');
                    loadingIndicator.id = 'profile-loading-indicator';
                    loadingIndicator.className = 'profile-loading-indicator';
                    loadingIndicator.innerHTML = `
                <div class="profile-loading-spinner">
                    <i class="fas fa-spinner"></i>
                    <span>Загрузка постов...</span>
                </div>
            `;
                    document.getElementById('profileContentArea').appendChild(loadingIndicator);
                }

                loadingIndicator.style.display = 'block';
            }

            // Функция скрытия индикатора загрузки профиля
            function hideProfileLoadingIndicator() {
                const loadingIndicator = document.getElementById('profile-loading-indicator');
                if (loadingIndicator) {
                    loadingIndicator.style.display = 'none';
                }
            }

            // Функция показа сообщения об отсутствии постов в профиле
            function showProfileNoMorePostsMessage() {
                let noMoreMessage = document.getElementById('profile-no-more-posts');

                if (!noMoreMessage) {
                    noMoreMessage = document.createElement('div');
                    noMoreMessage.id = 'profile-no-more-posts';
                    noMoreMessage.className = 'profile-no-more-posts';
                    noMoreMessage.innerHTML = `
                <div class="profile-no-more-content">
                    <i class="fas fa-check-circle"></i>
                    <span>Вы просмотрели все посты</span>
                </div>
            `;
                    document.getElementById('profileContentArea').appendChild(noMoreMessage);
                }

                noMoreMessage.style.display = 'block';
            }

            // Функция показа сообщения об ошибке в профиле
            function showProfileErrorMessage(customMessage = null) {
                let errorMessage = document.getElementById('profile-error-message');

                if (!errorMessage) {
                    errorMessage = document.createElement('div');
                    errorMessage.id = 'profile-error-message';
                    errorMessage.className = 'profile-error-message';
                    document.getElementById('profileContentArea').appendChild(errorMessage);
                }

                const message = customMessage || 'Ошибка загрузки. Попробуйте позже.';

                errorMessage.innerHTML = `
            <div class="profile-error-content">
                <i class="fas fa-exclamation-triangle"></i>
                <span>${message}</span>
                <button onclick="retryProfileLoading()" class="profile-retry-btn">Повторить</button>
            </div>
        `;

                errorMessage.style.display = 'block';
            }

            // Функция повторной загрузки профиля
            function retryProfileLoading() {
                console.log('🔄 Повторная попытка загрузки постов профиля');

                const errorMessage = document.getElementById('profile-error-message');
                if (errorMessage) {
                    errorMessage.style.display = 'none';
                }

                profileIsLoading = false;
                loadMoreProfilePosts();
            }

            // Функция определения достижения конца страницы
            function isNearBottomProfile() {
                const threshold = 300; // Загружать за 300px до конца
                return window.innerHeight + window.scrollY >= document.body.offsetHeight - threshold;
            }

            // Обработчик скролла для профиля
            let profileScrollTimeout;

            function handleProfileScroll() {
                if (profileScrollTimeout) {
                    clearTimeout(profileScrollTimeout);
                }

                profileScrollTimeout = setTimeout(() => {
                    if (isNearBottomProfile() && window.location.pathname.includes('/profile/')) {
                        loadMoreProfilePosts();
                    }
                }, 100);
            }

            // Инициализация бесконечной загрузки профиля
            function initProfileInfiniteScroll() {
                console.log('🚀 Инициализация бесконечной загрузки профиля...');

                if (!window.profileData || !window.profileData.userId) {
                    console.warn('❌ Данные профиля не найдены');
                    return;
                }

                const existingPosts = document.querySelectorAll('.post-card');
                console.log('📋 Найдено существующих постов в профиле:', existingPosts.length);

                if (existingPosts.length > 0) {
                    profileCurrentPage = 1;
                    profileHasMorePosts = window.profileData.hasMorePosts;
                    console.log('📄 Начинаем с страницы 1, есть еще посты:', profileHasMorePosts);
                } else {
                    profileCurrentPage = 0;
                    profileHasMorePosts = true;
                    console.log('📄 Начинаем с страницы 0');
                }

                // Добавляем обработчик скролла
                window.addEventListener('scroll', handleProfileScroll);

                console.log('✅ Бесконечная загрузка профиля инициализирована');
            }

            // Функция очистки обработчиков профиля
            function destroyProfileInfiniteScroll() {
                window.removeEventListener('scroll', handleProfileScroll);
                if (profileScrollTimeout) {
                    clearTimeout(profileScrollTimeout);
                }
            }

            // ============================================
            // ИНИЦИАЛИЗАЦИЯ ПРОФИЛЯ
            // ============================================

            // Инициализация при загрузке страницы
            document.addEventListener('DOMContentLoaded', function () {
                // Проверяем, что мы на странице профиля
                if (window.location.pathname.includes('/profile/')) {
                    initProfileInfiniteScroll();
                    console.log('📱 Бесконечная загрузка профиля активирована');
                }
            });

            // Инициализация если DOM уже загружен
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function () {
                    if (window.location.pathname.includes('/profile/')) {
                        initProfileInfiniteScroll();
                    }
                });
            } else {
                if (window.location.pathname.includes('/profile/')) {
                    initProfileInfiniteScroll();
                }
            }

            // Экспорт функций для использования
            window.profileInfiniteScroll = {
                init: initProfileInfiniteScroll,
                destroy: destroyProfileInfiniteScroll,
                loadMore: loadMoreProfilePosts
            };

            console.log('📝 Скрипт бесконечной загрузки профиля загружен');
        </script>


        <!-- Модальное окно подтверждения удаления -->
        <div id="deleteConfirmModal" class="modal-overlay" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Удалить пост?</h3>
                    <button class="modal-close" onclick="closeDeleteModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Это действие нельзя отменить. Пост будет удален навсегда.</p>
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary" onclick="closeDeleteModal()">
                        Отмена
                    </button>
                    <button class="btn-danger" id="confirmDeleteBtn" onclick="confirmDelete()">
                        <span class="btn-text">Удалить</span>
                        <i class="fas fa-spinner fa-spin btn-spinner" style="display: none;"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Уведомления -->
        <div id="notification" class="notification" style="display: none;">
            <div class="notification-content">
                <i class="notification-icon"></i>
                <span class="notification-text"></span>
            </div>
        </div>

        <style>
            :root {
                --bg-primary: #ffffff;
                --bg-secondary: #f8fafc;
                --bg-accent: #f1f5f9;
                --border-primary: #e2e8f0;
                --border-secondary: #f1f5f9;
                --text-primary: #1e293b;
                --text-secondary: #64748b;
                --text-muted: #94a3b8;
                --accent-primary: #3b82f6;
                --accent-secondary: #8b5cf6;
                --radius-sm: 4px;
                --radius-md: 8px;
                --radius-lg: 12px;
                --radius-xl: 16px;
                --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
                --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            }

            /* Стили для постов */
            .posts-container {
                display: flex;
                flex-direction: column;
                gap: 0;
            }

            .post-card {
                background: var(--bg-secondary);
                border-bottom: 1px solid var(--border-secondary);
                padding: 1.5rem;
                transition: all 0.2s ease;
                cursor: pointer;
            }

            .post-card:hover {
                background: var(--bg-accent);
            }

            .post-card:last-child {
                border-bottom: none;
                border-radius: 0 0 var(--radius-xl) var(--radius-xl);
            }

            /* Заголовок поста */
            .post-header {
                display: flex;
                align-items: flex-start;
                gap: 0.75rem;
                margin-bottom: 1rem;
                position: relative;
            }

            .author-avatar-link {
                text-decoration: none;
                flex-shrink: 0;
            }

            .author-avatar {
                width: 48px;
                height: 48px;
                border-radius: 50%;
                overflow: hidden;
                border: 2px solid var(--border-primary);
                transition: all 0.2s ease;
            }

            .author-avatar:hover {
                transform: scale(1.05);
                border-color: var(--accent-primary);
            }

            .avatar-img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }

            .default-avatar-small {
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-weight: 600;
                font-size: 1rem;
            }

            .author-info {
                flex: 1;
                min-width: 0;
            }

            .author-main {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                flex-wrap: wrap;
            }

            .author-name {
                font-weight: 600;
                color: var(--text-primary);
                text-decoration: none;
                transition: color 0.2s ease;
            }

            .author-name:hover {
                color: var(--accent-primary);
            }

            .author-handle {
                color: var(--text-secondary);
                font-size: 0.875rem;
            }

            .post-date {
                color: var(--text-muted);
                font-size: 0.875rem;
            }

            .post-date::before {
                content: '·';
                margin: 0 0.5rem;
                color: var(--text-muted);
            }

            .post-date-link {
                text-decoration: none;
                color: inherit;
                transition: color 0.2s ease;
            }

            .post-date-link:hover {
                color: var(--accent-primary);
            }

            .post-date-link:hover .post-date {
                text-decoration: underline;
            }

            /* Меню поста */
            .post-menu {
                position: relative;
            }

            .post-menu-btn {
                background: none;
                border: none;
                color: var(--text-muted);
                padding: 0.5rem;
                border-radius: 50%;
                transition: all 0.2s ease;
                cursor: pointer;
            }

            .post-menu-btn:hover {
                background: var(--bg-accent);
                color: var(--text-primary);
            }

            .post-menu-dropdown {
                position: absolute;
                top: 100%;
                right: 0;
                background: var(--bg-primary);
                border: 1px solid var(--border-primary);
                border-radius: var(--radius-md);
                box-shadow: var(--shadow-lg);
                min-width: 180px;
                z-index: 1000;
                display: none;
            }

            .post-menu-dropdown.show {
                display: block;
            }

            .menu-item {
                display: flex;
                align-items: center;
                gap: 0.75rem;
                padding: 0.75rem 1rem;
                color: var(--text-primary);
                text-decoration: none;
                transition: background 0.2s ease;
                font-size: 0.875rem;
            }

            .menu-item:hover {
                background: var(--bg-accent);
                color: var(--text-primary);
            }

            .menu-item.danger {
                color: #dc2626;
            }

            .menu-item.danger:hover {
                background: rgba(220, 38, 38, 0.1);
                color: #dc2626;
            }

            /* Содержимое поста */
            .post-content {
                margin-bottom: 1rem;
                cursor: pointer;
                transition: background-color 0.2s ease;
                padding: 0.5rem;
                border-radius: var(--radius-md);
            }

            .post-content:hover {
                background-color: rgba(0, 0, 0, 0.02);
            }

            .post-text {
                margin-bottom: 1rem;
                line-height: 1.6;
            }

            .post-text p {
                margin: 0;
                color: var(--text-primary);
                white-space: pre-wrap;
                word-wrap: break-word;
            }

            .read-more-link {
                color: var(--accent-primary);
                font-size: 0.875rem;
                pointer-events: auto;
                position: relative;
                z-index: 2;
            }

            .read-more-link a {
                color: inherit;
                text-decoration: none;
            }

            .read-more-link a:hover {
                text-decoration: underline;
            }

            /* Медиа контент */
            .post-media {
                margin-bottom: 1rem;
                border-radius: var(--radius-lg);
                overflow: hidden;
                border: 1px solid var(--border-primary);
            }

            .media-container {
                display: block;
                cursor: pointer;
            }

            .post-image {
                width: 100%;
                max-height: 400px;
                object-fit: cover;
                transition: transform 0.2s ease;
            }

            .post-image:hover {
                transform: scale(1.02);
            }

            /* Информация о лайках */
            .post-likes-info {
                display: flex;
                align-items: center;
                gap: 0.75rem;
                padding: 0.75rem 0;
                margin-bottom: 0.75rem;
                border-bottom: 1px solid var(--border-secondary);
            }

            .likes-avatars {
                display: flex;
                align-items: center;
            }

            .like-avatar {
                position: relative;
                z-index: 1;
            }

            .like-avatar:not(:first-child) {
                margin-left: -0.5rem;
            }

            .like-avatar-img, .like-avatar-default {
                width: 24px;
                height: 24px;
                border-radius: 50%;
                border: 2px solid var(--bg-secondary);
            }

            .like-avatar-img {
                object-fit: cover;
            }

            .like-avatar-default {
                background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 0.75rem;
                font-weight: 600;
            }

            .like-more {
                width: 24px;
                height: 24px;
                border-radius: 50%;
                background: var(--bg-accent);
                border: 2px solid var(--bg-secondary);
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 0.75rem;
                font-weight: 600;
                color: var(--text-muted);
                margin-left: -0.5rem;
            }

            .likes-text {
                font-size: 0.875rem;
                color: var(--text-secondary);
            }

            .likes-text strong {
                color: var(--text-primary);
                font-weight: 600;
            }

            /* Действия с постом */
            .post-actions {
                display: flex;
                align-items: center;
                gap: 1rem;
                padding-top: 0.75rem;
                border-top: 1px solid var(--border-secondary);
            }

            .action-btn {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                background: none;
                border: none;
                color: var(--text-muted);
                padding: 0.5rem 0.75rem;
                border-radius: var(--radius-md);
                font-size: 0.875rem;
                transition: all 0.2s ease;
                cursor: pointer;
                position: relative;
            }

            .action-btn:hover {
                background: var(--bg-accent);
                color: var(--text-primary);
            }

            .action-btn:disabled {
                opacity: 0.6;
                cursor: not-allowed;
            }

            .comment-btn:hover {
                color: #3b82f6;
                background: rgba(59, 130, 246, 0.1);
            }

            .like-btn:hover {
                color: #ef4444;
                background: rgba(239, 68, 68, 0.1);
            }

            .like-btn.liked {
                color: #ef4444;
            }

            .like-btn.liked i {
                color: #ef4444;
            }

            .like-btn.loading::after {
                content: '';
                position: absolute;
                width: 16px;
                height: 16px;
                border: 2px solid transparent;
                border-top: 2px solid currentColor;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                margin-left: 0.5rem;
            }

            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(360deg);
                }
            }

            .share-btn:hover {
                color: #10b981;
                background: rgba(16, 185, 129, 0.1);
            }

            .action-stats {
                margin-left: auto;
                display: flex;
                align-items: center;
                gap: 1rem;
            }

            .views-count {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                color: var(--text-muted);
                font-size: 0.875rem;
            }

            /* Пагинация */
            .pagination-container {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 2rem;
                border-top: 1px solid var(--border-secondary);
            }

            .page-info {
                color: var(--text-secondary);
                font-size: 0.875rem;
            }

            .load-more-container {
                padding: 2rem;
                text-align: center;
                border-top: 1px solid var(--border-secondary);
            }

            .load-more-btn {
                width: 100%;
                max-width: 300px;
            }

            /* Кнопки */
            .btn-luxury {
                padding: 0.75rem 1.5rem;
                border-radius: var(--radius-md);
                font-weight: 600;
                text-decoration: none;
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
                transition: all 0.2s ease;
                border: none;
                cursor: pointer;
            }

            .btn-primary-luxury {
                background: var(--accent-primary);
                color: white;
            }

            .btn-primary-luxury:hover {
                background: #2563eb;
                transform: translateY(-1px);
            }

            .btn-secondary-luxury {
                background: var(--bg-accent);
                color: var(--text-primary);
                border: 1px solid var(--border-primary);
            }

            .btn-secondary-luxury:hover {
                background: var(--bg-secondary);
            }

            /* Empty state */
            .empty-state {
                text-align: center;
                padding: 4rem 2rem;
                color: var(--text-secondary);
            }

            .empty-icon {
                font-size: 4rem;
                color: var(--text-muted);
                margin-bottom: 1.5rem;
            }

            .empty-title {
                font-size: 1.5rem;
                font-weight: 600;
                color: var(--text-primary);
                margin-bottom: 0.5rem;
            }

            .empty-description {
                margin-bottom: 2rem;
                line-height: 1.6;
            }

            /* Модальное окно */
            .modal-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
                backdrop-filter: blur(4px);
            }

            .modal-content {
                background: white;
                border-radius: var(--radius-lg);
                box-shadow: var(--shadow-lg);
                max-width: 400px;
                width: 90%;
                max-height: 90vh;
                overflow: hidden;
            }

            .modal-header {
                padding: 1.5rem;
                border-bottom: 1px solid var(--border-primary);
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .modal-header h3 {
                margin: 0;
                font-size: 1.125rem;
                font-weight: 600;
                color: var(--text-primary);
            }

            .modal-close {
                background: none;
                border: none;
                color: var(--text-muted);
                cursor: pointer;
                padding: 0.5rem;
                border-radius: var(--radius-sm);
                transition: all 0.2s;
            }

            .modal-close:hover {
                background: var(--bg-accent);
                color: var(--text-primary);
            }

            .modal-body {
                padding: 1.5rem;
                color: var(--text-secondary);
                line-height: 1.6;
            }

            .modal-footer {
                padding: 1.5rem;
                border-top: 1px solid var(--border-primary);
                display: flex;
                gap: 0.75rem;
                justify-content: flex-end;
            }

            .btn-secondary {
                background: var(--bg-accent);
                color: var(--text-primary);
                border: none;
                padding: 0.5rem 1rem;
                border-radius: var(--radius-sm);
                font-weight: 500;
                cursor: pointer;
                transition: all 0.2s;
            }

            .btn-secondary:hover {
                background: var(--border-primary);
            }

            .btn-danger {
                background: #dc2626;
                color: white;
                border: none;
                padding: 0.5rem 1rem;
                border-radius: var(--radius-sm);
                font-weight: 500;
                cursor: pointer;
                transition: all 0.2s;
                position: relative;
                min-width: 80px;
            }

            .btn-danger:hover {
                background: #b91c1c;
            }

            .btn-danger:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }

            .btn-danger .btn-spinner {
                position: absolute;
                left: 50%;
                top: 50%;
                transform: translate(-50%, -50%);
            }

            .btn-danger:disabled .btn-text {
                opacity: 0;
            }

            /* Уведомления */
            .notification {
                position: fixed;
                top: 20px;
                right: 20px;
                background: white;
                border: 1px solid var(--border-primary);
                border-radius: var(--radius-md);
                box-shadow: var(--shadow-lg);
                padding: 1rem 1.5rem;
                display: flex;
                align-items: center;
                gap: 0.75rem;
                z-index: 1001;
                transform: translateX(100%);
                transition: transform 0.3s ease;
            }

            .notification.show {
                transform: translateX(0);
            }

            .notification.success {
                border-left: 4px solid #10b981;
            }

            .notification.error {
                border-left: 4px solid #ef4444;
            }

            .notification-icon {
                font-size: 1.125rem;
            }

            .notification.success .notification-icon {
                color: #10b981;
            }

            .notification.error .notification-icon {
                color: #ef4444;
            }

            .notification-text {
                color: var(--text-primary);
                font-weight: 500;
            }

            /* Мобильная адаптация */
            @media (max-width: 768px) {
                .post-card {
                    padding: 1rem;
                }

                .author-main {
                    flex-direction: column;
                    align-items: flex-start;
                    gap: 0.25rem;
                }

                .author-handle,
                .post-date {
                    font-size: 0.8125rem;
                }

                .post-actions {
                    gap: 0.5rem;
                }

                .action-btn {
                    padding: 0.5rem;
                    font-size: 0.8125rem;
                }

                .pagination-container {
                    flex-direction: column;
                    gap: 1rem;
                }

                .likes-text {
                    font-size: 0.8125rem;
                }

                .post-likes-info {
                    flex-direction: column;
                    align-items: flex-start;
                    gap: 0.5rem;
                }
            }
        </style>


    </div>
</main>

<!-- Right Sidebar -->
<aside class="right-sidebar">
    <!-- Trending Topics -->
    <div class="widget">
        <div class="widget-header">
            <h3 class="widget-title">Актуальные темы</h3>
        </div>
        <div class="widget-content">
            <div class="suggestion-item">
                <div class="suggestion-info">
                    <p class="suggestion-name">#Технологии</p>
                    <p class="suggestion-handle">1.2M обсуждений</p>
                </div>
            </div>
            <div class="suggestion-item">
                <div class="suggestion-info">
                    <p class="suggestion-name">#Дизайн</p>
                    <p class="suggestion-handle">845K обсуждений</p>
                </div>
            </div>
            <div class="suggestion-item">
                <div class="suggestion-info">
                    <p class="suggestion-name">#Искусство</p>
                    <p class="suggestion-handle">654K обсуждений</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Recommendations -->
    <div class="widget">
        <div class="widget-header">
            <h3 class="widget-title">Рекомендации</h3>
        </div>
        <div class="widget-content">
            <!-- Проверяем, есть ли рекомендации -->
            <div th:if="${recommendations != null and !recommendations.empty}">
                <div class="suggestion-item" th:each="recommendation : ${recommendations}">
                    <!-- Кликабельная аватарка -->
                    <a th:href="@{/profile/{userId}(userId=${recommendation.id})}" class="suggestion-avatar-link">
                        <div class="suggestion-avatar">
                            <img th:src="${recommendation.imageUrl != null ? recommendation.imageUrl : '/images/default-avatar.png'}"
                                 th:alt="${recommendation.firstName + ' ' + recommendation.lastName}"
                                 class="avatar-img">
                        </div>
                    </a>

                    <div class="suggestion-info">
                        <!-- Кликабельное имя -->
                        <a th:href="@{/profile/{userId}(userId=${recommendation.id})}" class="suggestion-name-link">
                            <p class="suggestion-name"
                               th:text="${recommendation.firstName + ' ' + recommendation.lastName}">
                                Анна Смирнова
                            </p>
                        </a>

                        <p class="suggestion-meta"
                           th:if="${recommendation.followersCount != null and recommendation.followersCount > 0}">
                            <span th:text="${recommendation.followersCount}">150</span> подписчиков
                        </p>
                    </div>
                    <!--                    <button class="btn-follow"-->
                    <!--                            th:data-user-id="${recommendation.id}"-->
                    <!--                            th:text="${recommendation.isFollowing ? 'Читаю' : 'Читать'}">-->
                    <!--                        Читать-->
                    <!--                    </button>-->
                </div>
            </div>

            <!-- Сообщение если нет рекомендаций -->
            <div th:if="${recommendations == null or recommendations.empty}" class="no-recommendations">
                <div class="empty-state">
                    <i class="fas fa-users" style="font-size: 2rem; color: var(--text-muted); margin-bottom: 1rem;"></i>
                    <p style="color: var(--text-muted); text-align: center;">
                        Пока нет рекомендаций.<br>
                        Попробуйте позже!
                    </p>
                </div>
            </div>
        </div>

        <!-- Footer с кнопкой "Посмотреть всех" -->
        <div class="widget-footer" th:if="${recommendations != null and !recommendations.empty}">
            <a th:href="@{/recommendations}" class="btn-show-all">
                <span>Посмотреть всех</span>
                <i class="fas fa-arrow-right"></i>
            </a>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="widget">
        <div class="widget-header">
            <h3 class="widget-title">Ваша активность</h3>
        </div>
        <div class="widget-content">
            <div class="suggestion-item">
                <div class="suggestion-info">
                    <p class="suggestion-name">Просмотры профиля</p>
                    <p class="suggestion-handle">24 за эту неделю</p>
                </div>
            </div>
            <div class="suggestion-item">
                <div class="suggestion-info">
                    <p class="suggestion-name">Взаимодействия</p>
                    <p class="suggestion-handle">12 новых лайков</p>
                </div>
            </div>
        </div>
    </div>
</aside>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

<!-- ПОДКЛЮЧЕНИЕ СКРИПТОВ ИЗ ФРАГМЕНТА -->
<th:block th:replace="~{fragments/sidebar :: sidebar-scripts}"></th:block>


<script>
    // Инициализация других функций профиля
    document.addEventListener('DOMContentLoaded', function () {
        // Smooth hover animations
        document.querySelectorAll('.btn-luxury:not([data-action="follow"])').forEach(btn => {
            btn.addEventListener('mouseenter', function () {
                this.style.transform = 'translateY(-2px)';
            });

            btn.addEventListener('mouseleave', function () {
                this.style.transform = 'translateY(0)';
            });
        });

        // Tab switching functionality
        document.querySelectorAll('.nav-tab-luxury').forEach(tab => {
            tab.addEventListener('click', function () {
                document.querySelectorAll('.nav-tab-luxury').forEach(t => t.classList.remove('active'));
                this.classList.add('active');

                const emptyTitle = document.querySelector('.empty-title');
                const emptyDescription = document.querySelector('.empty-description');

                switch (this.textContent.trim()) {
                    case 'Посты':
                        emptyTitle.textContent = 'Ваша история начинается здесь';
                        emptyDescription.textContent = 'Поделитесь своими мыслями и начните создавать свой уникальный контент';
                        break;
                    case 'Ответы':
                        emptyTitle.textContent = 'Пока нет ответов';
                        emptyDescription.textContent = 'Ваши ответы на посты других пользователей будут отображаться здесь';
                        break;
                    case 'Медиа':
                        emptyTitle.textContent = 'Медиа контент отсутствует';
                        emptyDescription.textContent = 'Фотографии и видео из ваших постов будут собраны в этом разделе';
                        break;
                    case 'Нравится':
                        emptyTitle.textContent = 'Нет отмеченных постов';
                        emptyDescription.textContent = 'Посты, которые вам понравились, будут сохранены здесь';
                        break;
                }
            });
        });

        // Другие функции...
    });

    // Заглушки для других функций (можно также вынести в отдельные модули)
    function sendMessage() {
        console.log('Отправка сообщения...');
        // TODO: Реализовать логику отправки сообщения
    }

    function shareProfile() {
        if (navigator.share) {
            navigator.share({
                title: document.title,
                url: window.location.href
            });
        } else {
            // Fallback для старых браузеров
            navigator.clipboard.writeText(window.location.href).then(() => {
                window.subscriptionManager?.showNotification('Ссылка скопирована!', 'success');
            });
        }
    }

    function blockUser() {
        // Получите ID пользователя из контекста страницы
        const userId = getCurrentPageUserId(); // ваша функция получения ID
        const userName = getCurrentPageUserName(); // имя пользователя
        blockUserById(userId, userName);
    }
</script>

<!-- В конце body, перед закрывающим тегом -->

<!-- ОПТИМИЗИРОВАННАЯ ЗАГРУЗКА СКРИПТОВ ПРОФИЛЯ -->

<!-- 1. Базовые утилиты (без зависимостей) -->
<script th:src="@{/js/profile/notifications.js}"></script>
<script th:src="@{/js/profile/apiClient.js}"></script>

<!-- 2. Вспомогательные модули -->
<script th:src="@{/js/profile/profileUtils.js}"></script>

<!-- 3. Статус пользователя (ТОЛЬКО ОДИН РАЗ!) -->
<script th:src="@{/js/online-status.js}"></script>

<!-- 4. Действия пользователя (зависят от apiClient и notifications) -->
<script th:src="@{/js/profile/userActions.js}"></script>

<!-- 5. Блокировка пользователя (зависит от userActions) -->
<script th:src="@{/js/profile/lock-user.js}"></script>

<!-- 6. Уведомления о лайках (зависят от базовых модулей) -->
<script th:src="@{/js/profile/postNotificationLike.js}"></script>

<!-- 7. Подписки загружаются последними (зависят от всех предыдущих) -->
<script th:src="@{/js/profile/subscriptionActions.js}"></script>

<!-- 8. Координатор инициализации профиля -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        console.log('👤 Инициализация модулей профиля...');

        // Проверяем загрузку всех модулей
        const requiredModules = [
            'NotificationManager',
            'ApiClient',
            'UserActions',
            'ProfileUtils'
        ];

        const missingModules = requiredModules.filter(module =>
            typeof window[module] === 'undefined'
        );

        if (missingModules.length > 0) {
            console.warn('⚠️ Не загружены модули:', missingModules);
        }

        // Инициализируем модули в правильном порядке
        setTimeout(() => {
            try {
                // 1. Базовые утилиты
                if (typeof ProfileUtils !== 'undefined' && ProfileUtils.init) {
                    ProfileUtils.init();
                    console.log('✅ ProfileUtils инициализирован');
                }

                // 2. API клиент
                if (typeof ApiClient !== 'undefined' && ApiClient.init) {
                    ApiClient.init();
                    console.log('✅ ApiClient инициализирован');
                }

                // 3. Статус онлайн
                if (typeof OnlineStatus !== 'undefined' && OnlineStatus.init) {
                    OnlineStatus.init();
                    console.log('✅ OnlineStatus инициализирован');
                }

                // 4. Действия пользователя
                if (typeof UserActions !== 'undefined' && UserActions.init) {
                    UserActions.init();
                    console.log('✅ UserActions инициализирован');
                }

                // 5. Блокировка пользователя
                if (typeof LockUser !== 'undefined' && LockUser.init) {
                    LockUser.init();
                    console.log('✅ LockUser инициализирован');
                }

                // 6. Уведомления о лайках
                if (typeof PostNotificationLike !== 'undefined' && PostNotificationLike.init) {
                    PostNotificationLike.init();
                    console.log('✅ PostNotificationLike инициализирован');
                }

                // 7. Подписки (последними)
                if (typeof SubscriptionActions !== 'undefined' && SubscriptionActions.init) {
                    SubscriptionActions.init();
                    console.log('✅ SubscriptionActions инициализирован');
                }

                console.log('🎉 Все модули профиля инициализированы');

            } catch (error) {
                console.error('❌ Ошибка при инициализации модулей профиля:', error);
            }
        }, 100);
    });

    // Функция для проверки готовности модулей профиля
    window.checkProfileModulesReady = function () {
        const modules = [
            'NotificationManager',
            'ApiClient',
            'UserActions',
            'ProfileUtils',
            'SubscriptionActions'
        ];

        const status = {};
        modules.forEach(module => {
            status[module] = typeof window[module] !== 'undefined';
        });

        console.table(status);
        return status;
    };

    // Функция для переинициализации модулей профиля
    window.reinitializeProfileModules = function () {
        console.log('🔄 Переинициализация модулей профиля...');

        // Перезапускаем инициализацию через 100мс
        setTimeout(() => {
            const event = new Event('DOMContentLoaded');
            document.dispatchEvent(event);
        }, 100);
    };
</script>


</body>
</html>

